
<!DOCTYPE html>

<html dir="rtl" lang="ar">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>ØªØ·Ø¨ÙŠÙ‚ Ø­ØµØ± ÙˆØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¶Ø±Ø§Ø¦Ø¨ Ø§Ù„Ø¹Ù‚Ø§Ø±ÙŠØ©</title>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&amp;display=swap" rel="stylesheet"/>
<link href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" rel="stylesheet"/>
<script src="https://cdn.sheetjs.com/xlsx-0.20.0/package/dist/xlsx.full.min.js">

function renderPropertyRow(property, isImported = false) {
  const row = document.createElement("tr");
  row.className = isImported ? "imported-property" : "saved-property";
  row.innerHTML = `
    <td>${property.number}</td>
    <td>${property.street}</td>
    <td>${property.district}</td>
    <td>${property.city}</td>
    <td>${property.governorate}</td>
    <td>${property.date}</td>
    <td>
      <span class="property-badge ${isImported ? "badge-imported" : "badge-saved"}">
        ${isImported ? "Ù…Ø³ØªÙˆØ±Ø¯" : "Ù…Ø­ÙÙˆØ¸"}
      </span>
    </td>
    <td>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</td>
  `;
  return row;
}

</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.7.1/jszip.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<style>
/* Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù†Ù…Ø§Ø· ØªØ¨Ù‚Ù‰ ÙƒÙ…Ø§ Ù‡ÙŠ Ù…Ø¹ Ø¥Ø¶Ø§ÙØ© Ø£Ù†Ù…Ø§Ø· Ø¬Ø¯ÙŠØ¯Ø© */
:root {
--primary: #2c3e50;
--secondary: #3498db;
--accent: #e74c3c;
--success: #27ae60;
--warning: #f39c12;
--light: #ecf0f1;
--dark: #34495e;
--gray: #95a5a6;
--shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
--radius: 10px;
--transition: all 0.3s ease;
}
* {
margin: 0;
padding: 0;
box-sizing: border-box;
font-family: 'Cairo', sans-serif;
}
body {
background: linear-gradient(135deg, #f5f7fa, #e4e7eb);
color: #333;
line-height: 1.6;
min-height: 100vh;
padding: 20px;
direction: rtl;
}
.container {
max-width: 1400px;
margin: 0 auto;
}
header {
background: linear-gradient(to right, var(--primary), var(--dark));
color: white;
padding: 20px;
border-radius: var(--radius);
box-shadow: var(--shadow);
margin-bottom: 30px;
text-align: center;
position: relative;
overflow: hidden;
}
header::before {
content: "";
position: absolute;
top: 0;
left: 0;
width: 100%;
height: 100%;
background: url('data:image/svg+xml;utf8,<svg xmlns="https://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="none"><polygon points="0,0 100,0 0,100" fill="rgba(255,255,255,0.1)"/></svg>');
background-size: cover;
}
header h1 {
font-size: 2.5rem;
margin-bottom: 10px;
position: relative;
}
header p {
font-size: 1.2rem;
max-width: 800px;
margin: 0 auto;
position: relative;
}
.app-nav {
display: flex;
justify-content: center;
margin: 20px 0;
flex-wrap: wrap;
gap: 10px;
}
.nav-btn {
background: white;
color: var(--primary);
border: none;
padding: 12px 25px;
border-radius: 50px;
font-weight: bold;
cursor: pointer;
transition: var(--transition);
box-shadow: var(--shadow);
display: flex;
align-items: center;
gap: 8px;
}
.nav-btn:hover, .nav-btn.active {
background: var(--secondary);
color: white;
transform: translateY(-3px);
}
.app-section {
background: white;
border-radius: var(--radius);
box-shadow: var(--shadow);
padding: 30px;
margin-bottom: 30px;
display: none;
}
.app-section.active {
display: block;
animation: fadeIn 0.5s ease;
}
@keyframes fadeIn {
from { opacity: 0; transform: translateY(20px); }
to { opacity: 1; transform: translateY(0); }
}
.section-title {
color: var(--primary);
margin-bottom: 25px;
padding-bottom: 15px;
border-bottom: 2px solid var(--secondary);
display: flex;
justify-content: space-between;
align-items: center;
flex-wrap: wrap;
gap: 15px;
}
.form-container {
display: grid;
grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
gap: 20px;
}
.form-group {
margin-bottom: 20px;
}
.form-group label {
display: block;
margin-bottom: 8px;
font-weight: bold;
color: var(--dark);
}
.form-group input,
.form-group select,
.form-group textarea {
width: 100%;
padding: 12px 15px;
border: 1px solid #ddd;
border-radius: var(--radius);
font-size: 16px;
transition: var(--transition);
}
.form-group textarea {
min-height: 120px;
resize: vertical;
}
.form-group input:focus,
.form-group select:focus,
.form-group textarea:focus {
border-color: var(--secondary);
outline: none;
box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
}
.form-row {
display: flex;
gap: 20px;
margin-bottom: 20px;
}
.form-row .form-group {
flex: 1;
margin-bottom: 0;
}
.btn {
background: var(--secondary);
color: white;
border: none;
padding: 12px 25px;
border-radius: var(--radius);
font-size: 16px;
cursor: pointer;
transition: var(--transition);
display: inline-flex;
align-items: center;
gap: 8px;
white-space: nowrap;
}
.btn:hover {
background: #2980b9;
transform: translateY(-2px);
box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
}
.btn-success {
background: var(--success);
}
.btn-warning {
background: var(--warning);
}
.btn-danger {
background: var(--accent);
}
.btn i {
font-size: 14px;
}
.btn-group {
display: flex;
gap: 10px;
margin-top: 20px;
flex-wrap: wrap;
}
.table-responsive {
overflow-x: auto;
margin: 20px 0;
border-radius: var(--radius);
border: 1px solid #eee;
}
table {
width: 100%;
border-collapse: collapse;
min-width: 800px;
}
table th, table td {
padding: 12px 15px;
text-align: right;
border-bottom: 1px solid #eee;
}
table th {
background: var(--light);
color: var(--dark);
font-weight: bold;
}
table tr:hover {
background: rgba(52, 152, 219, 0.05);
}
.empty-data {
text-align: center;
padding: 30px;
color: var(--gray);
}
.empty-data i {
font-size: 3rem;
margin-bottom: 15px;
color: var(--secondary);
}
.unit-card {
background: white;
border: 1px solid #eee;
border-radius: var(--radius);
padding: 20px;
margin-bottom: 20px;
box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
transition: var(--transition);
position: relative;
}
.similarity-badge {
position: absolute;
top: 15px;
left: 15px;
padding: 5px 12px;
border-radius: 20px;
font-size: 12px;
font-weight: bold;
}
.similarity-street {
background: #4caf50;
color: white;
}
.similarity-village {
background: #2196f3;
color: white;
}
.similarity-city {
background: #9c27b0;
color: white;
}
.similarity-governorate {
background: #ff9800;
color: white;
}
.unit-card:hover {
transform: translateY(-5px);
box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
}
.unit-header {
display: flex;
justify-content: space-between;
align-items: center;
margin-bottom: 15px;
padding-bottom: 10px;
border-bottom: 1px dashed #eee;
}
.unit-header h3 {
color: var(--primary);
}
.unit-price {
background: var(--success);
color: white;
padding: 5px 15px;
border-radius: 20px;
font-weight: bold;
}
.value-badge {
background: #e3f2fd;
border-radius: 20px;
padding: 5px 12px;
font-size: 14px;
display: inline-flex;
align-items: center;
gap: 5px;
margin-top: 5px;
}
.value-badge.market {
background: #e8f5e9;
color: #2e7d32;
}
.value-badge.rental {
background: #fff8e1;
color: #f57f17;
}
.value-badge.net-rental {
background: #e3f2fd;
color: #1976d2;
}
.value-badge.tax {
background: #ffebee;
color: #c62828;
}
.valuation-summary {
display: grid;
grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
gap: 20px;
margin-bottom: 30px;
}
.valuation-methods {
display: flex;
flex-wrap: wrap;
gap: 15px;
align-items: center;
}
.method-selector {
display: flex;
align-items: center;
gap: 10px;
}
.method-selector label {
font-weight: bold;
color: var(--dark);
}
.method-selector select {
padding: 8px 12px;
border-radius: var(--radius);
border: 1px solid #ddd;
background: white;
}
.ai-loading {
display: inline-block;
margin-left: 10px;
color: var(--secondary);
}
.value-card {
background: linear-gradient(135deg, var(--secondary), var(--primary));
color: white;
padding: 25px;
border-radius: var(--radius);
text-align: center;
box-shadow: var(--shadow);
position: relative;
}
.similarity-level {
position: absolute;
top: 15px;
left: 15px;
background: rgba(255, 255, 255, 0.2);
padding: 5px 15px;
border-radius: 20px;
font-size: 14px;
}
.value-card h3 {
margin-bottom: 15px;
font-size: 1.5rem;
}
.value-amount {
font-size: 2.5rem;
font-weight: bold;
margin: 20px 0;
}
.stats-container {
display: grid;
grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
gap: 20px;
margin: 20px 0;
}
.stat-card {
background: white;
border-radius: var(--radius);
padding: 20px;
text-align: center;
box-shadow: var(--shadow);
border-left: 4px solid var(--secondary);
}
.stat-card h3 {
color: var(--dark);
margin-bottom: 10px;
}
.stat-value {
font-size: 2rem;
font-weight: bold;
color: var(--primary);
}
.image-preview {
display: flex;
flex-wrap: wrap;
gap: 10px;
margin-top: 10px;
}
.image-preview img {
width: 100px;
height: 100px;
object-fit: cover;
border-radius: 5px;
border: 1px solid #ddd;
transition: transform 0.3s ease;
}
.image-preview img:hover {
transform: scale(1.1);
box-shadow: 0 5px 15px rgba(0,0,0,0.1);
}
.document-item {
background: var(--light);
padding: 10px;
border-radius: 5px;
display: flex;
justify-content: space-between;
align-items: center;
margin-bottom: 10px;
}
.tab-container {
margin: 20px 0;
}
.tabs {
display: flex;
background: var(--light);
border-radius: 50px;
padding: 5px;
margin-bottom: 20px;
flex-wrap: wrap;
}
.tab {
flex: 1;
text-align: center;
padding: 10px;
cursor: pointer;
border-radius: 50px;
transition: var(--transition);
min-width: 120px;
margin: 3px;
}
.tab.active {
background: var(--secondary);
color: white;
}
.tab-content {
display: none;
}
.tab-content.active {
display: block;
}
footer {
text-align: center;
padding: 20px;
color: var(--gray);
margin-top: 30px;
border-top: 1px solid #eee;
background: #f8f9fa;
border-radius: var(--radius);
}
.signature {
font-weight: bold;
color: var(--primary);
margin-top: 10px;
}
.regression-info {
background: #f8f9fa;
border-radius: var(--radius);
padding: 20px;
margin-top: 20px;
border-left: 4px solid var(--success);
}
.regression-info h3 {
color: var(--success);
margin-bottom: 15px;
}
.regression-info ul {
padding-right: 20px;
}
.regression-info li {
margin-bottom: 10px;
}
.unit-values {
display: grid;
grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
gap: 15px;
margin-top: 15px;
padding-top: 15px;
border-top: 1px dashed #eee;
}
.unit-value-item {
background: #f8f9fa;
border-radius: 8px;
padding: 12px;
text-align: center;
}
.unit-value-item .label {
font-size: 14px;
color: var(--dark);
margin-bottom: 5px;
}
.unit-value-item .value {
font-weight: bold;
font-size: 16px;
}
.unit-value-item .market-value {
color: #2e7d32;
}
.unit-value-item .rental-value {
color: #f57f17;
}
.unit-value-item .net-rental-value {
color: #1976d2;
}
.unit-value-item .tax-value {
color: #c62828;
}
.addition-table {
margin-top: 20px;
}
.notification {
position: fixed;
top: 20px;
right: 20px;
background: var(--success);
color: white;
padding: 15px 25px;
border-radius: var(--radius);
box-shadow: var(--shadow);
z-index: 1000;
display: flex;
align-items: center;
gap: 10px;
animation: slideIn 0.3s ease, fadeOut 0.3s ease 2.7s forwards;
}
@keyframes slideIn {
from { transform: translateX(100%); opacity: 0; }
to { transform: translateX(0); opacity: 1; }
}
@keyframes fadeOut {
from { opacity: 1; }
to { opacity: 0; }
}
.record32-container {
background: white;
border-radius: var(--radius);
box-shadow: var(--shadow);
padding: 30px;
margin-top: 20px;
}
.record32-header {
text-align: center;
margin-bottom: 30px;
padding-bottom: 20px;
border-bottom: 2px solid var(--primary);
}
.record32-header h2 {
color: var(--primary);
font-size: 2rem;
margin-bottom: 10px;
}
.record32-info {
display: grid;
grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
gap: 20px;
margin-bottom: 30px;
}
.record32-info-item {
background: #f8f9fa;
border-radius: var(--radius);
padding: 15px;
border-left: 4px solid var(--secondary);
}
.record32-info-item h3 {
color: var(--dark);
margin-bottom: 10px;
font-size: 1.1rem;
}
.record32-info-item p {
font-size: 1.1rem;
font-weight: bold;
}
.record32-description {
background: #f8f9fa;
border-radius: var(--radius);
padding: 20px;
margin-bottom: 30px;
border-left: 4px solid var(--success);
}
.record32-description h3 {
color: var(--success);
margin-bottom: 15px;
}
.record32-description p {
line-height: 1.8;
}
.record32-actions {
display: flex;
justify-content: center;
gap: 15px;
margin-top: 30px;
}
#map {
height: 500px;
width: 100%;
border-radius: var(--radius);
margin-top: 20px;
box-shadow: var(--shadow);
}
.map-container {
position: relative;
}
.map-controls {
position: absolute;
top: 10px;
right: 10px;
z-index: 1000;
background: white;
padding: 10px;
border-radius: var(--radius);
box-shadow: var(--shadow);
}
.coordinates-container {
display: flex;
gap: 10px;
}
.coordinates-container input {
flex: 1;
}
.coordinates-container button {
padding: 0 15px;
}
.gps-loader {
display: inline-block;
width: 20px;
height: 20px;
border: 3px solid rgba(255,255,255,0.3);
border-radius: 50%;
border-top-color: white;
animation: spin 1s ease-in-out infinite;
margin-right: 8px;
display: none;
}
@keyframes spin {
to { transform: rotate(360deg); }
}
.market-data-info {
background: #f0f7ff;
border-radius: var(--radius);
padding: 15px;
margin-top: 20px;
border-left: 4px solid var(--secondary);
}
.market-data-info h3 {
color: var(--secondary);
margin-bottom: 10px;
display: flex;
align-items: center;
gap: 8px;
}
.price-meter {
font-weight: bold;
color: #d35400;
background: #fef9e7;
padding: 3px 8px;
border-radius: 4px;
margin-left: 5px;
}
.source-badge {
display: inline-block;
background: #3498db;
color: white;
padding: 2px 8px;
border-radius: 4px;
font-size: 12px;
margin-left: 5px;
}
.official-form {
background: white;
border-radius: var(--radius);
box-shadow: var(--shadow);
padding: 30px;
margin-bottom: 30px;
overflow-x: auto;
}
.official-form table {
min-width: 1200px;
margin-bottom: 20px;
}
.official-form .merged-cell {
background-color: #ecf0f1;
font-weight: bold;
text-align: center;
padding: 10px;
}
.official-form th {
background-color: #3498db;
color: white;
font-weight: bold;
text-align: center;
}
.official-form .section-header {
background-color: #2c3e50;
color: white;
text-align: center;
padding: 10px;
margin: 25px 0 15px;
}
.official-form .signature-area {
margin-top: 40px;
}
.official-form .signature-row {
display: flex;
justify-content: space-around;
margin-top: 15px;
}
.official-form .signature-box {
width: 45%;
text-align: center;
border-bottom: 1px solid #7f8c8d;
padding: 10px;
}
.official-form .empty-row td {
height: 25px;
}
.map-popup-content {
max-width: 300px;
}
.map-popup-content h3 {
color: var(--primary);
border-bottom: 2px solid var(--secondary);
padding-bottom: 5px;
margin-bottom: 10px;
}
.map-popup-content p {
margin-bottom: 5px;
}
.map-popup-content .unit-item {
padding: 8px;
border-bottom: 1px dashed #eee;
}
.addition-decision {
background: white;
border-radius: var(--radius);
box-shadow: var(--shadow);
padding: 30px;
margin-bottom: 30px;
}
.decision-header {
text-align: center;
margin-bottom: 30px;
padding-bottom: 20px;
border-bottom: 2px solid var(--primary);
}
.decision-header h2 {
color: var(--primary);
font-size: 1.8rem;
margin-bottom: 15px;
}
.decision-details {
display: flex;
justify-content: space-between;
flex-wrap: wrap;
margin-bottom: 20px;
gap: 15px;
}
.decision-detail {
flex: 1;
min-width: 200px;
}
.decision-detail label {
font-weight: bold;
display: block;
margin-bottom: 5px;
color: var(--dark);
}
.decision-detail input {
width: 100%;
padding: 10px;
border: 1px solid #ddd;
border-radius: 5px;
}
.addition-table {
margin-top: 20px;
overflow-x: auto;
}
.addition-table table {
width: 100%;
border-collapse: collapse;
min-width: 900px;
}
.addition-table th,
.addition-table td {
padding: 12px 15px;
border: 1px solid #ddd;
text-align: center;
}
.addition-table th {
background-color: var(--primary);
color: white;
font-weight: bold;
}
.addition-table tr:nth-child(even) {
background-color: #f8f9fa;
}
.addition-table tr:hover {
background-color: rgba(52, 152, 219, 0.05);
}
.total-row td {
background-color: var(--light);
font-weight: bold;
color: var(--primary);
}
.signature-section {
margin-top: 40px;
padding-top: 20px;
border-top: 2px solid var(--secondary);
}
.signature-row {
display: flex;
justify-content: space-around;
margin-top: 30px;
flex-wrap: wrap;
gap: 20px;
}
.signature-box {
width: 250px;
text-align: center;
}
.signature-line {
border-bottom: 1px solid var(--dark);
padding: 10px;
margin-bottom: 5px;
}
.search-container {
background: white;
border-radius: var(--radius);
box-shadow: var(--shadow);
padding: 20px;
margin-bottom: 20px;
}
.search-header {
display: flex;
justify-content: space-between;
align-items: center;
margin-bottom: 15px;
flex-wrap: wrap;
gap: 15px;
}
.search-header h3 {
color: var(--primary);
font-size: 1.4rem;
}
.search-filters {
display: grid;
grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
gap: 15px;
margin-bottom: 20px;
}
.search-filter-group {
margin-bottom: 15px;
}
.search-filter-group label {
display: block;
margin-bottom: 8px;
font-weight: bold;
color: var(--dark);
}
.search-filter-group input,
.search-filter-group select {
width: 100%;
padding: 10px 15px;
border: 1px solid #ddd;
border-radius: var(--radius);
font-size: 16px;
}
.search-actions {
display: flex;
gap: 10px;
justify-content: flex-end;
}
.search-results {
margin-top: 20px;
overflow-x: auto;
}
.search-results table {
width: 100%;
min-width: 900px;
border-collapse: collapse;
}
.search-results th {
background-color: var(--primary);
color: white;
padding: 12px 15px;
text-align: center;
}
.search-results td {
padding: 12px 15px;
border-bottom: 1px solid #eee;
text-align: center;
}
.search-results tr:hover {
background-color: rgba(52, 152, 219, 0.05);
}
.form-type-filter {
display: flex;
gap: 10px;
margin-top: 15px;
flex-wrap: wrap;
}
.form-type-btn {
padding: 8px 15px;
background: var(--light);
border: 1px solid #ddd;
border-radius: 50px;
cursor: pointer;
transition: var(--transition);
}
.form-type-btn.active {
background: var(--secondary);
color: white;
border-color: var(--secondary);
}
.no-results {
text-align: center;
padding: 30px;
color: var(--gray);
}
.no-results i {
font-size: 3rem;
margin-bottom: 15px;
color: var(--secondary);
}
.highlight {
background-color: #fffde7;
font-weight: bold;
color: var(--primary);
}
.gps-container {
position: relative;
}
.gps-status {
font-size: 12px;
margin-top: 5px;
color: var(--gray);
}
.gps-status.error {
color: var(--accent);
}
.gps-status.success {
color: var(--success);
}
.search-loader {
display: inline-block;
width: 16px;
height: 16px;
border: 2px solid rgba(255,255,255,0.3);
border-radius: 50%;
border-top-color: white;
animation: spin 1s ease-in-out infinite;
margin-right: 8px;
display: none;
}
.export-buttons {
display: flex;
gap: 10px;
margin-top: 20px;
flex-wrap: wrap;
}
.export-btn {
background: #27ae60;
color: white;
border: none;
padding: 12px 20px;
border-radius: var(--radius);
font-size: 16px;
cursor: pointer;
transition: var(--transition);
display: inline-flex;
align-items: center;
gap: 8px;
white-space: nowrap;
}
.export-btn:hover {
background: #219653;
transform: translateY(-2px);
box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
}
.export-btn.excel {
background: #27ae60;
}
.export-btn.excel:hover {
background: #2ecc71;
}
.export-btn.image {
background: #2980b9;
}
.export-btn.image:hover {
background: #3498db;
}
.form-images-container {
margin-top: 20px;
padding: 15px;
background: #f8f9fa;
border-radius: var(--radius);
border-left: 4px solid var(--secondary);
}
.form-images-title {
font-weight: bold;
margin-bottom: 10px;
color: var(--primary);
display: flex;
align-items: center;
gap: 8px;
}
.form-images-grid {
display: grid;
grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
gap: 10px;
margin-top: 10px;
}
.form-image-item {
border: 1px solid #ddd;
border-radius: 5px;
overflow: hidden;
height: 100px;
}
.form-image-item img {
width: 100%;
height: 100%;
object-fit: cover;
}
.market-preview {
margin-top: 15px;
padding: 15px;
background: white;
border-radius: var(--radius);
box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}
.market-preview h4 {
color: var(--dark);
margin-bottom: 10px;
padding-bottom: 10px;
border-bottom: 1px solid #eee;
}
.market-preview table {
width: 100%;
border-collapse: collapse;
}
.market-preview th {
background: var(--light);
padding: 8px;
font-weight: bold;
}
.market-preview td {
padding: 8px;
border-bottom: 1px solid #eee;
}
/* Ø£Ù†Ù…Ø§Ø· Ø¬Ø¯ÙŠØ¯Ø© Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ù…Ø­Ø³Ù† */
.search-icon {
position: relative;
display: inline-block;
}
.search-icon-btn {
background: var(--light);
border: none;
border-radius: 50%;
width: 40px;
height: 40px;
display: flex;
align-items: center;
justify-content: center;
cursor: pointer;
transition: var(--transition);
box-shadow: var(--shadow);
}
.search-icon-btn:hover {
background: var(--secondary);
color: white;
}
.search-dropdown {
position: absolute;
top: 50px;
right: 0;
background: white;
border-radius: var(--radius);
box-shadow: var(--shadow);
padding: 20px;
width: 350px;
z-index: 100;
display: none;
opacity: 0;
transform: translateY(-10px);
transition: all 0.3s ease;
}
.search-dropdown.active {
display: block;
opacity: 1;
transform: translateY(0);
animation: fadeIn 0.3s ease;
}
.search-dropdown .form-group {
margin-bottom: 15px;
}
.search-dropdown .form-group label {
font-size: 14px;
}
.search-dropdown .form-group input {
padding: 10px;
font-size: 14px;
}
.search-dropdown .btn-group {
margin-top: 10px;
}
.search-dropdown .btn {
padding: 10px 15px;
font-size: 14px;
}
.search-dropdown .form-type-filter {
margin-top: 15px;
margin-bottom: 10px;
}
/* Ø£Ù†Ù…Ø§Ø· Ø¬Ø¯ÙŠØ¯Ø© Ù„Ù„ØªØ­Ø°ÙŠØ± */
.duplicate-warning {
background-color: #fff8e1;
border-left: 4px solid #ff9800;
padding: 10px 15px;
margin-top: 10px;
border-radius: 4px;
display: none;
}
.duplicate-warning.show {
display: block;
}
.duplicate-warning i {
color: #ff9800;
margin-left: 5px;
}
/* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø¬Ø¯ÙŠØ¯Ø© */
.loading-overlay {
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
background: rgba(0, 0, 0, 0.7);
display: flex;
justify-content: center;
align-items: center;
z-index: 2000;
display: none;
}
.loading-spinner {
width: 60px;
height: 60px;
border: 5px solid rgba(255, 255, 255, 0.3);
border-radius: 50%;
border-top-color: white;
animation: spin 1s ease-in-out infinite;
}
.loading-text {
color: white;
margin-top: 20px;
font-size: 18px;
}
.unit-filters {
display: flex;
gap: 15px;
margin-bottom: 20px;
flex-wrap: wrap;
}
.filter-btn {
padding: 8px 15px;
background: #f8f9fa;
border: 1px solid #ddd;
border-radius: 50px;
cursor: pointer;
transition: var(--transition);
}
.filter-btn.active {
background: var(--secondary);
color: white;
border-color: var(--secondary);
}
.unit-rating {
display: flex;
gap: 5px;
margin-top: 10px;
}
.unit-rating .star {
color: #ddd;
cursor: pointer;
transition: color 0.2s;
}
.unit-rating .star.active {
color: #ffc107;
}
.unit-stats {
display: grid;
grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
gap: 10px;
margin-top: 15px;
}
.stat-item {
background: #f8f9fa;
padding: 10px;
border-radius: 8px;
text-align: center;
}
.stat-label {
font-size: 12px;
color: var(--dark);
}
.stat-value {
font-weight: bold;
font-size: 14px;
}
/* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© */
@media print {
body * {
visibility: hidden;
}
.app-section.active,
.app-section.active * {
visibility: visible;
}
.app-section.active {
position: absolute;
left: 0;
top: 0;
width: 100%;
margin: 0;
padding: 0;
box-shadow: none;
}
header, .app-nav, footer, .btn-group, .export-buttons, .tab-container .tabs {
display: none !important;
}
.official-form {
page-break-inside: avoid;
page-break-after: auto;
}
.official-form table {
min-width: 100% !important;
font-size: 12px;
}
.official-form th,
.official-form td {
padding: 8px 10px !important;
}
}
@media (max-width: 768px) {
.form-row {
flex-direction: column;
gap: 0;
}
header h1 {
font-size: 1.8rem;
}
.nav-btn {
padding: 10px 15px;
font-size: 14px;
}
.value-amount {
font-size: 2rem;
}
.btn-group {
flex-direction: column;
}
.btn-group .btn {
width: 100%;
justify-content: center;
}
.unit-values {
grid-template-columns: 1fr;
}
.section-title {
flex-direction: column;
align-items: flex-start;
}
.record32-info {
grid-template-columns: 1fr;
}
.record32-actions {
flex-direction: column;
}
#map {
height: 300px;
}
.coordinates-container {
flex-direction: column;
}
.official-form .signature-row {
flex-direction: column;
gap: 15px;
}
.official-form .signature-box {
width: 100%;
}
.decision-details {
flex-direction: column;
}
.signature-row {
flex-direction: column;
align-items: center;
}
.search-filters {
grid-template-columns: 1fr;
}
.search-results table {
min-width: 700px;
}
.search-actions {
flex-direction: column;
}
.export-buttons {
flex-direction: column;
}
.search-dropdown {
width: 280px;
right: -40px;
}
.unit-stats {
grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
}
}
/* Ø£Ø²Ø±Ø§Ø± Ø§Ù„ÙˆØ­Ø¯Ø§Øª ÙˆØ§Ù„ØªÙ‚ÙŠÙŠÙ… */
#units-section .btn,
#valuation-section .btn {
padding: 8px 18px; /* Ø­Ø¬Ù… Ù…ØªÙˆØ³Ø· */
font-size: 14px;
border-radius: 8px;
min-width: 120px;
}
/* ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ù„Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù‡Ø§Ù…Ø© */
#units-section .btn-success,
#valuation-section .btn-success {
background: var(--success);
color: white;
}
#units-section .btn-success:hover,
#valuation-section .btn-success:hover {
background: #219653;
}
#units-section .btn,
#valuation-section .btn {
background: var(--secondary);
color: white;
}
#units-section .btn:hover,
#valuation-section .btn:hover {
background: #2980b9;
}
/* ØªÙˆØ­ÙŠØ¯ Ø­Ø¬Ù… Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª */
#units-section .btn i,
#valuation-section .btn i {
font-size: 13px;
}
/* ØªÙƒØ¨ÙŠØ± Ø®Ø§Ù†Ø© Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø³ÙˆÙ‚ÙŠØ© */
#units-section #manual-market-value {
padding: 14px;
font-size: 18px;
border: 2px solid var(--secondary);
border-radius: var(--radius);
width: 100%;
box-shadow: 0 2px 6px rgba(0,0,0,0.05);
}
/* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© */
.search-results-container {
margin-top: 20px;
background: #fff;
border-radius: var(--radius);
box-shadow: var(--shadow);
padding: 20px;
}
.search-results-header {
display: flex;
justify-content: space-between;
align-items: center;
margin-bottom: 20px;
padding-bottom: 15px;
border-bottom: 1px solid #eee;
}
.results-count {
background: var(--secondary);
color: white;
padding: 5px 10px;
border-radius: 20px;
font-size: 14px;
}
.property-card {
border: 1px solid #eee;
border-radius: var(--radius);
padding: 15px;
margin-bottom: 15px;
transition: var(--transition);
cursor: pointer;
}
.property-card:hover {
transform: translateY(-3px);
box-shadow: 0 5px 15px rgba(0,0,0,0.1);
}
.property-card h3 {
color: var(--primary);
margin-bottom: 10px;
display: flex;
align-items: center;
gap: 10px;
}
.property-card .property-id {
background: var(--dark);
color: white;
padding: 3px 8px;
border-radius: 4px;
font-size: 14px;
}
.property-info {
display: grid;
grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
gap: 10px;
margin-top: 10px;
}
.info-item {
display: flex;
gap: 5px;
}
.info-label {
font-weight: bold;
color: var(--dark);
}
/* Ø£Ù†Ù…Ø§Ø· Ø¬Ø¯ÙŠØ¯Ø© Ù„Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯ ÙˆØ§Ù„Ø¯Ù…Ø¬ */
.import-section {
margin-top: 25px;
padding: 20px;
background: #f8f9fa;
border-radius: var(--radius);
border-left: 4px solid var(--warning);
}
.import-section h3 {
color: var(--warning);
margin-bottom: 15px;
display: flex;
align-items: center;
gap: 8px;
}
.import-options {
display: flex;
gap: 15px;
margin-top: 15px;
flex-wrap: wrap;
}
.import-option {
background: white;
border: 1px solid #ddd;
border-radius: var(--radius);
padding: 15px;
flex: 1;
min-width: 250px;
text-align: center;
cursor: pointer;
transition: var(--transition);
}
.import-option:hover {
transform: translateY(-3px);
box-shadow: 0 5px 15px rgba(0,0,0,0.1);
border-color: var(--secondary);
}
.import-option i {
font-size: 2.5rem;
color: var(--secondary);
margin-bottom: 10px;
}
.merge-status {
margin-top: 20px;
padding: 15px;
background: #e8f5e9;
border-radius: var(--radius);
display: none;
}
.merge-status.visible {
display: block;
}
.merge-stats {
display: grid;
grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
gap: 15px;
margin-top: 15px;
}
.merge-stat {
background: white;
border-radius: var(--radius);
padding: 15px;
text-align: center;
box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}
.merge-stat .number {
font-size: 1.8rem;
font-weight: bold;
color: var(--primary);
margin: 5px 0;
}
.merge-stat .label {
font-size: 14px;
color: var(--dark);
}
/* Ø¥Ø¶Ø§ÙØ© Ù…Ø¤Ø´Ø± Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„ */
.connection-status {
position: fixed;
bottom: 20px;
right: 20px;
padding: 10px 20px;
border-radius: 20px;
font-weight: bold;
z-index: 1000;
box-shadow: 0 2px 10px rgba(0,0,0,0.2);
display: flex;
align-items: center;
gap: 8px;
transition: all 0.3s ease;
}
.connection-status.online {
background: #27ae60;
color: white;
}
.connection-status.offline {
background: #e74c3c;
color: white;
}

.count-badge {
  background: #e74c3c;
  color: white;
  padding: 3px 8px;
  border-radius: 12px;
  font-size: 13px;
  margin-right: 8px;
}


/* Ø§Ù„ØªÙ…ÙŠÙŠØ² Ø¨ÙŠÙ† Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª */
.saved-property {
  background-color: #e8f5e9; /* Ø£Ø®Ø¶Ø± ÙØ§ØªØ­ */
}
.imported-property {
  background-color: #fff3e0; /* Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ ÙØ§ØªØ­ */
}
.property-badge {
  display: inline-block;
  padding: 3px 8px;
  border-radius: 8px;
  font-size: 12px;
  font-weight: bold;
  color: white;
}
.badge-saved {
  background: #27ae60; /* Ø£Ø®Ø¶Ø± */
}
.badge-imported {
  background: #e67e22; /* Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ */
}

</style>
<style>
/* Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù†Ù…Ø§Ø· ØªØ¨Ù‚Ù‰ ÙƒÙ…Ø§ Ù‡ÙŠ */
/* ... (Ø¬Ù…ÙŠØ¹ Ø£Ù†Ù…Ø§Ø· CSS Ø§Ù„Ø­Ø§Ù„ÙŠØ©) ... */

/* Ø£Ù†Ù…Ø§Ø· Ø¬Ø¯ÙŠØ¯Ø© Ù„Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø­Ø³Ø¨ Ø§Ù„Ø´Ø§Ø±Ø¹ */
.street-stats-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
  flex-wrap: wrap;
  gap: 15px;
}

.street-filter {
  display: flex;
  align-items: center;
  gap: 10px;
}

.street-filter input {
  padding: 10px 15px;
  border: 1px solid #ddd;
  border-radius: var(--radius);
  min-width: 250px;
}

.street-summary-cards {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 15px;
  margin-bottom: 20px;
}

.street-summary-card {
  background: white;
  border-radius: var(--radius);
  padding: 15px;
  text-align: center;
  box-shadow: var(--shadow);
  border-left: 4px solid var(--secondary);
}

.street-summary-card h3 {
  color: var(--dark);
  margin-bottom: 10px;
  font-size: 1rem;
}

.street-summary-value {
  font-size: 1.5rem;
  font-weight: bold;
  color: var(--primary);
}

.street-stats-table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 20px;
}

.street-stats-table th {
  background-color: var(--primary);
  color: white;
  padding: 12px 15px;
  text-align: center;
}

.street-stats-table td {
  padding: 12px 15px;
  border-bottom: 1px solid #eee;
  text-align: center;
}

.street-stats-table tr:hover {
  background-color: rgba(52, 152, 219, 0.05);
}

.street-actions {
  display: flex;
  gap: 10px;
  justify-content: center;
}

.street-actions button {
  padding: 5px 10px;
  font-size: 14px;
}

@media (max-width: 768px) {
  .street-stats-header {
    flex-direction: column;
    align-items: flex-start;
  }
  
  .street-filter {
    width: 100%;
  }
  
  .street-filter input {
    width: 100%;
  }
  
  .street-summary-cards {
    grid-template-columns: 1fr 1fr;
  }
}
</style></head>
<body>
<!-- Ù…Ø¤Ø´Ø± Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„ -->
<div class="connection-status" id="connection-status">
<i class="fas fa-wifi"></i>
<span>Ù…ØªØµÙ„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª</span>
</div>
<div class="container">
<header>
<h1><i class="fas fa-building"></i> ØªØ·Ø¨ÙŠÙ‚ Ø­ØµØ± ÙˆØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¶Ø±Ø§Ø¦Ø¨ Ø§Ù„Ø¹Ù‚Ø§Ø±ÙŠØ©</h1>
<p>ØªØ·Ø¨ÙŠÙ‚ Ù…ØªÙƒØ§Ù…Ù„ Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§ØªØŒ ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø±Ø§Øª Ø§Ù„Ø±Ø³Ù…ÙŠØ©ØŒ ÙˆØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø¶Ø±Ø§Ø¦Ø¨ Ø§Ù„Ø¹Ù‚Ø§Ø±ÙŠØ© Ø¨ÙƒÙ„ Ø¯Ù‚Ø©</p>
</header>
<div class="app-nav">
<button class="nav-btn active" data-target="property-section"><i class="fas fa-home"></i> Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù‚Ø§Ø±</button>
<button class="nav-btn" data-target="units-section"><i class="fas fa-layer-group"></i> ÙˆØ­Ø¯Ø§Øª Ø§Ù„Ø¹Ù‚Ø§Ø±</button>
<button class="nav-btn" data-target="valuation-section"><i class="fas fa-chart-line"></i> Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø¹Ù‚Ø§Ø±ÙŠ</button>
<button class="nav-btn" data-target="official-forms-section"><i class="fas fa-file-alt"></i> Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø±Ø§Øª Ø§Ù„Ø±Ø³Ù…ÙŠØ©</button>
<button class="nav-btn" data-target="addition-section"><i class="fas fa-file-contract"></i> Ù‚Ø±Ø§Ø± Ø§Ù„Ø¥Ø¶Ø§ÙØ©</button>
<button class="nav-btn" data-target="map-section"><i class="fas fa-map-marked-alt"></i> Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ø¹Ù‚Ø§Ø±ÙŠØ©</button>
<button class="nav-btn" data-target="stats-section"><i class="fas fa-chart-pie"></i> Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</button></div>
<!-- Property Section -->
<section class="app-section active" id="property-section">
<div class="section-title">
<h2><i class="fas fa-home"></i> Ø¥Ø¯Ø®Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù‚Ø§Ø±</h2>
<div class="search-icon">
<button class="search-icon-btn" id="property-search-btn">
<i class="fas fa-search"></i>
</button>
<div class="search-dropdown" id="property-search-dropdown">
<div class="form-container">
<div class="form-group">
<label>Ø±Ù‚Ù… Ø§Ù„Ø¹Ù‚Ø§Ø±</label>
<input id="property-search-number" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¹Ù‚Ø§Ø±ÙŠ" type="text"/>
</div>
<div class="form-group">
<label>Ø§Ù„Ø´Ø§Ø±Ø¹</label>
<input id="property-search-street" placeholder="Ø§Ø³Ù… Ø§Ù„Ø´Ø§Ø±Ø¹" type="text"/>
</div>
<div class="form-group">
<label>Ø§Ù„Ø­Ù‰ / Ø§Ù„Ù‚Ø±ÙŠØ©</label>
<input id="property-search-district" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø£Ùˆ Ø§Ù„Ù‚Ø±ÙŠØ©" type="text"/>
</div>
</div>
<div class="btn-group">
<button class="btn" id="reset-property-search">
<i class="fas fa-eraser"></i> Ù…Ø³Ø­ Ø§Ù„Ø¨Ø­Ø«
</button>
<button class="btn btn-success" id="search-property">
<i class="fas fa-search"></i> Ø¨Ø­Ø«
</button>
</div>
</div>
</div>
<div class="export-buttons">
<button class="export-btn excel" id="export-backup-all">
<i class="fas fa-download"></i> Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© ÙƒØ§Ù…Ù„Ø© (Excel)
</button>
<button class="export-btn" id="import-properties" style="background-color: #8e44ad;">
<i class="fas fa-file-import"></i> Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø¹Ù‚Ø§Ø±Ø§Øª
</button>
<button class="export-btn" id="show-saved-properties" style="background-color: #16a085;">
<i class="fas fa-building"></i> Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© ÙˆØ§Ù„Ù…Ø³ØªÙˆØ±Ø¯Ø© <span class="count-badge" id="properties-count">0</span>
</button>
</div>
</div>
<div class="form-container">
<div>
<div class="form-group">
<label>Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¹Ù‚Ø§Ø±ÙŠ</label>
<input id="property-number" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¹Ù‚Ø§Ø±ÙŠ" type="text"/>
<div class="duplicate-warning" id="duplicate-warning">
<i class="fas fa-exclamation-triangle"></i>
ÙŠÙˆØ¬Ø¯ Ø¹Ù‚Ø§Ø± Ø¢Ø®Ø± Ø¨Ù†ÙØ³ Ø§Ù„Ø±Ù‚Ù… ÙÙŠ Ù†ÙØ³ Ø§Ù„Ø´Ø§Ø±Ø¹
</div>
</div>
<!-- Ø¥Ø¶Ø§ÙØ© Ø­Ù‚Ù„ Ø±Ù‚Ù… Ø§Ù„Ø¹Ù‚Ø§Ø± Ø§Ù„Ø³Ø§Ø¨Ù‚ -->
<div class="form-group">
<label>Ø±Ù‚Ù… Ø§Ù„Ø¹Ù‚Ø§Ø± Ø§Ù„Ø³Ø§Ø¨Ù‚</label>
<input id="previous-property-number" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¹Ù‚Ø§Ø±ÙŠ Ø§Ù„Ø³Ø§Ø¨Ù‚" type="text"/>
</div>
<div class="form-group">
<label>Ø§Ù„Ø´Ø§Ø±Ø¹</label>
<input id="street" placeholder="Ø§Ø³Ù… Ø§Ù„Ø´Ø§Ø±Ø¹" type="text"/>
</div>
<div class="form-group">
<label>Ø¹Ø±Ø¶ Ø§Ù„Ø´Ø§Ø±Ø¹ (Ù…ØªØ±)</label>
<input id="street-width" placeholder="Ø¹Ø±Ø¶ Ø§Ù„Ø´Ø§Ø±Ø¹ Ø¨Ø§Ù„Ù…ØªØ±" type="number"/>
</div>
<div class="form-group">
<label>Ø§Ù„Ø­Ù‰ / Ø§Ù„Ù‚Ø±ÙŠØ©</label>
<input id="district" placeholder="Ø§Ù„Ø­Ù‰ Ø£Ùˆ Ø§Ù„Ù‚Ø±ÙŠØ©" type="text"/>
</div>
<div class="form-group">
<label>Ø§Ù„Ù…Ø±ÙƒØ² / Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</label>
<input id="city" placeholder="Ø§Ù„Ù…Ø±ÙƒØ² Ø£Ùˆ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©" type="text"/>
</div>
<div class="form-group">
<label>Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©</label>
<input id="governorate" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©" type="text"/>
</div>
<div class="form-group">
<label>Ø·Ø¨ÙŠØ¹Ø© Ø§Ù„Ù…ÙƒØ§Ù†</label>
<select id="location-type">
  <option value="village">Ù‚Ø±ÙŠØ©</option>
  <option value="compound">Ø¹Ø²Ø¨Ø©</option>
  <option value="city">Ù…Ø¯ÙŠÙ†Ø©</option>
  <option value="major_city">Ù…Ø¯ÙŠÙ†Ø© Ø±Ø¦ÙŠØ³ÙŠØ©</option>
</select>
</div>
<div class="form-row">
<div class="form-group">
<label>Ø³Ù†Ø© Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡</label>
<input id="construction-year" placeholder="Ø³Ù†Ø© Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡" type="number"/>
</div>
<div class="form-group">
<label>Ù…Ø§Ø¯Ø© Ø§Ù„Ø¨Ù†Ø§Ø¡</label>
<select id="building-material">
<option value="brick">Ø·ÙˆØ¨ Ø£Ø­Ù…Ø±</option>
<option value="sand_brick">Ø·ÙˆØ¨ Ø±Ù…Ù„ÙŠ</option>
<option selected="" value="concrete">Ø®Ø±Ø³Ø§Ù†Ø© Ù…Ø³Ù„Ø­Ø©</option>
<option value="stone">Ø­Ø¬Ø±</option>
<option value="mud_brick">Ø·ÙˆØ¨ Ù„Ø¨Ù†</option>
<option value="other">Ø£Ø®Ø±Ù‰</option>
</select>
</div>
</div>
<div class="form-group gps-container">
<label>Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª (Ø®Ø· Ø§Ù„Ø·ÙˆÙ„ØŒ Ø®Ø· Ø§Ù„Ø¹Ø±Ø¶)</label>
<div class="coordinates-container">
<input id="coordinates" placeholder="Ù…Ø«Ø§Ù„: 30.0444, 31.2357" type="text"/>
<button class="btn" id="get-gps" style="padding: 0 15px;">
<span class="gps-loader" id="gps-loader"></span>
<i class="fas fa-location-arrow"></i>
</button>
</div>
<div class="gps-status" id="gps-status"></div>
<small>ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø³ØªØ®Ø¯Ø§Ù… <a href="https://www.google.com/maps" target="_blank">Ø®Ø±Ø§Ø¦Ø· Ø¬ÙˆØ¬Ù„</a> Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª</small>
</div>
<div class="form-group">
<label>Ø§Ø³Ù… Ø§Ù„Ù…ÙƒÙ„Ù</label>
<input id="responsible-name" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…ÙƒÙ„Ù" type="text"/>
</div>
</div>
<div>
<div class="form-group">
<label>Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ù„Ùƒ</label>
<input id="owner" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ù„Ùƒ" type="text"/>
</div>
<!-- Ø¥Ø¶Ø§ÙØ© Ø­Ù‚Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ Ù„Ù„Ù…Ø§Ù„Ùƒ -->
<div class="form-group">
<label>Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ Ù„Ù„Ù…Ø§Ù„Ùƒ</label>
<input id="owner-national-id" placeholder="Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ Ù„Ù„Ù…Ø§Ù„Ùƒ" type="text"/>
</div>
<div class="form-row">
<div class="form-group">
<label>Ø§Ù„Ù…Ø³Ø§Ø­Ø© (Ù…Â²)</label>
<input id="area" placeholder="Ø§Ù„Ù…Ø³Ø§Ø­Ø© Ø¨Ø§Ù„Ù…ØªØ± Ø§Ù„Ù…Ø±Ø¨Ø¹" type="number"/>
</div>
<div class="form-group">
<label>Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¯ÙˆØ§Ø±</label>
<input id="floors" placeholder="Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¯ÙˆØ§Ø±" type="number"/>
</div>
</div>
<div class="form-row">
<div class="form-group">
<label>Ø¹Ø¯Ø¯ Ø§Ù„ÙˆØ­Ø¯Ø§Øª</label>
<input id="units-count" placeholder="Ø¹Ø¯Ø¯ Ø§Ù„ÙˆØ­Ø¯Ø§Øª" type="number"/>
</div>
<div class="form-group">
<label>Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù‚Ø§Ø±</label>
<select id="property-type">
<option value="residential">Ø³ÙƒÙ†ÙŠ</option>
<option value="commercial">ØªØ¬Ø§Ø±ÙŠ</option>
<option value="mixed">Ù…Ø®ØªÙ„Ø·</option>
<option value="agricultural">Ø²Ø±Ø§Ø¹ÙŠ</option>
<option value="space">ÙØ¶Ø§Ø¡</option>
<option value="utilized_space">ÙØ¶Ø§Ø¡ Ù…Ø³ØªØºÙ„</option>
<option value="educational">ØªØ¹Ù„ÙŠÙ…ÙŠ</option>
<option value="health">ØµØ­ÙŠ</option>
<option value="under_completion">ØªØ­Øª Ø§Ù„Ø¥ØªÙ…Ø§Ù…</option>
</select>
</div>
</div>
<div class="form-group">
<label>Ø§Ù„ÙˆØµÙ Ø§Ù„ØªÙØµÙŠÙ„ÙŠ Ù„Ù„Ø¹Ù‚Ø§Ø±</label>
<textarea id="detailed-description" placeholder="ÙˆØµÙ ØªÙØµÙŠÙ„ÙŠ Ù„Ù„Ø¹Ù‚Ø§Ø±"></textarea>
</div>
<div class="form-group">
<label>ØµÙˆØ± Ø§Ù„Ø¹Ù‚Ø§Ø±</label>
<input accept="image/*" id="property-images" multiple="" type="file"/>
<div class="image-preview" id="image-preview"></div>
</div>
<div class="form-group">
<label>Ù…Ø³ØªÙ†Ø¯Ø§Øª Ø§Ù„Ø¹Ù‚Ø§Ø±</label>
<input id="property-documents" multiple="" type="file"/>
<div id="documents-preview"></div>
</div>
</div>
</div>
<div class="btn-group">
<button class="btn btn-success" id="save-property">
<i class="fas fa-save"></i> Ø­ÙØ¸ Ø§Ù„Ø¹Ù‚Ø§Ø±
</button>
<button class="btn" id="reset-form">
<i class="fas fa-eraser"></i> Ù…Ø³Ø­ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
</button>
<button class="btn" id="delete-property">
<i class="fas fa-trash"></i> Ø­Ø°Ù Ø§Ù„Ø¹Ù‚Ø§Ø±
</button>
</div>
<div class="export-buttons">
<button class="export-btn excel" id="export-property-excel">
<i class="fas fa-file-excel"></i> ØªØµØ¯ÙŠØ± Excel
</button>
</div>
<!-- Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© -->
<div id="saved-properties-modal" style="display:none; position:fixed; top:50%; left:50%; transform:translate(-50%,-50%);
background:#fff; border:2px solid #333; padding:20px; z-index:1000; border-radius:8px; box-shadow:0 0 15px rgba(0,0,0,0.5); width:80%; max-width:900px; max-height:80vh; overflow:auto;">
<h3 style="margin-top:0; text-align:center;"><i class="fas fa-building"></i> Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© ÙˆØ§Ù„Ù…Ø³ØªÙˆØ±Ø¯Ø©</h3>
<div class="table-responsive">
<div id="saved-properties-search" style="margin-bottom:15px; text-align:right;"><label>ğŸ” Ø¨Ø­Ø«: </label><input id="saved-properties-search-input" placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø±Ù‚Ù… Ø§Ù„Ø¹Ù‚Ø§Ø± Ø£Ùˆ Ø§Ù„Ø´Ø§Ø±Ø¹ Ø£Ùˆ Ø§Ù„Ù…Ù†Ø·Ù‚Ø© ..." style="padding:8px; width:50%; border:1px solid #ccc; border-radius:5px;" type="text"/></div><table style="width:100%;">
<thead>
<tr>
<th>Ø±Ù‚Ù… Ø§Ù„Ø¹Ù‚Ø§Ø±</th>
<th>Ø§Ù„Ø´Ø§Ø±Ø¹</th>
<th>Ø§Ù„Ù…Ù†Ø·Ù‚Ø©/Ø§Ù„Ù‚Ø±ÙŠØ©</th>
<th>Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©/Ø§Ù„Ù…Ø±ÙƒØ²</th>
<th>Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©</th>
<th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ø¶Ø§ÙØ©</th>
<th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
<th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
</tr>
</thead>
<tbody id="saved-properties-table">
<!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡ Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
</tbody>
</table>
</div>
<div style="text-align:center; margin-top:20px;">
<button class="btn" id="close-saved-properties" style="padding:10px 20px;">
<i class="fas fa-times"></i> Ø¥ØºÙ„Ø§Ù‚
</button>
</div>
</div>
<!-- Ù‚Ø³Ù… Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯ ÙˆØ§Ù„Ø¯Ù…Ø¬ -->
<div class="import-section">
<h3><i class="fas fa-file-import"></i> Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª ÙˆØ¯Ù…Ø¬Ù‡Ø§</h3>
<p>ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù…Ù„Ù Excel ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª ÙˆØ¯Ù…Ø¬Ù‡Ø§ Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ© ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…</p>
<div class="import-options">
<div class="import-option" id="import-merge">
<i class="fas fa-object-group"></i>
<h4>Ø¯Ù…Ø¬ Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª</h4>
<p>Ø¯Ù…Ø¬ Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø³ØªÙˆØ±Ø¯Ø© Ù…Ø¹ Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ù…Ø¹ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙƒØ±Ø§Ø±Ø§Øª</p>
</div>
<div class="import-option" id="import-replace">
<i class="fas fa-exchange-alt"></i>
<h4>Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª</h4>
<p>Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ø¨Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø³ØªÙˆØ±Ø¯Ø©</p>
</div>
<div class="import-option" id="import-add">
<i class="fas fa-plus-circle"></i>
<h4>Ø¥Ø¶Ø§ÙØ© Ø¬Ø¯ÙŠØ¯Ø© ÙÙ‚Ø·</h4>
<p>Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ÙÙ‚Ø· Ù…Ø¹ ØªØ¬Ø§Ù‡Ù„ Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª Ø§Ù„Ù…ÙƒØ±Ø±Ø©</p>
</div>
</div>
<div class="merge-status" id="merge-status">
<h4><i class="fas fa-sync-alt"></i> Ù†ØªÙŠØ¬Ø© Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø¯Ù…Ø¬</h4>
<div class="merge-stats">
<div class="merge-stat">
<div class="number" id="imported-count">0</div>
<div class="label">Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø³ØªÙˆØ±Ø¯Ø©</div>
</div>
<div class="merge-stat">
<div class="number" id="added-count">0</div>
<div class="label">ØªÙ…Øª Ø¥Ø¶Ø§ÙØªÙ‡Ø§</div>
</div>
<div class="merge-stat">
<div class="number" id="updated-count">0</div>
<div class="label">ØªÙ… ØªØ­Ø¯ÙŠØ«Ù‡Ø§</div>
</div>
<div class="merge-stat">
<div class="number" id="duplicate-count">0</div>
<div class="label">Ù…ÙƒØ±Ø±Ø© (ØªÙ… ØªØ®Ø·ÙŠÙ‡Ø§)</div>
</div>
</div>
<div class="btn-group" style="margin-top: 20px;">
<button class="btn btn-success" id="confirm-merge">
<i class="fas fa-check"></i> ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¯Ù…Ø¬
</button>
<button class="btn btn-danger" id="cancel-merge">
<i class="fas fa-times"></i> Ø¥Ù„ØºØ§Ø¡
</button>
</div>
</div>
</div>
</section>
<!-- Units Section -->
<section class="app-section" id="units-section">
<div class="section-title">
<h2><i class="fas fa-layer-group"></i> Ø¥Ø¯Ø§Ø±Ø© ÙˆØ­Ø¯Ø§Øª Ø§Ù„Ø¹Ù‚Ø§Ø±</h2>
<div class="unit-filters">
<div class="filter-btn active" data-filter="all">Ø§Ù„ÙƒÙ„</div>
<div class="filter-btn" data-filter="residential">Ø³ÙƒÙ†ÙŠØ©</div>
<div class="filter-btn" data-filter="commercial">ØªØ¬Ø§Ø±ÙŠØ©</div>
<div class="filter-btn" data-filter="space">ÙØ¶Ø§Ø¡</div>
</div>
</div>
<div class="form-container">
<div>
<div class="form-row">
<div class="form-group">
<label>Ø±Ù‚Ù… Ø§Ù„Ø¯ÙˆØ±</label>
<input id="unit-floor" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø¯ÙˆØ±" type="number"/>
</div>
<div class="form-group">
<label>Ø±Ù‚Ù… Ø§Ù„ÙˆØ­Ø¯Ø©</label>
<input id="unit-number" placeholder="Ø±Ù‚Ù… Ø§Ù„ÙˆØ­Ø¯Ø©" type="text"/>
</div>
<div class="form-group">
<label>Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ù„Ùƒ</label>
<input id="unit-owner" placeholder="Ù…Ø§Ù„Ùƒ Ø§Ù„ÙˆØ­Ø¯Ø©" type="text"/>
</div>
</div>
<!-- Ø¥Ø¶Ø§ÙØ© Ø­Ù‚Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ Ù„Ù„Ù…Ø§Ù„Ùƒ Ù„Ù„ÙˆØ­Ø¯Ø© -->
<div class="form-group">
<label>Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ Ù„Ù„Ù…Ø§Ù„Ùƒ</label>
<input id="unit-owner-national-id" placeholder="Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ Ù„Ù„Ù…Ø§Ù„Ùƒ" type="text"/>
</div>
<div class="form-group">
<label>Ù…Ø³Ø§Ø­Ø© Ø§Ù„ÙˆØ­Ø¯Ø© (Ù…Â²)</label>
<input id="unit-area" placeholder="Ù…Ø³Ø§Ø­Ø© Ø§Ù„ÙˆØ­Ø¯Ø©" type="number"/>
</div>
<div class="form-row">
<div class="form-group">
<label>Ø­Ø§Ù„Ø© Ø§Ù„ÙˆØ­Ø¯Ø©</label>
<select id="unit-status">
<option value="complete">ØªØ§Ù…Ø©</option>
<option value="incomplete">ØºÙŠØ± ØªØ§Ù…Ø©</option>
<option value="occupied">Ù…Ø´ØºÙˆÙ„Ø© Ø¹Ù„Ù‰ ØºÙŠØ± Ø§ØªÙ…Ø§Ù…</option>
</select>
</div>
<div class="form-group">
<label>Ù†ÙˆØ¹ Ø§Ù„Ø§Ø³ØªØºÙ„Ø§Ù„</label>
<select id="unit-use-type">
<option value="residential">Ø³ÙƒÙ†ÙŠ</option>
<option value="commercial">ØªØ¬Ø§Ø±ÙŠ</option>
<option value="administrative">Ø¥Ø¯Ø§Ø±ÙŠ</option>
<option value="space">ÙØ¶Ø§Ø¡</option>
<option value="utilized_space">ÙØ¶Ø§Ø¡ Ù…Ø³ØªØºÙ„</option>
<option value="educational">ØªØ¹Ù„ÙŠÙ…ÙŠ</option>
<option value="health">ØµØ­ÙŠ</option>
<option value="under_completion">ØªØ­Øª Ø§Ù„Ø¥ØªÙ…Ø§Ù…</option>
</select>
</div>
</div>
</div>
<div>
<div class="form-row">
<div class="form-group">
<label>Ù†ÙˆØ¹ Ø§Ù„ÙˆØ­Ø¯Ø©</label>
<select id="unit-type">
<option value="apartment">Ø´Ù‚Ø©</option>
<option value="duplex">Ø¯ÙˆØ¨Ù„ÙƒØ³</option>
<option value="villa">ÙÙŠÙ„Ø§</option>
<option value="shop">Ù…Ø­Ù„</option>
<option value="warehouse">Ù…Ø®Ø²Ù†</option>
<option value="workshop">ÙˆØ±Ø´Ø©</option>
<option value="clinic">Ø¹ÙŠØ§Ø¯Ø©</option>
<option value="office">Ù…ÙƒØªØ¨</option>
<option value="space">ÙØ¶Ø§Ø¡</option>
<option value="utilized_space">ÙØ¶Ø§Ø¡ Ù…Ø³ØªØºÙ„</option>
</select>
</div>
<div class="form-group">
<label>Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªØ´Ø·ÙŠØ¨</label>
<select id="unit-finishing">
<option value="none">Ø¨Ø¯ÙˆÙ†</option>
<option value="basic">Ø¹Ø§Ø¯ÙŠ</option>
<option selected="" value="medium">Ù…ØªÙˆØ³Ø·</option>
<option value="high">Ø¹Ø§Ù„ÙŠ</option>
<option value="luxury">ÙØ§Ø®Ø±</option>
</select>
</div>
</div>
<div class="form-group">
<label>Ø§Ø³Ù… Ø§Ù„Ø´Ø§ØºÙ„ (Ø¥Ù† ÙˆØ¬Ø¯)</label>
<input id="unit-occupant" placeholder="Ø§Ø³Ù… Ø§Ù„Ø´Ø§ØºÙ„" type="text"/>
</div>
<!-- Ø¥Ø¶Ø§ÙØ© Ø­Ù‚Ù„ Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„Ø¬Ø¯ÙŠØ¯ -->
<div class="form-group">
<label>Ø§Ù„Ù†Ø´Ø§Ø· (Ù†ÙˆØ¹ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…)</label>
<input id="unit-activity" placeholder="Ù…Ø«Ø§Ù„: Ù…Ø­Ù„Ø§Øª ØªØ¬Ø§Ø±ÙŠØ©ØŒ Ù…Ø®Ø§Ø²Ù†" type="text"/>
</div>
<div class="unit-rating">
<div class="star" data-rating="1"><i class="fas fa-star"></i></div>
<div class="star" data-rating="2"><i class="fas fa-star"></i></div>
<div class="star" data-rating="3"><i class="fas fa-star"></i></div>
<div class="star" data-rating="4"><i class="fas fa-star"></i></div>
<div class="star" data-rating="5"><i class="fas fa-star"></i></div>
</div>
<div class="form-group" id="manual-valuation-input" style="display:none; margin-top:10px;">
<label>Ø£Ø¯Ø®Ù„ Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø³ÙˆÙ‚ÙŠØ© (Ø¬Ù†ÙŠÙ‡)</label>
<input id="manual-market-value" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø³ÙˆÙ‚ÙŠØ©" type="number"/>
<button id="open-calculator" style="margin-right:5px;" type="button">ğŸ§® Ø§Ù„Ø­Ø§Ø³Ø¨Ø©</button>
</div>
<div class="btn-group">
<button class="btn btn-success" id="calculate-values-btn" style="width: 100%;">
<i class="fas fa-calculator"></i> Ø§Ø­ØªØ³Ø§Ø¨ Ø§Ù„Ù‚ÙŠÙ…
</button>
</div>
<button class="btn" id="add-unit-btn" style="width: 100%; margin-top: 10px;">
<i class="fas fa-plus"></i> Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙˆØ­Ø¯Ø©
</button>
</div>
</div>
<div class="section-title" style="margin-top: 30px;">
<h3><i class="fas fa-list"></i> Ø§Ù„ÙˆØ­Ø¯Ø§Øª Ø§Ù„Ù…Ø¶Ø§ÙØ©</h3>
</div>
<div class="table-responsive">
<table>
<thead>
<tr>
<th>Ø§Ù„Ø¯ÙˆØ±</th>
<th>Ø±Ù‚Ù… Ø§Ù„ÙˆØ­Ø¯Ø©</th>
<th>Ø§Ù„Ù…Ø§Ù„Ùƒ</th>
<th>Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ</th> <!-- Ø¹Ù…ÙˆØ¯ Ø¬Ø¯ÙŠØ¯ -->
<th>Ø§Ù„Ù…Ø³Ø§Ø­Ø©</th>
<th>Ø³Ø¹Ø± Ø§Ù„Ù…ØªØ±</th>
<th>Ø§Ù„Ù†ÙˆØ¹</th>
<th>Ø§Ù„Ø§Ø³ØªØºÙ„Ø§Ù„</th>
<th>Ø§Ù„Ù†Ø´Ø§Ø·</th>
<th>Ø­Ø§Ù„Ø© Ø§Ù„ÙˆØ­Ø¯Ø©</th>
<th>Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ù…Ø§Ù„ÙŠØ©</th>
<th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
<th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
</tr>
</thead>
<tbody id="units-table-body">
<tr class="empty-data-row">
<td colspan="12">
<div class="empty-data">
<i class="fas fa-inbox"></i>
<h3>Ù„Ø§ ØªÙˆØ¬Ø¯ ÙˆØ­Ø¯Ø§Øª Ù…Ø³Ø¬Ù„Ø©</h3>
<p>Ù‚Ù… Ø¨Ø¥Ø¶Ø§ÙØ© ÙˆØ­Ø¯Ø§Øª Ø§Ù„Ø¹Ù‚Ø§Ø± Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø£Ø¹Ù„Ø§Ù‡</p>
</div>
</td>
</tr>
</tbody>
</table>
</div>
<div class="export-buttons">
<button class="export-btn excel" id="export-units-excel">
<i class="fas fa-file-excel"></i> ØªØµØ¯ÙŠØ± Excel
</button>
</div>
</section>
<!-- Valuation Section -->
<section class="app-section" id="valuation-section">
<div class="section-title">
<h2><i class="fas fa-chart-line"></i> Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø¹Ù‚Ø§Ø±ÙŠ</h2>
<div class="valuation-methods">
<div class="method-selector">
<label>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„ØªÙ‚ÙŠÙŠÙ…:</label>
<select id="valuation-method">
<option value="regression">Ø§Ù„Ø§Ù†Ø­Ø¯Ø§Ø± Ø§Ù„Ù…ØªØ¹Ø¯Ø¯</option>
<option value="ai">Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</option>
<option value="manual">Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„ÙŠØ¯ÙˆÙŠ</option>
</select>
<div class="form-group" id="manual-valuation-input" style="display:none; margin-top:10px;">
<label>Ø£Ø¯Ø®Ù„ Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø³ÙˆÙ‚ÙŠØ© (Ø¬Ù†ÙŠÙ‡)</label>
<input id="manual-market-value" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø³ÙˆÙ‚ÙŠØ©" type="number"/>
<button id="open-calculator" style="margin-right:5px;" type="button">ğŸ§® Ø§Ù„Ø­Ø§Ø³Ø¨Ø©</button>
</div>
<div class="btn-group">
<button class="btn" id="calculate-valuation">
<i class="fas fa-calculator"></i> Ø§Ø­Ø³Ø¨ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…
</button>
<button class="btn" id="import-market-data">
<i class="fas fa-file-import"></i> Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³ÙˆÙ‚
</button>
<button class="btn" id="fetch-ai-data" style="display:none;">
<i class="fas fa-robot"></i> Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ
</button>
</div>
</div>
</div>
</div>
<div class="valuation-summary">
<div class="value-card">
<div class="similarity-level" id="market-similarity">--</div>
<h3>Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø³ÙˆÙ‚ÙŠØ© Ø§Ù„Ù…Ù‚Ø¯Ø±Ø©</h3>
<div class="value-amount" id="market-value">--</div>
<p>Ù…ØªÙˆØ³Ø· Ø³Ø¹Ø± Ø§Ù„Ù…ØªØ±: <span id="avg-meter-price">--</span></p>
</div>
<div class="value-card">
<div class="similarity-level" id="rental-similarity">--</div>
<h3>Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¥ÙŠØ¬Ø§Ø±ÙŠØ© Ø§Ù„Ø³Ù†ÙˆÙŠØ©</h3>
<div class="value-amount" id="rental-value">--</div>
<p>Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø³ÙˆÙ‚ÙŠØ©</p>
</div>
<div class="value-card">
<div class="similarity-level" id="tax-similarity">--</div>
<h3>Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ø¹Ù‚Ø§Ø±ÙŠØ© Ø§Ù„Ø³Ù†ÙˆÙŠØ©</h3>
<div class="value-amount" id="tax-value">--</div>
<p>Ù„Ù„ÙˆØ­Ø¯Ø© Ø³ÙƒÙ†ÙŠØ©</p>
</div>
</div>
<div class="market-data-info">
<h3><i class="fas fa-info-circle"></i> Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³ÙˆÙ‚ Ø§Ù„Ø¹Ù‚Ø§Ø±ÙŠ</h3>
<p>ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³ÙˆÙ‚ ÙÙŠ: <strong id="market-update-date">--</strong></p>
<p>Ù…ØµØ¯Ø± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: <strong id="market-data-source">--</strong></p>
<p>Ø¹Ø¯Ø¯ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø©: <strong id="market-ads-count">--</strong></p>
<div id="market-data-preview"></div>
</div>
<div class="section-title">
<h3><i class="fas fa-balance-scale"></i> ÙˆØ­Ø¯Ø§Øª Ù…Ø´Ø§Ø¨Ù‡Ø© Ù„Ù„Ø§Ø³ØªØ±Ø´Ø§Ø¯ (10 ÙˆØ­Ø¯Ø§Øª ÙƒØ­Ø¯ Ø£Ù‚ØµÙ‰)</h3>
<div class="btn" id="show-similar">
<i class="fas fa-sync"></i> ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†ØªØ§Ø¦Ø¬
</div>
</div>
<div class="valuation-summary" id="similar-units-container">
<div class="empty-data">
<i class="fas fa-search"></i>
<h3>Ù„Ø§ ØªÙˆØ¬Ø¯ ÙˆØ­Ø¯Ø§Øª Ù…Ø´Ø§Ø¨Ù‡Ø©</h3>
<p>Ø³ÙŠØªÙ… Ø¹Ø±Ø¶ ÙˆØ­Ø¯Ø§Øª Ù…Ø´Ø§Ø¨Ù‡Ø© Ø¨Ø¹Ø¯ ØªÙ‚ÙŠÙŠÙ… Ø§Ù„ÙˆØ­Ø¯Ø©</p>
</div>
</div>
<div class="export-buttons">
<button class="export-btn excel" id="export-valuation-excel">
<i class="fas fa-file-excel"></i> ØªØµØ¯ÙŠØ± Excel
</button>
</div>
</section>
<!-- Official Forms Section -->
<section class="app-section" id="official-forms-section">
<div class="section-title">
<h2><i class="fas fa-file-alt"></i> Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø±Ø§Øª Ø§Ù„Ø±Ø³Ù…ÙŠØ©</h2>
<div class="search-icon">
<button class="search-icon-btn" id="forms-search-btn">
<i class="fas fa-search"></i>
</button>
<div class="search-dropdown" id="forms-search-dropdown">
<div class="form-container">
<div class="form-group">
<label>Ø±Ù‚Ù… Ø§Ù„Ø¹Ù‚Ø§Ø±</label>
<input id="search-property-number" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ø¹Ù‚Ø§Ø±" type="text"/>
</div>
<div class="form-group">
<label>Ø§Ù„Ø´Ø§Ø±Ø¹</label>
<input id="search-street" placeholder="Ø§Ø³Ù… Ø§Ù„Ø´Ø§Ø±Ø¹" type="text"/>
</div>
<div class="form-group">
<label>Ø§Ù„Ø­Ù‰ / Ø§Ù„Ù‚Ø±ÙŠØ©</label>
<input id="search-district" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø£Ùˆ Ø§Ù„Ù‚Ø±ÙŠØ©" type="text"/>
</div>
</div>
<div class="form-type-filter">
<div class="form-type-btn active" data-form-type="all">
Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø±Ø§Øª
</div>
<div class="form-type-btn" data-form-type="form1">
Ø§Ø³ØªÙ…Ø§Ø±Ø© Ø§Ù„Ø­ØµØ±
</div>
<div class="form-type-btn" data-form-type="form2">
Ø§Ø³ØªÙ…Ø§Ø±Ø© 32
</div>
</div>
<div class="btn-group">
<button class="btn" id="reset-search">
<i class="fas fa-eraser"></i> Ù…Ø³Ø­ Ø§Ù„Ø¨Ø­Ø«
</button>
<button class="btn btn-success" id="search-forms">
<i class="fas fa-search"></i> Ø¨Ø­Ø«
</button>
</div>
</div>
</div>
</div>
<div class="tab-container">
<div class="tabs">
<div class="tab active" data-target="form1">Ø§Ø³ØªÙ…Ø§Ø±Ø© Ø§Ù„Ø­ØµØ±</div>
<div class="tab" data-target="form2">Ø§Ø³ØªÙ…Ø§Ø±Ø© 32 Ø¶0 Ø¹</div>
</div>
<div class="tab-content active" id="form1">
<div class="official-form">
<h2>Ø§Ø³ØªÙ…Ø§Ø±Ø© Ø­ØµØ± ÙˆØªÙ‚Ø¯ÙŠØ± Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø¨Ù†ÙŠØ©</h2>
<table>
<tr>
<td class="merged-cell" colspan="18">ÙˆØ²Ø§Ø±Ø© Ø§Ù„Ù…Ø§Ù„ÙŠØ©</td>
</tr>
<tr>
<td class="merged-cell" colspan="18">Ù…ØµÙ„Ø­Ø© Ø§Ù„Ø¶Ø±Ø§Ø¦Ø¨ Ø§Ù„Ø¹Ù‚Ø§Ø±ÙŠØ©</td>
</tr>
<tr>
<td class="merged-cell" colspan="18">Ù…Ø¯ÙŠØ±ÙŠØ© Ø§Ù„Ø¶Ø±Ø§Ø¦Ø¨ Ø§Ù„Ø¹Ù‚Ø§Ø±ÙŠØ©</td>
</tr>
<tr>
<td class="merged-cell" colspan="18">Ø§Ø³ØªÙ…Ø§Ø±Ø© Ø­ØµØ± ÙˆØªÙ‚Ø¯ÙŠØ± Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø¨Ù†ÙŠØ©( Ø³ÙƒÙ†Ù‰ ÙˆØºÙŠØ± Ø³ÙƒÙ†Ù‰ ) ÙˆÙ…Ø§ ÙÙ‰ Ø­ÙƒÙ…Ù‡Ø§</td>
</tr>
<tr id="form1-header">
<td class="merged-cell" colspan="18">
Ù…Ø­Ø§ÙØ¸Ø© : ....................................... Ù…Ø£Ù…ÙˆØ±ÙŠØ© ................................... Ù‚Ø±ÙŠØ© ..............................................
</td>
</tr>
<!-- Header Row 1 -->
<tr>
<th rowspan="2">Ø±Ù‚Ù… Ø§Ù„Ø¹Ù‚Ø§Ø±</th>
<th rowspan="2">Ø§Ù„Ø´Ø§Ø±Ø¹</th>
<th rowspan="2">Ø¹Ø±Ø¶ Ø§Ù„Ø´Ø§Ø±Ø¹</th>
<th rowspan="2">Ø§Ù„Ù…Ø§Ù„Ùƒ</th>
<th rowspan="2">Ù…Ø§Ø¯Ø© Ø§Ù„Ø¨Ù†Ø§Ø¡</th>
<th rowspan="2">ÙˆØµÙ Ø§Ù„Ø¹Ù‚Ø§Ø±</th>
<th rowspan="2">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡</th>
<th rowspan="2">Ù†ÙˆØ¹ Ø§Ù„Ø§Ø³ØªØºÙ„Ø§Ù„</th>
<th colspan="4">Ù…Ø´ØªÙ…Ù„Ø§Øª Ø§Ù„Ø¹Ù‚Ø§Ø±</th>
<th rowspan="2">Ø§Ù„Ø´Ø§ØºÙ„</th>
<th rowspan="2">Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø§ÙŠØ¬Ø§Ø±ÙŠØ© Ø§Ù„Ø³Ù†ÙˆÙŠØ©</th>
<th rowspan="2">Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ù…Ø³ØªØ­Ù‚Ø©</th>
<th rowspan="2">Ø·Ø¨ÙŠØ¹Ø© Ø§Ù„Ù‚Ø±ÙŠØ©</th>
</tr>
<!-- Header Row 2 -->
<tr>
<th>Ø§Ù„Ø¯ÙˆØ±</th>
<th>Ø±Ù‚Ù… Ø§Ù„ÙˆØ­Ø¯Ø©</th>
<th>Ù†ÙˆØ¹ Ø§Ù„ÙˆØ­Ø¯Ø©</th>
<th>Ø§Ù„Ù…Ø³Ø§Ø­Ø©</th>
</tr>
<!-- Data Rows -->
<tbody id="form1-data">
<tr class="empty-row"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
</tbody>
<!-- Signature Section -->
<tr>
<td colspan="18">
<div class="signature-area">
<div><strong>ØªÙˆÙ‚ÙŠØ¹ Ø£Ø¹Ø¶Ø§Ø¡ Ù„Ø¬Ù†Ø© Ø§Ù„Ø­ØµØ± ÙˆØ§Ù„ØªÙ‚Ø¯ÙŠØ±:</strong></div>
<div class="signature-row">
<div class="signature-box">Ø§Ù„Ø¥Ø³Ù…: ......................................</div>
<div class="signature-box">Ø§Ù„ØµÙØ©: ......................................</div>
<div class="signature-box">Ø§Ù„ØªÙˆÙ‚ÙŠØ¹: ......................................</div>
</div>
<div class="signature-row">
<div class="signature-box">Ø§Ù„Ø¥Ø³Ù…: ......................................</div>
<div class="signature-box">Ø§Ù„ØµÙØ©: ......................................</div>
<div class="signature-box">Ø§Ù„ØªÙˆÙ‚ÙŠØ¹: ......................................</div>
</div>
<div class="signature-row">
<div class="signature-box">Ø§Ù„Ø¥Ø³Ù…: ......................................</div>
<div class="signature-box">Ø§Ù„ØµÙØ©: ......................................</div>
<div class="signature-box">Ø§Ù„ØªÙˆÙ‚ÙŠØ¹: ......................................</div>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="tab-content" id="form2">
<div class="official-form">
<h2>Ø§Ø³ØªÙ…Ø§Ø±Ø© 32 Ø¶0 Ø¹</h2>
<table>
<tr>
<td class="merged-cell" colspan="35">ÙˆØ²Ø§Ø±Ø© Ø§Ù„Ù…Ø§Ù„ÙŠØ©</td>
</tr>
<tr>
<td class="merged-cell" colspan="35">Ù…ØµÙ„Ø­Ø© Ø§Ù„Ø¶Ø±Ø§Ø¦Ø¨ Ø§Ù„Ø¹Ù‚Ø§Ø±ÙŠØ©</td>
</tr>
<tr>
<td class="merged-cell" colspan="35">Ù…Ø¯ÙŠØ±ÙŠØ© Ø§Ù„Ø¶Ø±Ø§Ø¦Ø¨ Ø§Ù„Ø¹Ù‚Ø§Ø±ÙŠØ©</td>
</tr>
<tr>
<td class="merged-cell" colspan="35">Ø¯ÙØªØ± Ø­ØµØ± ÙˆØªÙ‚Ø¯ÙŠØ± Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø¨Ù†ÙŠØ© Ø±Ø¨Ø· Ø¹Ø§Ù… 202</td>
</tr>
<tr id="form2-header">
<td class="merged-cell" colspan="35">
Ù…Ø­Ø§ÙØ¸Ø© ..................................................................
Ù…Ø£Ù…ÙˆØ±ÙŠØ© .............................
Ø§Ù„Ù†Ø§Ø­ÙŠØ© ................. ...............
</td>
</tr>
<!-- Main Header Row -->
<tr>
<th rowspan="2">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø­ØµØ± ÙˆØ§Ù„ØªÙ‚Ø¯ÙŠØ±</th>
<th rowspan="2">Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ù„Ùƒ</th>
<th colspan="3">Ø±Ù‚Ù… Ø§Ù„Ø¹Ù‚Ø§Ø±</th>
<th rowspan="2">Ø§Ø³Ù… Ø§Ù„Ø´Ø§Ø±Ø¹</th>
<th rowspan="2">ÙˆØµÙ Ø§Ù„Ø¹Ù‚Ø§Ø±</th>
<th rowspan="2">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡</th>
<th rowspan="2">Ù†ÙˆØ¹ Ø§Ù„Ø¥Ø³ØªØºÙ„Ø§Ù„ *</th>
<th rowspan="2">ØªØ§Ø±ÙŠØ® ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ø¥Ù‚Ø±Ø§Ø± ÙˆØ±Ù‚Ù… Ù‚ÙŠØ¯Ù‡ Ø¨Ø§Ù„Ø³Ø¬Ù„</th>
<th colspan="4">Ù…Ø´ØªÙ…Ù„Ø§Øª Ø§Ù„Ø¹Ù‚Ø§Ø±</th>
<th rowspan="2">Ø§Ø³Ù… Ø§Ù„Ø´Ø§ØºÙ„</th>
<th colspan="5">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙ‚Ø¯ÙŠØ±</th>
<th rowspan="2">Ø±Ù‚Ù… Ø§Ù„Ø¥Ø®Ø·Ø§Ø± Ø¨Ø§Ù„ØªÙ‚Ø¯ÙŠØ±Ø§Øª</th>
<th colspan="2">Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø¬Ù†Ø© Ø§Ù„Ø·Ø¹Ù†</th>
<th colspan="3">Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø© Ø§Ù„Ø¶Ø±ÙŠØ¨ÙŠØ©</th>
<th colspan="8">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙƒÙ„ÙŠÙ ÙˆØªØºÙŠØ±Ø§ØªÙ‡</th>
<th rowspan="2">Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
</tr>
<!-- Sub Header Row -->
<tr>
<!-- Ø±Ù‚Ù… Ø§Ù„Ø¹Ù‚Ø§Ø± -->
<th>Ø§Ù„Ø­Ø§Ù„Ù‰</th>
<th>Ø§Ù„Ø³Ø§Ø¨Ù‚</th>
<th>Ø§Ù„ØªÙ†Ø¸ÙŠÙ…</th>
<!-- Ù…Ø´ØªÙ…Ù„Ø§Øª Ø§Ù„Ø¹Ù‚Ø§Ø± -->
<th>Ø±Ù‚Ù… Ø§Ù„Ø¯ÙˆØ±</th>
<th>Ø±Ù‚Ù… Ø§Ù„ÙˆØ­Ø¯Ø©</th>
<th>Ù†ÙˆØ¹ Ø§Ù„ÙˆØ­Ø¯Ø© *</th>
<th>Ø§Ù„Ù…Ø³Ø§Ø­Ø©</th>
<!-- Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙ‚Ø¯ÙŠØ± -->
<th>Ø§Ù„Ø¥ÙŠØ¬Ø§Ø± Ø§Ù„Ø³Ù†ÙˆÙ‰</th>
<th>ØµØ§ÙÙ‰ Ø§Ù„Ø¥ÙŠØ¬Ø§Ø± Ø§Ù„Ø³Ù†ÙˆÙ‰</th>
<th>Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ø³Ù†ÙˆÙŠØ©</th>
<th>Ù…Ø¹ÙÙ‰</th>
<th>ØºÙŠØ± Ù…Ø¹ÙÙ‰</th>
<!-- Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø¬Ù†Ø© Ø§Ù„Ø·Ø¹Ù† -->
<th>Ø§Ù„Ø¥ÙŠØ¬Ø§Ø± Ø§Ù„Ø³Ù†ÙˆÙ‰</th>
<th>Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ø³Ù†ÙˆÙŠØ©</th>
<!-- Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø© Ø§Ù„Ø¶Ø±ÙŠØ¨ÙŠØ© -->
<th>ØºÙŠØ± Ø®Ø§Ø¶Ø¹</th>
<th>Ø§Ø³Ù… ØµØ§Ø­Ø¨ Ø§Ù„ØªÙƒÙ„ÙŠÙ Ø§Ù„Ø³Ø§Ø¨Ù‚</th>
<th>Ø§Ø³Ù… ØµØ§Ø­Ø¨ Ø§Ù„ØªÙƒÙ„ÙŠÙ Ø§Ù„Ø­Ø§Ù„Ù‰</th>
<!-- Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙƒÙ„ÙŠÙ -->
<th>Ø±Ù‚Ù… Ø§Ù„Ù…ÙƒÙ„ÙØ© Ø§Ù„Ù…Ø´ØªØ±Ù‰</th>
<th>Ø§Ø³Ù… Ø§Ù„Ù…Ù†Ù‚ÙˆÙ„ Ø§Ù„ÙŠÙ‡ Ø§Ù„ØªÙƒÙ„ÙŠÙ</th>
<th>Ø§Ù„Ø³Ù†Ø¯ Ø§Ù„Ù†Ø§Ù‚Ù„ Ù„Ù„ØªÙƒÙ„ÙŠÙ</th>
<th>Ø±Ù‚Ù… ÙˆØªØ§Ø±ÙŠØ® Ø§Ø°Ù† Ù†Ù‚Ù„ Ø§Ù„ØªÙƒÙ„ÙŠÙ</th>
<th>Ø§Ù„Ø­ØµØ© Ø§Ù„Ù…Ù†Ù‚ÙˆÙ„Ø©</th>
<th>Ø§Ø³Ù… Ø§Ù„Ø¨Ø§Ø¦Ø¹</th>
</tr>
<!-- Data Rows -->
<tbody id="form2-data">
<tr class="empty-row"><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
</tbody>
<!-- Footer Notes -->
<tr>
<td colspan="35">
<div class="section-header">ØªÙ… Ø§Ù„Ø­ØµØ± ÙˆØ§Ù„ØªÙ‚Ø¯ÙŠØ± Ø¨Ù…Ø¹Ø±ÙØ© Ø§Ù„Ù„Ø¬Ù†Ø©</div>
<p>Ù†ÙˆØ¹ Ø§Ù„Ø§Ø³ØªØºÙ„Ø§Ù„ ØŒ Ø§Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„ÙˆØ­Ø¯Ø© ØºÙŠØ± ØªØ§Ù…Ø© ÙˆØºÙŠØ± Ù…Ø´ØºÙˆÙ„Ø© ØªÙƒØªØ¨ Ø­Ø§Ù„ØªÙ‡Ø§ ØªØ­Øª Ø§Ù„Ø§ØªÙ…Ø§Ù…/ ØªØ­Øª Ø§Ù„ØªØ´Ø·ÙŠØ¨</p>
<p>Ù†ÙˆØ¹ Ø§Ù„ÙˆØ­Ø¯Ø© ØŒ Ø­Ø¬Ø±Ø© . Ø¨Ø¯Ø±ÙˆÙ… . Ø´Ù‚Ø© . Ø´Ù‚Ø© Ø¯ÙˆØ¨Ù„ÙƒØ³. ÙÙŠÙ„Ø§ Ù…Ù†ÙØµÙ„Ø© . ÙÙŠÙ„Ø§ Ù…Ø²Ø¯ÙˆØ¬Ø© ................. Ø§Ù„Ø®</p>
<div class="signature-area">
<div><strong>Ø£Ø¹Ø¶Ø§Ø¡ Ù„Ø¬Ù†Ø© Ø§Ù„Ø­ØµØ± ÙˆØ§Ù„ØªÙ‚Ø¯ÙŠØ±:</strong></div>
<div class="signature-row">
<div class="signature-box">...............................</div>
<div class="signature-box">...............................</div>
<div class="signature-box">Ø±Ø¦ÙŠØ³ Ø§Ù„Ù„Ø¬Ù†Ø©: ........................</div>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<!-- Ø¥Ø¶Ø§ÙØ© Ù‚Ø³Ù… Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø« -->
<div class="search-results-container">
<div class="search-results-header">
<h3>Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø«</h3>
<span class="results-count" id="results-count">0 Ù†ØªØ§Ø¦Ø¬</span>
</div>
<div id="search-results-body">
<div class="no-results">
<i class="fas fa-search"></i>
<h3>Ù„Ù… ÙŠØªÙ… Ø¥Ø¬Ø±Ø§Ø¡ Ø¨Ø­Ø« Ø¨Ø¹Ø¯</h3>
<p>Ø§Ø³ØªØ®Ø¯Ù… Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ø¨Ø­Ø« Ù„Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø±Ø§Øª Ø§Ù„Ø±Ø³Ù…ÙŠØ©</p>
</div>
</div>
</div>
<div class="btn-group">
<button class="btn btn-success" id="print-form1">
<i class="fas fa-print"></i> Ø·Ø¨Ø§Ø¹Ø© Ø§Ø³ØªÙ…Ø§Ø±Ø© Ø§Ù„Ø­ØµØ±
</button>
<button class="btn btn-success" id="print-form2">
<i class="fas fa-print"></i> Ø·Ø¨Ø§Ø¹Ø© Ø§Ø³ØªÙ…Ø§Ø±Ø© 32
</button>
</div>
</section>
<!-- Addition Decision Section -->
<section class="app-section" id="addition-section">
<div class="section-title">
<h2><i class="fas fa-file-contract"></i> Ù‚Ø±Ø§Ø± Ø§Ù„Ø¥Ø¶Ø§ÙØ©</h2>
<div>
<button class="btn" id="print-decision">
<i class="fas fa-print"></i> Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ù‚Ø±Ø§Ø±
</button>
</div>
</div>
<div class="addition-decision">
<div class="decision-header">
<h2>Ù‚Ø±Ø§Ø± Ø§Ù„Ø¥Ø¶Ø§ÙØ©</h2>
<p>Ù‚Ø±Ø§Ø± Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø¨Ù†ÙŠØ© ÙˆÙ…Ø§ ÙÙŠ Ø­ÙƒÙ…Ù‡Ø§ Ø·Ø¨Ù‚Ø§Ù‹ Ù„Ø£Ø­ÙƒØ§Ù… Ø§Ù„Ù‚Ø§Ù†ÙˆÙ† Ø±Ù‚Ù… 196 Ù„Ø³Ù†Ø© 2020</p>
</div>
<div class="decision-details">
<div class="decision-detail">
<label>Ø±Ù‚Ù… Ø§Ù„Ù‚Ø±Ø§Ø±</label>
<input id="decision-number" type="text" value="Ù¡Ù¢Ù£Ù¤Ù¥"/>
</div>
<div class="decision-detail">
<label>ØªØ§Ø±ÙŠØ® Ø§Ù„Ù‚Ø±Ø§Ø±</label>
<input id="decision-date" type="text" value="Ù¢Ù£ ÙŠÙˆÙ„ÙŠÙˆ Ù¢Ù Ù¢Ù¥"/>
</div>
<div class="decision-detail">
<label>Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©</label>
<input id="decision-governorate" type="text" value="Ø§Ù„ØºØ±Ø¨ÙŠØ©"/>
</div>
<div class="decision-detail">
<label>Ø§Ù„Ø¬Ù‡Ø© Ø§Ù„Ù…Ø®ØªØµØ©</label>
<input id="decision-authority" type="text" value="Ù…ØµÙ„Ø­Ø© Ø§Ù„Ø¶Ø±Ø§Ø¦Ø¨ Ø§Ù„Ø¹Ù‚Ø§Ø±ÙŠØ©"/>
</div>
</div>
<div class="addition-table">
<table>
<thead>
<tr>
<th>Ø±Ù‚Ù… Ø§Ù„Ø¹Ù‚Ø§Ø±</th>
<th>Ø§Ù„Ø´Ø§Ø±Ø¹</th>
<th>Ø§Ù„Ø­Ù‰ / Ø§Ù„Ù‚Ø±ÙŠØ©</th>
<th>Ø§Ù„Ù…Ø±ÙƒØ² / Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</th>
<th>Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ù„Ùƒ</th>
<th>Ø±Ù‚Ù… Ø§Ù„ÙˆØ­Ø¯Ø©</th>
<th>Ø§Ù„Ø¯ÙˆØ±</th>
<th>Ø§Ù„Ù†Ø´Ø§Ø·</th>
<th>Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¥ÙŠØ¬Ø§Ø±ÙŠØ©</th>
<th>Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©</th>
<!-- Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù…ÙˆØ¯ÙŠÙ† Ø§Ù„Ø¬Ø¯ÙŠØ¯ÙŠÙ† Ù‡Ù†Ø§ -->
<th>Ù…Ø¹ÙÙ‰ Ù‚117</th>
<th>Ø§Ù„Ù…Ù‚ØªØ¶Ù‰ Ø¥Ø¶Ø§ÙØªÙ‡</th>
</tr>
</thead>
<tbody id="addition-table-body">
<!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡ Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
</tbody>
<tfoot>
<tr class="total-row">
<td colspan="8" style="text-align: left;">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</td>
<td id="total-rental">Ù  Ø¬.Ù…</td>
<td id="total-tax">Ù  Ø¬.Ù…</td>
<td id="total-exempt">Ù  Ø¬.Ù…</td>
<td id="total-payable">Ù  Ø¬.Ù…</td>
</tr>
</tfoot>
</table>
</div>
<div class="signature-section">
<div class="signature-row">
<div class="signature-box">
<div class="signature-line"></div>
<div>Ø±Ø¦ÙŠØ³ Ø§Ù„Ù„Ø¬Ù†Ø©</div>
</div>
<div class="signature-box">
<div class="signature-line"></div>
<div>Ø¹Ø¶Ùˆ Ø§Ù„Ù„Ø¬Ù†Ø©</div>
</div>
<div class="signature-box">
<div class="signature-line"></div>
<div>Ø¹Ø¶Ùˆ Ø§Ù„Ù„Ø¬Ù†Ø©</div>
</div>
<div class="signature-box">
<div class="signature-line"></div>
<div>Ù…Ù‚Ø±Ø± Ø§Ù„Ù„Ø¬Ù†Ø©</div>
</div>
</div>
</div>
</div>
<div class="export-buttons">
<button class="export-btn excel" id="export-addition-excel"><i class="fas fa-file-excel"></i> ØªØµØ¯ÙŠØ± Excel</button>
</div>
</section>
<!-- Map Section -->
<section class="app-section" id="map-section">
<div class="section-title">
<h2><i class="fas fa-map-marked-alt"></i> Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ø¹Ù‚Ø§Ø±ÙŠØ©</h2>
<div class="btn" id="refresh-map">
<i class="fas fa-sync"></i> ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø®Ø±ÙŠØ·Ø©
</div>
<button class="export-btn image" id="export-map-package" style="margin-right:10px;"><i class="fas fa-download"></i> ØªØµØ¯ÙŠØ± Ø§Ù„Ø®Ø±ÙŠØ·Ø© (ØµÙˆØ±Ø© + Ø¨ÙŠØ§Ù†Ø§Øª GPS)</button>
</div>
<div class="map-container">
<div id="map"></div>
</div>
<div class="regression-info">
<h3><i class="fas fa-info-circle"></i> Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø®Ø±ÙŠØ·Ø©:</h3>
<ul>
<li>ØªØ¹Ø±Ø¶ Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø³Ø¬Ù„Ø© ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…</li>
<li>ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø£ÙŠ Ø¹Ù‚Ø§Ø± Ù„Ø¹Ø±Ø¶ Ù…Ø¹Ù„ÙˆÙ…Ø§ØªÙ‡ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© ÙˆÙˆØ­Ø¯Ø§ØªÙ‡</li>
<li>ÙŠØªÙ… ØªÙ…Ø«ÙŠÙ„ Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª Ø¨Ù†Ù‚Ø§Ø· Ø²Ø±Ù‚Ø§Ø¡</li>
<li>Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª Ø§Ù„ØªÙŠ ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ ØµÙˆØ± ØªÙ…Ø«Ù„ Ø¨Ù†Ù‚Ø§Ø· Ø®Ø¶Ø±Ø§Ø¡</li>
<li>ØªÙ…Øª Ø§Ù„Ø§Ø³ØªØ¹Ø§Ù†Ø© Ø¨Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³ÙˆÙ‚ Ø§Ù„Ø¹Ù‚Ø§Ø±ÙŠ Ø§Ù„Ø­Ø¯ÙŠØ«Ø© ÙÙŠ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</li>
</ul>
</div>
<div class="export-buttons">
<button class="export-btn image" id="export-map-image">
<i class="fas fa-download"></i> ØªØµØ¯ÙŠØ± Ø§Ù„ØµÙˆØ±Ø©
</button>
</div>
</section>
<section class="app-section" id="stats-section">
<div class="section-title">
<h2><i class="fas fa-chart-pie"></i> Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ© Ø­Ø³Ø¨ Ø§Ù„Ø´Ø§Ø±Ø¹</h2>
<div class="btn-group">
<button class="export-btn excel" id="export-street-stats-excel">
<i class="fas fa-file-excel"></i> ØªØµØ¯ÙŠØ± Excel
        </button>
<button class="export-btn" id="export-street-stats-csv" style="background-color:#f39c12;">
<i class="fas fa-file-csv"></i> ØªØµØ¯ÙŠØ± CSV
        </button>
<button class="export-btn image" id="export-street-stats-pdf" style="background-color:#34495e;">
<i class="fas fa-file-pdf"></i> ØªØµØ¯ÙŠØ± PDF
        </button>
</div>
</div>
<div class="street-stats-header">
<h3>Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ù…ÙØµÙ„Ø© Ø­Ø³Ø¨ Ø§Ù„Ø´Ø§Ø±Ø¹</h3>
<div class="street-filter">
<input id="street-filter" placeholder="Ø§Ù„Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„Ø´Ø§Ø±Ø¹..." type="text"/>
<button class="btn" id="refresh-stats">
<i class="fas fa-sync"></i> ØªØ­Ø¯ÙŠØ«
        </button>
</div>
</div>
<div class="street-summary-cards">
<div class="street-summary-card">
<h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª</h3>
<div class="street-summary-value" id="total-properties">0</div>
</div>
<div class="street-summary-card">
<h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙˆØ­Ø¯Ø§Øª</h3>
<div class="street-summary-value" id="total-units">0</div>
</div>
<div class="street-summary-card">
<h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¥ÙŠØ¬Ø§Ø±ÙŠØ©</h3>
<div class="street-summary-value" id="total-rental">0.00</div>
</div>
<div class="street-summary-card">
<h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ø³Ù†ÙˆÙŠØ©</h3>
<div class="street-summary-value" id="total-tax">0.00</div>
</div>
</div>
<div class="table-responsive">
<table class="street-stats-table">
<thead>
<tr>
<th>Ø§Ù„Ø´Ø§Ø±Ø¹</th>
<th>Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª</th>
<th>Ø¹Ø¯Ø¯ Ø§Ù„ÙˆØ­Ø¯Ø§Øª</th>
<th>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¥ÙŠØ¬Ø§Ø±ÙŠØ©</th>
<th>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ø³Ù†ÙˆÙŠØ©</th>
<th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
<th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
</tr>
</thead>
<tbody id="street-stats-body">
<tr>
<td colspan="6" style="text-align: center; padding: 30px;">
<i class="fas fa-inbox"></i>
<h3>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ø­ØµØ§Ø¦ÙŠØ© Ø¨Ø¹Ø¯</h3>
<p>Ø³ÙŠØªÙ… Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø¨Ø¹Ø¯ Ø¥Ø¶Ø§ÙØ© Ø¹Ù‚Ø§Ø±Ø§Øª ÙˆÙˆØ­Ø¯Ø§Øª</p>
</td>
</tr>
</tbody>
</table>
</div>
</section>
<footer>
<p>Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© - ØªÙ… Ø§Ù„ØªØµÙ…ÙŠÙ… ÙˆØ§Ù„Ø¥Ù†Ø´Ø§Ø¡ ÙˆØ§Ù„ØªØ·ÙˆÙŠØ± Ø¨ÙˆØ§Ø³Ø·Ø©</p>
<p class="signature">Ù‡Ø§Ù†Ù‰ Ø§Ù„Ø¹Ø¬Ø§Ù† - Ù…Ø¯ÙŠØ± Ø¹Ø§Ù… Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ø§Ù…Ø© Ù„Ù„Ù…Ø¨Ø§Ù†ÙŠ Ø¨Ø§Ù„Ø¶Ø±Ø§Ø¦Ø¨ Ø§Ù„Ø¹Ù‚Ø§Ø±ÙŠØ© Ø¨Ø§Ù„ØºØ±Ø¨ÙŠØ©</p>
<p>Ø§Ù„Ø¥ØµØ¯Ø§Ø± 5.0.0 - ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ«: Ø£ØºØ³Ø·Ø³ 2025</p>
</footer>
</div>
<!-- Overlay for loading indicator -->
<div class="loading-overlay" id="loading-overlay">
<div class="loading-content">
<div class="loading-spinner"></div>
<div class="loading-text">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØµØ¯ÙŠØ±ØŒ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±...</div>
</div>
</div>
<!-- Ù†Ø§ÙØ°Ø© Ø§Ù„Ø­Ø§Ø³Ø¨Ø© -->
<div id="calculator-modal" style="display:none; position:fixed; top:50%; left:50%; transform:translate(-50%,-50%);
background:#fff; border:2px solid #333; padding:15px; z-index:1000; border-radius:8px; box-shadow:0 0 15px rgba(0,0,0,0.5);">
<h3 style="margin-top:0;">Ø¢Ù„Ø© Ø­Ø§Ø³Ø¨Ø©</h3>
<input id="calc-display" readonly="" style="width:100%; font-size:18px; margin-bottom:10px; text-align:right;" type="text"/>
<div id="calc-buttons" style="display:grid; grid-template-columns:repeat(4, 50px); gap:5px; justify-content:center;">
<button>7</button><button>8</button><button>9</button><button>/</button>
<button>4</button><button>5</button><button>6</button><button>*</button>
<button>1</button><button>2</button><button>3</button><button>-</button>
<button>0</button><button>.</button><button>=</button><button>+</button>
<button id="calc-clear" style="grid-column:span 4; background:#f55; color:#fff;">Ù…Ø³Ø­</button>
<button id="calc-use" style="grid-column:span 4; background:#28a745; color:#fff;">Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù†ØªÙŠØ¬Ø©</button>
<button id="calc-close" style="grid-column:span 4; background:#777; color:#fff;">Ø¥ØºÙ„Ø§Ù‚</button>
</div>
</div>
<script>

function getFloorFactor(floorNumber) {
    let floorFactor = 1.0;
    if (floorNumber === 1) {
        floorFactor = 0.98;
    } else if (floorNumber >= 2 && floorNumber <= 4) {
        floorFactor = 1.0;
    } else if (floorNumber === 5) {
        floorFactor = 0.98;
    } else if (floorNumber === 6) {
        floorFactor = 0.96;
    } else if (floorNumber >= 7) {
        floorFactor = 0.94;
    }
    return floorFactor;
}


// === Safe arithmetic evaluator (no eval) ===
function safeEvalExpression(expr) {
// Allow only digits, operators, parentheses, dot and spaces
if (!/^[0-9+\-*/%().\s]+$/.test(expr)) return "Ø®Ø·Ø£";
try {
// Shunting-yard algorithm to handle operator precedence safely
const output = [];
const ops = [];
const prec = {'+':1,'-':1,'*':2,'/':2,'%':2};
const assoc = {'+':'L','-':'L','*':'L','/':'L','%':'L'};
let i=0, num='';
const pushNumber = () => {
if (num !== '') { output.push(parseFloat(num)); num=''; }
};
while (i < expr.length) {
const c = expr[i];
if (c >= '0' && c <= '9' || c === '.') { num += c; }
else if (c in prec) {
pushNumber();
while (ops.length) {
const top = ops[ops.length-1];
if ((top in prec) && (prec[top] > prec[c] || (prec[top] === prec[c] && assoc[c] === 'L'))) {
output.push(ops.pop());
} else break;
}
ops.push(c);
} else if (c === '(') { pushNumber(); ops.push(c); }
else if (c === ')') {
pushNumber();
while (ops.length && ops[ops.length-1] !== '(') output.push(ops.pop());
if (ops.length && ops[ops.length-1] === '(') ops.pop(); else return "Ø®Ø·Ø£";
}
// ignore spaces and others (already validated)
i++;
}
pushNumber();
while (ops.length) {
const op = ops.pop();
if (op === '(' || op === ')') return "Ø®Ø·Ø£";
output.push(op);
}
// Evaluate RPN
const stack = [];
for (const token of output) {
if (typeof token === 'number') stack.push(token);
else {
if (stack.length < 2) return "Ø®Ø·Ø£";
const b = stack.pop(), a = stack.pop();
let r;
switch (token) {
case '+': r = a + b; break;
case '-': r = a - b; break;
case '*': r = a * b; break;
case '/': r = b === 0 ? NaN : a / b; break;
case '%': r = a % b; break;
default: return "Ø®Ø·Ø£";
}
stack.push(r);
}
}
if (stack.length !== 1 || !isFinite(stack[0])) return "Ø®Ø·Ø£";
// Keep up to 6 decimal places without trailing zeros
const out = stack[0];
return (Math.round(out * 1e6) / 1e6).toString();
} catch (_) {
return "Ø®Ø·Ø£";
}
}
// ======== Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ ========
const RealEstateApp = {
// ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
properties: [],
currentProperty: null,
units: [],
similarUnits: [],
similarityLevel: '',
map: null,
marketData: null,
searchResults: [],
importedProperties: [], // Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø³ØªÙˆØ±Ø¯Ø© Ø§Ù„Ù…Ø¤Ù‚ØªØ©
        editingUnitIndex: null,
        lastUpdatedUnitIndex: null,
isOnline: true, // Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª
// ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
init: function() {
this.loadData();
this.setupEventListeners();
this.updateMarketData();
this.updateMap();
this.initSearchEvents();
this.fillAdditionTable(); // ØªØ¹Ø¨Ø¦Ø© Ø¬Ø¯ÙˆÙ„ Ù‚Ø±Ø§Ø± Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
this.checkConnection(); // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„
this.registerServiceWorker(); // ØªØ³Ø¬ÙŠÙ„ Service Worker
},
// ØªØ³Ø¬ÙŠÙ„ Service Worker
registerServiceWorker: function() {
if ('serviceWorker' in navigator) {
navigator.serviceWorker.register('/service-worker.js')
.then(registration => {
console.log('Service Worker Ù…Ø³Ø¬Ù„ Ø¨Ù†Ø¬Ø§Ø­:', registration);
})
.catch(error => {
console.error('ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ Service Worker:', error);
});
}
},
// Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„
checkConnection: function() {
this.isOnline = navigator.onLine;
this.updateConnectionStatus();
// Ø§Ø³ØªÙ…Ø¹ Ù„ØªØºÙŠØ±Ø§Øª Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„
window.addEventListener('online', () => {
this.isOnline = true;
this.updateConnectionStatus();
this.showNotification('ØªÙ… Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª');
});
window.addEventListener('offline', () => {
this.isOnline = false;
this.updateConnectionStatus();
this.showNotification('ÙÙ‚Ø¯Øª Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª. Ø§Ù„Ø¹Ù…Ù„ ÙÙŠ ÙˆØ¶Ø¹ Ø¹Ø¯Ù… Ø§Ù„Ø§ØªØµØ§Ù„', 'warning');
});
},
// ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„
updateConnectionStatus: function() {
const statusEl = document.getElementById('connection-status');
if (this.isOnline) {
statusEl.className = 'connection-status online';
statusEl.innerHTML = '<i class="fas fa-wifi"></i> Ù…ØªØµÙ„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª';
} else {
statusEl.className = 'connection-status offline';
statusEl.innerHTML = '<i class="fas fa-cloud-download-alt"></i> ÙˆØ¶Ø¹ Ø¹Ø¯Ù… Ø§Ù„Ø§ØªØµØ§Ù„';
}
},
// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ
loadData: function() {
this.properties = JSON.parse(localStorage.getItem('realEstateProperties')) || [];
this.marketData = JSON.parse(localStorage.getItem('realEstateMarketData')) || {
lastUpdated: null,
properties: [],
source: "Ø¨ÙŠØ§Ù†Ø§Øª Ø§ÙØªØ±Ø§Ø¶ÙŠØ©"
};
},
// Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
setupEventListeners: function() {
// ØªØºÙŠÙŠØ± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„ØªÙ‚ÙŠÙŠÙ…
document.getElementById('valuation-method').addEventListener('change', (e) => {
document.getElementById('fetch-ai-data').style.display =
e.target.value === 'ai' ? 'inline-block' : 'none';
});
// Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ
document.getElementById('fetch-ai-data').addEventListener('click', () => this.fetchAIData());
// Ø§Ù„ØªÙ†Ù‚Ù„ Ø¨ÙŠÙ† Ø§Ù„Ø£Ù‚Ø³Ø§Ù…
document.querySelectorAll('.nav-btn').forEach(button => {
button.addEventListener('click', (e) => {
const target = e.target.getAttribute('data-target');
this.showSection(target);
});
});
// Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ ÙˆØ§Ù„ØªØµØ¯ÙŠØ±
document.getElementById('export-backup-all').addEventListener('click', () => this.exportBackupAll());
document.getElementById('export-property-excel').addEventListener('click', () => this.exportPropertyExcel());
document.getElementById('export-units-excel').addEventListener('click', () => this.exportUnitsExcel());
document.getElementById('export-valuation-excel').addEventListener('click', () => this.exportValuationExcel());
document.getElementById('export-addition-excel').addEventListener('click', () => this.exportAdditionExcel());
document.getElementById('export-map-image').addEventListener('click', () => this.exportMapImage());
document.getElementById('import-properties').addEventListener('click', () => this.importProperties());
// Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø­ÙØ¸ ÙˆØ§Ù„Ø­Ø°Ù
document.getElementById('save-property').addEventListener('click', () => this.saveProperty());
document.getElementById('delete-property').addEventListener('click', () => this.deleteProperty());
document.getElementById('reset-form').addEventListener('click', () => this.resetForm());
// Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙˆØ­Ø¯Ø§Øª
document.getElementById('add-unit-btn').addEventListener('click', () => this.addUnit());
document.getElementById('calculate-values-btn').addEventListener('click', () => this.calculateUnitValues());
document.getElementById('calculate-valuation').addEventListener('click', () => this.calculateValuation());
// Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø®Ø±ÙŠØ·Ø©
document.getElementById('refresh-map').addEventListener('click', () => this.updateMap());
document.getElementById('get-gps').addEventListener('click', () => this.getGPSLocation());
// Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
document.getElementById('search-forms').addEventListener('click', () => this.searchOfficialForms());
document.getElementById('reset-search').addEventListener('click', () => this.resetSearch());
document.getElementById('search-property').addEventListener('click', () => this.searchProperty());
document.getElementById('reset-property-search').addEventListener('click', () => this.resetPropertySearch());
// Ø£Ø­Ø¯Ø§Ø« Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø§Ù„Ø¨Ø­Ø«
document.getElementById('forms-search-btn').addEventListener('click', (e) => {
e.stopPropagation();
const dropdown = document.getElementById('forms-search-dropdown');
dropdown.classList.toggle('active');
});
document.getElementById('property-search-btn').addEventListener('click', (e) => {
e.stopPropagation();
const dropdown = document.getElementById('property-search-dropdown');
dropdown.classList.toggle('active');
});
// Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø© Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬Ù‡Ø§
document.addEventListener('click', (e) => {
if (!e.target.closest('.search-dropdown')) {
document.querySelectorAll('.search-dropdown').forEach(dropdown => {
dropdown.classList.remove('active');
});
}
});
// Ø£Ø­Ø¯Ø§Ø« Ø£Ø®Ø±Ù‰
document.getElementById('import-market-data').addEventListener('click', () => this.importMarketData());
document.getElementById('show-similar').addEventListener('click', () => this.showSimilarUnits());
document.getElementById('print-decision').addEventListener('click', () => this.printDecision());
document.getElementById('print-form1').addEventListener('click', () => this.printForm1());
document.getElementById('print-form2').addEventListener('click', () => this.printForm2());
// Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØµÙˆØ±
document.getElementById('property-images').addEventListener('change', (e) => this.previewImages(e));
// Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù†Ø¬Ù…ÙŠ
document.querySelectorAll('.unit-rating .star').forEach(star => {
star.addEventListener('click', (e) => {
const rating = parseInt(e.target.closest('.star').dataset.rating);
this.setUnitRating(rating);
});
});
// ØªØµÙÙŠØ© Ø§Ù„ÙˆØ­Ø¯Ø§Øª
document.querySelectorAll('.filter-btn').forEach(btn => {
btn.addEventListener('click', (e) => {
document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
e.target.classList.add('active');
this.filterUnits(e.target.dataset.filter);
});
});
// Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯ ÙˆØ§Ù„Ø¯Ù…Ø¬
document.getElementById('import-merge').addEventListener('click', () => this.importProperties('merge'));
document.getElementById('import-replace').addEventListener('click', () => this.importProperties('replace'));
document.getElementById('import-add').addEventListener('click', () => this.importProperties('add'));
document.getElementById('confirm-merge').addEventListener('click', () => this.confirmMerge());
document.getElementById('cancel-merge').addEventListener('click', () => this.cancelMerge());
},
// ======== ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø£Ù‚Ø³Ø§Ù… ========
// Ø¹Ø±Ø¶ Ù‚Ø³Ù… Ù…Ø¹ÙŠÙ† ÙˆØ¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¨Ù‚ÙŠØ©
showSection: function(sectionId) {
// Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…
document.querySelectorAll('.app-section').forEach(section => {
section.classList.remove('active');
});
// Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù†Ø´Ø· Ù…Ù† Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªÙ†Ù‚Ù„
document.querySelectorAll('.nav-btn').forEach(btn => {
btn.classList.remove('active');
});
// Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ù…Ø·Ù„ÙˆØ¨
document.getElementById(sectionId).classList.add('active');
// ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø²Ø± Ø§Ù„Ù†Ø´Ø·
document.querySelector(`.nav-btn[data-target="${sectionId}"]`).classList.add('active');
// ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø­Ø³Ø¨ Ø§Ù„Ù‚Ø³Ù…
switch(sectionId) {
case 'map-section':
this.updateMap();
break;
case 'valuation-section':
this.updateMarketData();
break;
case 'addition-section':
this.fillAdditionTable(); // ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙˆÙ„ Ù‚Ø±Ø§Ø± Ø§Ù„Ø¥Ø¶Ø§ÙØ©
break;
case 'official-forms-section':
this.resetSearch();
break;
}
},
// ======== ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª ========
// Ø­ÙØ¸ Ø§Ù„Ø¹Ù‚Ø§Ø±
saveProperty: function() {
// Ø¬Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
const propertyData = {
id: this.currentProperty?.id || Date.now(),
propertyNumber: document.getElementById('property-number').value,
// Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„: Ø¬Ù…Ø¹ Ø±Ù‚Ù… Ø§Ù„Ø¹Ù‚Ø§Ø± Ø§Ù„Ø³Ø§Ø¨Ù‚
previousPropertyNumber: document.getElementById('previous-property-number').value,
street: document.getElementById('street').value,
streetWidth: document.getElementById('street-width').value,
district: document.getElementById('district').value,
city: document.getElementById('city').value,
governorate: document.getElementById('governorate').value,
buildingMaterial: document.getElementById('building-material').value,
constructionYear: document.getElementById('construction-year').value,
responsibleName: document.getElementById('responsible-name').value,
detailedDescription: document.getElementById('detailed-description').value,
owner: document.getElementById('owner').value,
// Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„: Ø¬Ù…Ø¹ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ Ù„Ù„Ù…Ø§Ù„Ùƒ
ownerNationalId: document.getElementById('owner-national-id').value,
area: parseFloat(document.getElementById('area').value) || 0,
floors: parseInt(document.getElementById('floors').value) || 0,
unitsCount: parseInt(document.getElementById('units-count').value) || 0,
propertyType: document.getElementById('property-type').value,
coordinates: document.getElementById('coordinates').value,
units: [...this.units],
images: this.getPropertyImages()
};
// Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
if (!propertyData.propertyNumber || !propertyData.street || !propertyData.district || !propertyData.city || !propertyData.governorate) {
this.showNotification('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ù„Ù„Ø¹Ù‚Ø§Ø± (Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¹Ù‚Ø§Ø±ÙŠØŒ Ø§Ù„Ø´Ø§Ø±Ø¹ØŒ Ø§Ù„Ù‚Ø±ÙŠØ©ØŒ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©ØŒ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©)', 'error');
return;
}
// Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªÙƒØ±Ø§Ø± ÙÙŠ Ù†ÙØ³ Ø§Ù„Ø´Ø§Ø±Ø¹
const duplicateProperty = this.properties.find(p =>
p.id !== propertyData.id &&
p.propertyNumber === propertyData.propertyNumber &&
p.street === propertyData.street &&
p.district === propertyData.district
);
if (duplicateProperty) {
document.getElementById('duplicate-warning').classList.add('show');
if (!confirm(`ÙŠÙˆØ¬Ø¯ Ø¹Ù‚Ø§Ø± Ø¢Ø®Ø± (${duplicateProperty.propertyNumber}) Ø¨Ù†ÙØ³ Ø§Ù„Ø±Ù‚Ù… ÙÙŠ Ù†ÙØ³ Ø§Ù„Ø´Ø§Ø±Ø¹. Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ø§Ø³ØªÙ…Ø±Ø§Ø± ÙÙŠ Ø§Ù„Ø­ÙØ¸ØŸ`)) {
return;
}
} else {
document.getElementById('duplicate-warning').classList.remove('show');
}
// ØªØ­Ø¯ÙŠØ« Ø£Ùˆ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù‚Ø§Ø±
if (this.currentProperty) {
const index = this.properties.findIndex(p => p.id === this.currentProperty.id);
if (index !== -1) {
this.properties[index] = propertyData;
}
} else {
this.properties.push(propertyData);
}
// Ø­ÙØ¸ ÙÙŠ Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ
        // Ù„Ø§ Ù†Ù‚ÙˆÙ… Ø¨Ø¥Ø²Ø§Ù„Ø© ÙˆØ³Ù… Ø§Ù„Ù…Ø³ØªÙˆØ±Ø¯ Ø¹Ù† ÙƒÙ„ Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§ØªØŒ ÙÙ‚Ø· Ø§Ù„Ø¹Ù‚Ø§Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ
localStorage.setItem('realEstateProperties', JSON.stringify(this.properties));
// ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
this.currentProperty = propertyData;
this.updateMap();
this.fillOfficialForm1(propertyData);
this.fillOfficialForm2(propertyData);
this.fillAdditionTable(); // ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙˆÙ„ Ù‚Ø±Ø§Ø± Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø¨Ø¹Ø¯ Ø§Ù„Ø­ÙØ¸
// Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­ÙØ¸
this.showNotification('ØªÙ… Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù‚Ø§Ø± Ø¨Ù†Ø¬Ø§Ø­!');
        if (this.currentProperty && (this.currentProperty._imported || this.currentProperty.imported)) {
            this.showNotification('ØªÙ… ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¹Ù‚Ø§Ø± Ø§Ù„Ù…Ø³ØªÙˆØ±Ø¯ Ø§Ù„Ø­Ø§Ù„ÙŠ Ø¥Ù„Ù‰ Ù…Ø­ÙÙˆØ¸ Ø¨Ù†Ø¬Ø§Ø­');
        }
},
// Ù…Ø³Ø­ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
resetForm: function() {
if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù…Ø§ ÙÙŠ Ø°Ù„Ùƒ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠØŸ')) {
// Ù…Ø³Ø­ ÙƒÙ„ Ø´ÙŠØ¡ Ø¨Ù…Ø§ ÙÙŠ Ø°Ù„Ùƒ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠ
document.getElementById('property-number').value = '';
// Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„: Ù…Ø³Ø­ Ø±Ù‚Ù… Ø§Ù„Ø¹Ù‚Ø§Ø± Ø§Ù„Ø³Ø§Ø¨Ù‚
document.getElementById('previous-property-number').value = '';
document.getElementById('street').value = '';
document.getElementById('street-width').value = '';
document.getElementById('district').value = '';
document.getElementById('city').value = '';
document.getElementById('governorate').value = '';
} else {
// Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠ ÙÙ‚Ø·
const street = document.getElementById('street').value;
const streetWidth = document.getElementById('street-width').value;
const district = document.getElementById('district').value;
const city = document.getElementById('city').value;
const governorate = document.getElementById('governorate').value;
}
// Ù…Ø³Ø­ Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø­Ù‚ÙˆÙ„ ÙÙŠ ÙƒÙ„ Ø§Ù„Ø­Ø§Ù„Ø§Øª
document.getElementById('building-material').value = 'concrete';
document.getElementById('construction-year').value = '';
document.getElementById('responsible-name').value = '';
document.getElementById('owner').value = '';
// Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„: Ù…Ø³Ø­ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ Ù„Ù„Ù…Ø§Ù„Ùƒ
document.getElementById('owner-national-id').value = '';
document.getElementById('area').value = '';
document.getElementById('floors').value = '';
document.getElementById('units-count').value = '';
document.getElementById('detailed-description').value = '';
document.getElementById('property-images').value = '';
document.getElementById('image-preview').innerHTML = '';
document.getElementById('property-documents').value = '';
document.getElementById('documents-preview').innerHTML = '';
document.getElementById('coordinates').value = '';
document.getElementById('duplicate-warning').classList.remove('show');
this.units = [];
this.updateUnitsTable();
this.currentProperty = null;
// Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠ Ø¥Ø°Ø§ Ù„Ù… ÙŠØªÙ… Ù…Ø³Ø­Ù‡Ø§
if (!confirm) {
document.getElementById('street').value = street;
document.getElementById('street-width').value = streetWidth;
document.getElementById('district').value = district;
document.getElementById('city').value = city;
document.getElementById('governorate').value = governorate;
}
this.showNotification('ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø¨Ù†Ø¬Ø§Ø­!');
},
// Ø­Ø°Ù Ø§Ù„Ø¹Ù‚Ø§Ø±
deleteProperty: function() {
if (!this.currentProperty) {
this.showNotification('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¹Ù‚Ø§Ø± Ù…Ø­Ø¯Ø¯ Ù„Ù„Ø­Ø°Ù', 'error');
return;
}
if (confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø¹Ù‚Ø§Ø± ${this.currentProperty.propertyNumber}ØŸ`)) {
const index = this.properties.findIndex(p => p.id === this.currentProperty.id);
if (index !== -1) {
this.properties.splice(index, 1);
localStorage.setItem('realEstateProperties', JSON.stringify(this.properties));
this.resetForm();
this.updateMap();
this.fillAdditionTable(); // ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙˆÙ„ Ù‚Ø±Ø§Ø± Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø¨Ø¹Ø¯ Ø§Ù„Ø­Ø°Ù
this.showNotification('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¹Ù‚Ø§Ø± Ø¨Ù†Ø¬Ø§Ø­');
}
}
},
// Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØµÙˆØ±
previewImages: function(e) {
const preview = document.getElementById('image-preview');
preview.innerHTML = '';
Array.from(e.target.files).forEach(file => {
if (!file.type.match('image.*')) return;
const reader = new FileReader();
reader.onload = function(e) {
const img = document.createElement('img');
img.src = e.target.result;
preview.appendChild(img);
}
reader.readAsDataURL(file);
});

        // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø¹Ù‚Ø§Ø± Ù…Ø³ØªÙˆØ±Ø¯Ù‹Ø§ ÙˆØªÙ… ØªØ­Ù…ÙŠÙ„Ù‡ØŒ Ø¹Ù†Ø¯ Ø§Ù„Ø­ÙØ¸ Ù†Ø­ÙˆÙ„Ù‡ Ø¥Ù„Ù‰ Ù…Ø­ÙÙˆØ¸ (Ù†Ø²ÙŠÙ„ ÙˆØ³Ù… Ø§Ù„Ù…Ø³ØªÙˆØ±Ø¯)
        // If the current property was imported, mark only this one as saved (remove imported flag)
        if (this.currentProperty && (this.currentProperty._imported || this.currentProperty.imported)) {
            propertyData._imported = false;
            propertyData.imported = false;
        }
},
// Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ ØµÙˆØ± Ø§Ù„Ø¹Ù‚Ø§Ø±
getPropertyImages: function() {
const images = [];
document.querySelectorAll('#image-preview img').forEach(img => {
images.push(img.src);
});
return images;
},
// ======== ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ÙˆØ­Ø¯Ø§Øª ========
// Ø¥Ø¶Ø§ÙØ© ÙˆØ­Ø¯Ø©
addUnit: function() {
// Ø¬Ù…Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙˆØ­Ø¯Ø©
const unitData = {
floor: document.getElementById('unit-floor').value || '0',
number: document.getElementById('unit-number').value || '', // Ø±Ù‚Ù… Ø§Ù„ÙˆØ­Ø¯Ø©
owner: document.getElementById('unit-owner').value || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ',
// Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„: Ø¬Ù…Ø¹ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ Ù„Ù„Ù…Ø§Ù„Ùƒ Ù„Ù„ÙˆØ­Ø¯Ø©
ownerNationalId: document.getElementById('unit-owner-national-id').value || '',
area: document.getElementById('unit-area').value || '0',
status: document.getElementById('unit-status').value,
useType: document.getElementById('unit-use-type').value,
unitType: document.getElementById('unit-type').value,
finishing: document.getElementById('unit-finishing').value,
occupant: document.getElementById('unit-occupant').value,
activity: document.getElementById('unit-activity').value || '' // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù†Ø´Ø§Ø·
};
// Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
if (!unitData.floor || !unitData.area) {
this.showNotification('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ø¯ÙˆØ± ÙˆÙ…Ø³Ø§Ø­Ø© Ø§Ù„ÙˆØ­Ø¯Ø©', 'error');
return;
}

        const wasEditing = (this.editingUnitIndex !== null && typeof this.editingUnitIndex !== 'undefined');
// Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙˆØ­Ø¯Ø©
if (this.editingUnitIndex !== null && typeof this.editingUnitIndex !== 'undefined') {
            this.units[this.editingUnitIndex] = unitData;
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù‚ÙŠÙ… ÙÙˆØ± ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ­Ø¯Ø©
            try { this.calculateUnitValues({ floor: unitData.floor, number: unitData.number }); } catch(e) {}
            // Ø­ÙØ¸ Ù…Ø¤Ø´Ø± Ø¢Ø®Ø± ÙˆØ­Ø¯Ø© ØªÙ… ØªØ­Ø¯ÙŠØ«Ù‡Ø§ Ø­ØªÙ‰ ÙŠØªÙ…ÙƒÙ† Ø²Ø± Ø§Ø­ØªØ³Ø§Ø¨ Ø§Ù„Ù‚ÙŠÙ… Ù…Ù† Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„ÙŠÙ‡Ø§ Ø¨Ø¹Ø¯ Ø§Ù„Ø­ÙØ¸
            this.lastUpdatedUnitIndex = this.editingUnitIndex;
            this.editingUnitIndex = null;
            const addBtn = document.getElementById('add-unit-btn');
            if (addBtn) { addBtn.textContent = 'Ø¥Ø¶Ø§ÙØ© ÙˆØ­Ø¯Ø©'; delete addBtn.dataset.editing; }
        } else {
            this.units.push(unitData);
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù‚ÙŠÙ… Ù„Ù„ÙˆØ­Ø¯Ø© Ø§Ù„Ù…Ø¶Ø§ÙØ© ÙÙˆØ±Ù‹Ø§
            try {
                const newIndex = this.units.length - 1;
                this.lastUpdatedUnitIndex = newIndex;
                this.calculateUnitValues({ floor: unitData.floor, number: unitData.number });
            } catch (e) {}
        }
this.updateUnitsTable();
// Ù…Ø³Ø­ Ø­Ù‚ÙˆÙ„ Ø§Ù„ÙˆØ­Ø¯Ø©
document.getElementById('unit-floor').value = '';
document.getElementById('unit-number').value = '';
document.getElementById('unit-owner').value = '';
// Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„: Ù…Ø³Ø­ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ Ù„Ù„Ù…Ø§Ù„Ùƒ Ù„Ù„ÙˆØ­Ø¯Ø©
document.getElementById('unit-owner-national-id').value = '';
document.getElementById('unit-area').value = '';
document.getElementById('unit-occupant').value = '';
document.getElementById('unit-activity').value = '';
if (wasEditing) { this.showNotification('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙˆØ­Ø¯Ø© Ø¨Ù†Ø¬Ø§Ø­'); } else { this.showNotification('ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙˆØ­Ø¯Ø© Ø¨Ù†Ø¬Ø§Ø­!'); }
},
// ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙˆÙ„ Ø§Ù„ÙˆØ­Ø¯Ø§Øª
updateUnitsTable: function() {
const tbody = document.getElementById('units-table-body');
tbody.innerHTML = '';
if (this.units.length === 0) {
tbody.innerHTML = `
<tr class="empty-data-row">
<td colspan="12">
<div class="empty-data">
<i class="fas fa-inbox"></i>
<h3>Ù„Ø§ ØªÙˆØ¬Ø¯ ÙˆØ­Ø¯Ø§Øª Ù…Ø³Ø¬Ù„Ø©</h3>
<p>Ù‚Ù… Ø¨Ø¥Ø¶Ø§ÙØ© ÙˆØ­Ø¯Ø§Øª Ø§Ù„Ø¹Ù‚Ø§Ø± Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø£Ø¹Ù„Ø§Ù‡</p>
</div>
</td>
</tr>
`;
return;
}
// Ø¥Ø¹Ø¯Ø§Ø¯ Ø®Ø±Ø§Ø¦Ø· Ù„Ù„Ù‚ÙŠÙ…
const statusMap = {
'complete': 'ØªØ§Ù…Ø©',
'incomplete': 'ØºÙŠØ± ØªØ§Ù…Ø©',
'occupied': 'Ù…Ø´ØºÙˆÙ„Ø©'
};
const useTypeMap = {
'residential': 'Ø³ÙƒÙ†ÙŠ',
'commercial': 'ØªØ¬Ø§Ø±ÙŠ',
'administrative': 'Ø¥Ø¯Ø§Ø±ÙŠ',
'space': 'ÙØ¶Ø§Ø¡',
'utilized_space': 'ÙØ¶Ø§Ø¡ Ù…Ø³ØªØºÙ„'
};
const unitTypeMap = {
'apartment': 'Ø´Ù‚Ø©',
'duplex': 'Ø¯ÙˆØ¨Ù„ÙƒØ³',
'villa': 'ÙÙŠÙ„Ø§',
'shop': 'Ù…Ø­Ù„',
'warehouse': 'Ù…Ø®Ø²Ù†',
'workshop': 'ÙˆØ±Ø´Ø©',
'clinic': 'Ø¹ÙŠØ§Ø¯Ø©',
'office': 'Ù…ÙƒØªØ¨',
'space': 'ÙØ¶Ø§Ø¡',
'utilized_space': 'ÙØ¶Ø§Ø¡ Ù…Ø³ØªØºÙ„'
};
// Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙˆØ­Ø¯Ø§Øª Ø¥Ù„Ù‰ Ø§Ù„Ø¬Ø¯ÙˆÙ„
this.units.forEach((unit, index) => {
const pricePerMeter = unit.marketValue > 0 && unit.area > 0 ? unit.marketValue / unit.area : 0;
const tr = document.createElement('tr');
tr.innerHTML = `
<td>${unit.floor}</td>
<td>${unit.number || '--'}</td> <!-- Ø±Ù‚Ù… Ø§Ù„ÙˆØ­Ø¯Ø© -->
<td>${unit.owner}</td>
<!-- Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„: Ø¹Ø±Ø¶ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ Ù„Ù„Ù…Ø§Ù„Ùƒ -->
<td>${unit.ownerNationalId || '--'}</td>
<td>${unit.area} Ù…Â²</td>
<td>${pricePerMeter ? this.formatCurrency(pricePerMeter) : '--'}</td>
<td>${unitTypeMap[unit.unitType] || unit.unitType}</td>
<td>${useTypeMap[unit.useType] || unit.useType}</td>
<td>${unit.activity || '--'}</td>
<td>${statusMap[unit.status] || unit.status}</td>
<td>
<div class="value-badge market">
<i class="fas fa-tag"></i> Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø³ÙˆÙ‚ÙŠØ©: ${unit.marketValue ? this.formatCurrency(unit.marketValue) : '--'}
</div>
<div class="value-badge rental">
<i class="fas fa-hand-holding-usd"></i> Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¥ÙŠØ¬Ø§Ø±ÙŠØ©: ${unit.rentalValue ? this.formatCurrency(unit.rentalValue) : '--'}
</div>
<div class="value-badge net-rental">
<i class="fas fa-coins"></i> ØµØ§ÙÙŠ Ø§Ù„Ø¥ÙŠØ¬Ø§Ø±: ${unit.netRentalValue ? this.formatCurrency(unit.netRentalValue) : '--'}
</div>
<div class="value-badge tax">
<i class="fas fa-file-invoice-dollar"></i> Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©: ${unit.tax ? this.formatCurrency(unit.tax) : '--'}
</div>
</td>
<td>
<button class="btn btn-warning edit-unit" style="padding: 5px 10px; font-size: 14px;">
<i class="fas fa-edit"></i>
</button>
<button class="btn btn-danger delete-unit" style="padding: 5px 10px; font-size: 14px;">
<i class="fas fa-trash"></i>
</button>
</td>
`;
tbody.appendChild(tr);
// Ø¥Ø¶Ø§ÙØ© Ø£Ø­Ø¯Ø§Ø« Ù„Ø­Ø°Ù Ø§Ù„ÙˆØ­Ø¯Ø©
tr.querySelector('.delete-unit').addEventListener('click', () => {
if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„ÙˆØ­Ø¯Ø©ØŸ')) {
this.units.splice(index, 1);
this.updateUnitsTable();
this.showNotification('ØªÙ… Ø­Ø°Ù Ø§Ù„ÙˆØ­Ø¯Ø© Ø¨Ù†Ø¬Ø§Ø­');
}
});
            // Ø²Ø± Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
            const editBtn = tr.querySelector('.edit-unit');
            if (editBtn) {
                editBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const unit = this.units[index];
                    // Ù…Ù„Ø¡ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ÙˆØ­Ø¯Ø© Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                    document.getElementById('unit-floor').value = unit.floor || '';
                    document.getElementById('unit-number').value = unit.number || '';
                    document.getElementById('unit-owner').value = unit.owner || '';
                    document.getElementById('unit-owner-national-id').value = unit.ownerNationalId || '';
                    document.getElementById('unit-area').value = unit.area || '';
                    document.getElementById('unit-status').value = unit.status || '';
                    document.getElementById('unit-use-type').value = unit.useType || '';
                    document.getElementById('unit-type').value = unit.unitType || '';
                    document.getElementById('unit-finishing').value = unit.finishing || '';
                    document.getElementById('unit-occupant').value = unit.occupant || '';
                    document.getElementById('unit-activity').value = unit.activity || '';
                    this.editingUnitIndex = index;
                    const addBtn = document.getElementById('add-unit-btn');
                    if (addBtn) { addBtn.textContent = 'ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ­Ø¯Ø©'; addBtn.dataset.editing = 'true'; }
                });
            }

});
},
// ======== ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ØªÙ‚ÙŠÙŠÙ… ========
// Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ
fetchAIData: function() {
if (!this.currentProperty) {
this.showNotification('Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ­Ø¯ÙŠØ¯ Ø¹Ù‚Ø§Ø± Ø£ÙˆÙ„Ø§Ù‹', 'error');
return;
}
const loadingEl = document.createElement('span');
loadingEl.className = 'ai-loading';
loadingEl.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...';
const btn = document.getElementById('fetch-ai-data');
btn.disabled = true;
btn.appendChild(loadingEl);
// Ù…Ø­Ø§ÙƒØ§Ø© Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† ÙˆØ§Ø¬Ù‡Ø© Ø¨Ø±Ù…Ø¬Ø© ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ
setTimeout(() => {
// Ø¨ÙŠØ§Ù†Ø§Øª ÙˆÙ‡Ù…ÙŠØ© Ù…Ù† Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„ØªØ³ÙˆÙŠÙ‚ Ø§Ù„Ø¹Ù‚Ø§Ø±ÙŠ
const aiData = [
{
source: 'Ù…ÙˆÙ‚Ø¹ Ø¹Ù‚Ø§Ø± (AI)',
price: Math.floor(Math.random() * 500000) + 1000000,
area: Math.floor(Math.random() * 50) + 80,
location: this.currentProperty.district,
similarity: 'high',
features: ['ØªØ´Ø·ÙŠØ¨ ÙØ§Ø®Ø±', '3 ØºØ±Ù', '2 Ø­Ù…Ø§Ù…']
},
{
source: 'Ø³ÙˆÙ‚ Ø§Ù„Ø¹Ù‚Ø§Ø± (AI)',
price: Math.floor(Math.random() * 600000) + 900000,
area: Math.floor(Math.random() * 60) + 70,
location: this.currentProperty.district,
similarity: 'medium',
features: ['ØªØ´Ø·ÙŠØ¨ Ù…ØªÙˆØ³Ø·', '2 ØºØ±Ù', '1 Ø­Ù…Ø§Ù…']
}
];
this.marketData = {
lastUpdated: new Date().toISOString(),
properties: aiData,
source: "Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ"
};
localStorage.setItem('realEstateMarketData', JSON.stringify(this.marketData));
this.updateMarketDataUI();
btn.removeChild(loadingEl);
btn.disabled = false;
this.showNotification('ØªÙ… Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ø¨Ù†Ø¬Ø§Ø­');
}, 2000);
},
// Ø­Ø³Ø§Ø¨ Ø§Ù„Ù‚ÙŠÙ… Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ
calculateWithAI: function() {
if (!this.marketData || this.marketData.properties.length === 0) {
this.showNotification('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ø£ÙˆÙ„Ø§Ù‹', 'error');
return;
}
this.units.forEach(unit => {
// ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ (Ù…Ø­Ø§ÙƒØ§Ø©)
const similarUnits = this.marketData.properties.filter(u =>
u.area >= unit.area * 0.8 && u.area <= unit.area * 1.2
);
if (similarUnits.length > 0) {
const avgPricePerMeter = similarUnits.reduce((sum, u) => sum + (u.price / u.area), 0) / similarUnits.length;
// ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø³Ø¹Ø± Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ù…ÙˆØ§ØµÙØ§Øª Ø§Ù„ÙˆØ­Ø¯Ø©
let pricePerMeter = avgPricePerMeter;
// ØªØ¹Ø¯ÙŠÙ„ Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„ØªØ´Ø·ÙŠØ¨
if (unit.finishing === 'high') pricePerMeter *= 1.2;
else if (unit.finishing === 'luxury') pricePerMeter *= 1.5;
else if (unit.finishing === 'basic') pricePerMeter *= 0.9;
else if (unit.finishing === 'none') pricePerMeter *= 0.7;
// ØªØ¹Ø¯ÙŠÙ„ Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„ÙˆØ­Ø¯Ø©
if (unit.unitType === 'villa') pricePerMeter *= 1.3;
else if (unit.unitType === 'duplex') pricePerMeter *= 1.2;
else if (unit.unitType === 'shop') pricePerMeter *= 1.1;
unit.marketValue = pricePerMeter * unit.area;
unit.rentalValue = unit.marketValue * 0.018;
unit.netRentalValue = unit.useType === 'residential' ? unit.rentalValue * 0.7 : unit.rentalValue * 0.68;
unit.tax = unit.useType === 'residential' ? unit.marketValue * 0.00126 : unit.marketValue * 0.001224;
} else {
// Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ø¥Ø°Ø§ Ù„Ù… ØªÙˆØ¬Ø¯ ÙˆØ­Ø¯Ø§Øª Ù…Ø´Ø§Ø¨Ù‡Ø©
unit.marketValue = unit.area * 8000;
unit.rentalValue = unit.marketValue * 0.018;
unit.netRentalValue = unit.useType === 'residential' ? unit.rentalValue * 0.7 : unit.rentalValue * 0.68;
unit.tax = unit.useType === 'residential' ? unit.marketValue * 0.00126 : unit.marketValue * 0.001224;
}
});
this.updateUnitsTable();
this.calculateValuation();
this.showNotification('ØªÙ… Ø­Ø³Ø§Ø¨ Ø§Ù„Ù‚ÙŠÙ… Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ø¨Ù†Ø¬Ø§Ø­');
},
// ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³ÙˆÙ‚
updateMarketData: function() {
const now = new Date();
const twoMonthsAgo = new Date();
twoMonthsAgo.setMonth(twoMonthsAgo.getMonth() - 2);
// Ø¥Ø°Ø§ Ù…Ø± Ø£ÙƒØ«Ø± Ù…Ù† Ø´Ù‡Ø±ÙŠÙ† Ø£Ùˆ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§ØªØŒ Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©
if (!this.marketData.lastUpdated || new Date(this.marketData.lastUpdated) < twoMonthsAgo || this.marketData.properties.length === 0) {
// Ù…Ø­Ø§ÙƒØ§Ø© Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„ØªØ³ÙˆÙŠÙ‚ Ø§Ù„Ø¹Ù‚Ø§Ø±ÙŠ
const demoData = [
{
id: 1,
governorate: "Ø§Ù„ØºØ±Ø¨ÙŠØ©",
city: "Ø·Ù†Ø·Ø§",
district: "Ø­ÙŠ Ø£ÙˆÙ„",
street: "Ø´Ø§Ø±Ø¹ Ø§Ù„Ø¬Ù„Ø§Ø¡",
constructionYear: 2015,
area: 120,
unitType: "Ø´Ù‚Ø©",
price: 1500000,
pricePerMeter: 12500,
description: '3 ØºØ±ÙØŒ ØªØ´Ø·ÙŠØ¨ Ù…ØªÙˆØ³Ø·ØŒ Ø¯ÙˆØ± 3',
adDate: "2025-05-15",
similarity: 'street',
source: 'Ù…ÙˆÙ‚Ø¹ Ø¹Ù‚Ø§Ø±'
},
{
id: 2,
governorate: "Ø§Ù„ØºØ±Ø¨ÙŠØ©",
city: "Ø·Ù†Ø·Ø§",
district: "Ø­ÙŠ Ø«Ø§Ù†",
street: "Ø´Ø§Ø±Ø¹ Ø§Ù„Ù†ØµØ±",
constructionYear: 2018,
area: 150,
unitType: "Ø´Ù‚Ø©",
price: 1800000,
pricePerMeter: 12000,
description: '3 ØºØ±ÙØŒ ØªØ´Ø·ÙŠØ¨ ÙØ§Ø®Ø±ØŒ Ø¯ÙˆØ± 2',
adDate: "2025-06-20",
similarity: 'village',
source: 'Ù…ÙˆÙ‚Ø¹ Ø¹Ù‚Ø§Ø±'
},
{
id: 3,
governorate: "Ø§Ù„ØºØ±Ø¨ÙŠØ©",
city: "Ø·Ù†Ø·Ø§",
district: "Ø­ÙŠ Ø£ÙˆÙ„",
street: "Ø´Ø§Ø±Ø¹ Ø³Ø¹Ø¯ Ø²ØºÙ„ÙˆÙ„",
constructionYear: 2010,
area: 100,
unitType: "Ø´Ù‚Ø©",
price: 1000000,
pricePerMeter: 10000,
description: '2 ØºØ±ÙØŒ ØªØ´Ø·ÙŠØ¨ Ø¹Ø§Ø¯ÙŠØŒ Ø¯ÙˆØ± 1',
adDate: "2025-07-10",
similarity: 'street',
source: 'Ù…ÙˆÙ‚Ø¹ Ø¹Ù‚Ø§Ø±'
}
];
this.marketData = {
lastUpdated: new Date().toISOString(),
properties: demoData,
source: "Ø¨ÙŠØ§Ù†Ø§Øª Ø§ÙØªØ±Ø§Ø¶ÙŠØ©"
};
localStorage.setItem('realEstateMarketData', JSON.stringify(this.marketData));
}
// ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø³ÙˆÙ‚ ÙÙŠ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
const updateDate = new Date(this.marketData.lastUpdated).toLocaleDateString('ar-EG');
document.getElementById('market-update-date').textContent = updateDate;
document.getElementById('market-data-source').textContent = this.marketData.source;
document.getElementById('market-ads-count').textContent = this.marketData.properties.length;
},
// Ø§Ø­ØªØ³Ø§Ø¨ Ù‚ÙŠÙ… Ø§Ù„ÙˆØ­Ø¯Ø§Øª
calculateUnitValues: function(target) {
    const method = document.getElementById('valuation-method')?.value || 'regression';
    if (!this.units || this.units.length === 0) {
        this.showNotification('Ù„Ø§ ØªÙˆØ¬Ø¯ ÙˆØ­Ø¯Ø§Øª Ù„Ø­Ø³Ø§Ø¨ Ù‚ÙŠÙ…Ù‡Ø§!', 'error');
        return;
    }

    let unitIndex = null;
    if (target && typeof target === 'object' && (target.floor !== undefined || target.number !== undefined)) {
        const f = ('' + (target.floor || '')).trim();
        const n = ('' + (target.number || '')).trim();
        unitIndex = this.units.findIndex(u => ('' + (u.floor || '')).trim() === f && ('' + (u.number || '')).trim() === n);
    }

    if ((unitIndex === -1 || unitIndex === null) && (this.editingUnitIndex !== null && this.editingUnitIndex !== undefined)) {
        unitIndex = this.editingUnitIndex;
    }
    // fallback to last updated unit if available (user saved the unit and the form was cleared)
    if ((unitIndex === -1 || unitIndex === null) && (this.lastUpdatedUnitIndex !== null && this.lastUpdatedUnitIndex !== undefined)) {
        unitIndex = this.lastUpdatedUnitIndex;
    }
    if (unitIndex === -1 || unitIndex === null) unitIndex = this.units.length - 1;

    const unit = this.units[unitIndex];
    if (!unit) {
        this.showNotification('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„ÙˆØ­Ø¯Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©', 'error');
        return;
    }

    const buildingMaterial = document.getElementById('building-material')?.value || 'concrete';

    if (method === 'ai') {
        if (!this.marketData || !this.marketData.properties || this.marketData.properties.length === 0) {
            unit.marketValue = unit.area * 8000;
        } else {
            const similarUnits = this.marketData.properties.filter(u =>
                u.area >= unit.area * 0.8 && u.area <= unit.area * 1.2
            );
            if (similarUnits.length > 0) {
                const avgPricePerMeter = similarUnits.reduce((s, u) => s + (u.price / u.area), 0) / similarUnits.length;
                let pricePerMeter = avgPricePerMeter;
                if (unit.finishing === 'high') pricePerMeter *= 1.2;
                else if (unit.finishing === 'luxury') pricePerMeter *= 1.5;
                else if (unit.finishing === 'basic') pricePerMeter *= 0.9;
                else if (unit.finishing === 'none') pricePerMeter *= 0.7;
                if (unit.unitType === 'villa') pricePerMeter *= 1.3;
                else if (unit.unitType === 'duplex') pricePerMeter *= 1.2;
                else if (unit.unitType === 'shop') pricePerMeter *= 1.1;
                unit.marketValue = pricePerMeter * unit.area;
            } else {
                unit.marketValue = unit.area * 8000;
            }
        }

        unit.rentalValue = unit.marketValue * 0.018;
        unit.netRentalValue = unit.useType === 'residential' ? unit.rentalValue * 0.7 : unit.rentalValue * 0.68;
        unit.tax = unit.useType === 'residential' ? unit.marketValue * 0.00126 : unit.marketValue * 0.001224;

        this.updateUnitsTable();
        this.calculateValuation();
        this.showNotification(`ØªÙ… Ø­Ø³Ø§Ø¨ Ø§Ù„Ù‚ÙŠÙ… Ù„Ù„ÙˆØ­Ø¯Ø© (Ø¯ÙˆØ± ${unit.floor} - Ø±Ù‚Ù… ${unit.number || (unitIndex+1)})`);
        return;
    }

    const baseValue = (typeof coefficients !== 'undefined' && coefficients.area) ? (coefficients.area * unit.area) : (unit.area * 1000);
    const useFactor = (typeof coefficients !== 'undefined' && coefficients.useType) ? (coefficients.useType[unit.useType] || 1.0) : 1.0;
    const typeFactor = (typeof coefficients !== 'undefined' && coefficients.unitType) ? (coefficients.unitType[unit.unitType] || 1.0) : 1.0;
    const finishingFactor = (typeof coefficients !== 'undefined' && coefficients.finishing) ? (coefficients.finishing[unit.finishing] || 1.0) : 1.0;
    const materialFactor = (typeof coefficients !== 'undefined' && coefficients.buildingMaterial) ? (coefficients.buildingMaterial[buildingMaterial] || 1.0) : 1.0;

    let similarityFactor = 1.0;
    if (this.similarityLevel === 'Ù†ÙØ³ Ø§Ù„Ø´Ø§Ø±Ø¹') similarityFactor = 1.10;
    else if (this.similarityLevel === 'Ù†ÙØ³ Ø§Ù„Ù…Ù†Ø·Ù‚Ø©/Ø§Ù„Ù‚Ø±ÙŠØ©') similarityFactor = 1.05;
    else if (this.similarityLevel === 'Ù†ÙØ³ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©') similarityFactor = 1.02;

    const floorNumber = parseInt(unit.floor) || 0;
    let floorFactor;
    if (typeof getFloorFactor === 'function') {
        floorFactor = getFloorFactor(floorNumber || 1);
    } else {
        floorFactor = (coefficients.floor || 1.0) * (floorNumber > 0 ? floorNumber : 1);
    }
  const locationType = document.getElementById('location-type').value;
  const locationFactor = coefficients.locationType[locationType] || 1.0;
  
  let computedMarketValue = baseValue * useFactor * typeFactor * finishingFactor * similarityFactor * materialFactor * floorFactor * locationFactor;
let marketValue = computedMarketValue;

    try {
        if (method === 'manual') {
            const manualInput = document.getElementById('manual-market-value');
            if (manualInput) {
                const manualVal = parseFloat(manualInput.value);
                if (!isNaN(manualVal) && manualVal > 0) marketValue = manualVal;
            }
        }
    } catch (e) {}

    unit.marketValue = marketValue;
    unit.rentalValue = marketValue * 0.018;
    unit.netRentalValue = unit.useType === 'residential' ? unit.rentalValue * 0.7 : unit.rentalValue * 0.68;
    unit.tax = unit.useType === 'residential' ? marketValue * 0.00126 : marketValue * 0.001224;

    this.updateUnitsTable();
    this.calculateValuation();
    this.showNotification(`ØªÙ… Ø­Ø³Ø§Ø¨ Ø§Ù„Ù‚ÙŠÙ… Ù„Ù„ÙˆØ­Ø¯Ø© (Ø¯ÙˆØ± ${unit.floor} - Ø±Ù‚Ù… ${unit.number || (unitIndex+1)})`);
},// Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† ÙˆØ­Ø¯Ø§Øª Ù…Ø´Ø§Ø¨Ù‡Ø©
findSimilarUnits: function(street, district, city, governorate) {
if (!this.marketData.properties || this.marketData.properties.length === 0) {
return [];
}
// ØªØ­Ø¯ÙŠØ¯ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªØ´Ø§Ø¨Ù‡
// 1. Ù†ÙØ³ Ø§Ù„Ø´Ø§Ø±Ø¹ Ø£ÙˆÙ„Ø§Ù‹
const streetUnits = this.marketData.properties.filter(unit =>
unit.governorate === governorate &&
unit.city === city &&
unit.district === district &&
unit.street === street
);
if (streetUnits.length > 0) {
this.similarityLevel = 'Ù†ÙØ³ Ø§Ù„Ø´Ø§Ø±Ø¹';
return streetUnits.slice(0, 10);
}
// 2. Ù†ÙØ³ Ø§Ù„Ù…Ù†Ø·Ù‚Ø©/Ø§Ù„Ù‚Ø±ÙŠØ©
const villageUnits = this.marketData.properties.filter(unit =>
unit.governorate === governorate &&
unit.city === city &&
unit.district === district
);
if (villageUnits.length > 0) {
this.similarityLevel = 'Ù†ÙØ³ Ø§Ù„Ù…Ù†Ø·Ù‚Ø©/Ø§Ù„Ù‚Ø±ÙŠØ©';
return villageUnits.slice(0, 10);
}
// 3. Ù†ÙØ³ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©
const cityUnits = this.marketData.properties.filter(unit =>
unit.governorate === governorate &&
unit.city === city
);
if (cityUnits.length > 0) {
this.similarityLevel = 'Ù†ÙØ³ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©';
return cityUnits.slice(0, 10);
}
// 4. Ù†ÙØ³ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©
const governorateUnits = this.marketData.properties.filter(unit =>
unit.governorate === governorate
);
this.similarityLevel = 'Ù†ÙØ³ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©';
return governorateUnits.slice(0, 10);
},
// Ø¹Ø±Ø¶ Ø§Ù„ÙˆØ­Ø¯Ø§Øª Ø§Ù„Ù…Ø´Ø§Ø¨Ù‡Ø©
showSimilarUnits: function() {
const container = document.getElementById('similar-units-container');
container.innerHTML = '';
if (this.similarUnits.length === 0) {
container.innerHTML = `
<div class="empty-data">
<i class="fas fa-search"></i>
<h3>Ù„Ø§ ØªÙˆØ¬Ø¯ ÙˆØ­Ø¯Ø§Øª Ù…Ø´Ø§Ø¨Ù‡Ø©</h3>
<p>Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù‚Ø§Ø± Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠØ© Ø«Ù… Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ "Ø§Ø­ØªØ³Ø§Ø¨ Ø§Ù„Ù‚ÙŠÙ…"</p>
</div>
`;
return;
}
// Ø¥Ø¶Ø§ÙØ© Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„ÙˆØ­Ø¯Ø§Øª Ø§Ù„Ù…Ø´Ø§Ø¨Ù‡Ø©
this.similarUnits.forEach(unit => {
const similarityClassMap = {
'street': 'similarity-street',
'village': 'similarity-village',
'city': 'similarity-city',
'governorate': 'similarity-governorate'
};
const similarityTextMap = {
'street': 'Ù†ÙØ³ Ø§Ù„Ø´Ø§Ø±Ø¹',
'village': 'Ù†ÙØ³ Ø§Ù„Ù‚Ø±ÙŠØ©',
'city': 'Ù†ÙØ³ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©',
'governorate': 'Ù†ÙØ³ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©'
};
const unitCard = document.createElement('div');
unitCard.className = 'unit-card';
unitCard.innerHTML = `
<span class="similarity-badge ${similarityClassMap[unit.similarity] || 'similarity-street'}">
${similarityTextMap[unit.similarity] || 'Ù…Ø´Ø§Ø¨Ù‡'}
</span>
<div class="unit-header">
<h3>${unit.unitType} - ${unit.area} Ù…Â²</h3>
<div class="unit-price">${this.formatCurrency(unit.price)}</div>
</div>
<p><strong>Ø§Ù„Ù…ÙˆÙ‚Ø¹:</strong> ${unit.governorate} - ${unit.city} - ${unit.district}</p>
<p><strong>Ø§Ù„Ø´Ø§Ø±Ø¹:</strong> ${unit.street}</p>
<p><strong>Ø³Ø¹Ø± Ø§Ù„Ù…ØªØ±:</strong> ${this.formatCurrency(unit.pricePerMeter)}</p>
<p><strong>Ø³Ù†Ø© Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡:</strong> ${unit.constructionYear}</p>
<p><strong>Ø§Ù„Ù…ØµØ¯Ø±:</strong> ${unit.source}</p>
<div class="unit-stats">
<div class="stat-item">
<div class="stat-label">Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø³ÙˆÙ‚ÙŠØ©</div>
<div class="stat-value">${this.formatCurrency(unit.price)}</div>
</div>
<div class="stat-item">
<div class="stat-label">Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¥ÙŠØ¬Ø§Ø±ÙŠØ©</div>
<div class="stat-value">${this.formatCurrency(unit.price * 0.018)}</div>
</div>
<div class="stat-item">
<div class="stat-label">ØµØ§ÙÙŠ Ø§Ù„Ø¥ÙŠØ¬Ø§Ø±</div>
<div class="stat-value">${unit.useType === 'residential' ? this.formatCurrency(unit.price * 0.018 * 0.7) : this.formatCurrency(unit.price * 0.018 * 0.68)}</div>
</div>
</div>
`;
container.appendChild(unitCard);
});
},
// ======== ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø±Ø§Øª Ø§Ù„Ø±Ø³Ù…ÙŠØ© ========
// ØªØ¹Ø¨Ø¦Ø© Ø§Ø³ØªÙ…Ø§Ø±Ø© Ø§Ù„Ø­ØµØ±
fillOfficialForm1: function(property) {
if (!property) return; if (property._imported) return;
    const isImported = !!(property._imported || property.imported || property.source === 'import');
    const importedBadge = isImported
      ? '<span class="property-badge badge-imported">Ù…Ø³ØªÙˆØ±Ø¯</span>'
      : '<span class="property-badge badge-saved">Ù…Ø­ÙÙˆØ¸</span>';
// ØªØ­Ø¯ÙŠØ« Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø±Ø©
document.getElementById('form1-header').innerHTML = `
<td colspan="18" class="merged-cell">
Ù…Ø­Ø§ÙØ¸Ø©: ${property.governorate || '--'}
Ù…Ø£Ù…ÙˆØ±ÙŠØ©: ${property.city || '--'}
Ù‚Ø±ÙŠØ©: ${property.district || '--'}
</td>
`;
// ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
const tbody = document.getElementById('form1-data');
tbody.innerHTML = '';
if (property.units && property.units.length > 0) {
property.units.forEach((unit, index) => {
const tr = document.createElement('tr');
// ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´ØªØ±ÙƒØ© Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø· Ù„Ù„ÙˆØ­Ø¯Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰
const commonData = index === 0 ? `
<td rowspan="${property.units.length}">${property.propertyNumber || '--'}</td>
<td rowspan="${property.units.length}">${property.street || '--'}</td>
<td rowspan="${property.units.length}">${property.streetWidth || '--'}</td>
<td rowspan="${property.units.length}">${property.owner || '--'}</td>
<td rowspan="${property.units.length}">${this.getBuildingMaterialName(property.buildingMaterial)}</td>
<td rowspan="${property.units.length}">${property.detailedDescription || '--'}</td>
<td rowspan="${property.units.length}">${property.constructionYear || '--'}</td>
` : '';
tr.innerHTML = commonData + `
<td>${this.getUseTypeName(unit.useType)}</td>
<td>${unit.floor || '--'}</td>
<td>${unit.number || index + 1}</td>
<td>${this.getUnitTypeName(unit.unitType)}</td>
<td>${unit.area || '--'} Ù…Â²</td>
<td>${unit.occupant || '--'}</td>
<td>${unit.rentalValue ? this.formatCurrency(unit.rentalValue) : '--'}</td>
<td>${unit.tax ? this.formatCurrency(unit.tax) : '--'}</td>
<td>${property.district || '--'}</td>
`;
tbody.appendChild(tr);
});
} else {
const tr = document.createElement('tr');
tr.innerHTML = `
<td colspan="18" style="text-align: center; padding: 20px; color: var(--gray);">
<i class="fas fa-inbox"></i>
<h3>Ù„Ø§ ØªÙˆØ¬Ø¯ ÙˆØ­Ø¯Ø§Øª Ù…Ø³Ø¬Ù„Ø© Ù„Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù‚Ø§Ø±</h3>
</td>
`;
tbody.appendChild(tr);
}
},
// ØªØ¹Ø¨Ø¦Ø© Ø§Ø³ØªÙ…Ø§Ø±Ø© 32
fillOfficialForm2: function(property) {
if (!property) return; if (property._imported) return;
// ØªØ­Ø¯ÙŠØ« Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø±Ø©
document.getElementById('form2-header').innerHTML = `
<td colspan="35" class="merged-cell">
Ù…Ø­Ø§ÙØ¸Ø©: ${property.governorate || '--'}
Ù…Ø£Ù…ÙˆØ±ÙŠØ©: ${property.city || '--'}
Ø§Ù„Ù†Ø§Ø­ÙŠØ©: ${property.district || '--'}
</td>
`;
// ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
const tbody = document.getElementById('form2-data');
tbody.innerHTML = '';
if (property.units && property.units.length > 0) {
property.units.forEach((unit, index) => {
const tr = document.createElement('tr');
// ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´ØªØ±ÙƒØ© Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø· Ù„Ù„ÙˆØ­Ø¯Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰
const commonData = index === 0 ? `
<td rowspan="${property.units.length}">${new Date().toLocaleDateString('ar-EG')}</td>
<td rowspan="${property.units.length}">${property.owner || '--'}</td>
<td rowspan="${property.units.length}">${property.propertyNumber || '--'}</td>
<td rowspan="${property.units.length}">${property.previousPropertyNumber || '--'}</td>
<td rowspan="${property.units.length}">--</td>
<td rowspan="${property.units.length}">${property.street || '--'}</td>
<td rowspan="${property.units.length}">${property.detailedDescription || '--'}</td>
<td rowspan="${property.units.length}">${property.constructionYear || '--'}</td>
` : '';
tr.innerHTML = commonData + `
<td>${this.getUseTypeName(unit.useType)}</td>
<td>--</td>
<td>${unit.floor || '--'}</td>
<td>${unit.number || index + 1}</td>
<td>${this.getUnitTypeName(unit.unitType)}</td>
<td>${unit.area || '--'} Ù…Â²</td>
<td>${unit.occupant || '--'}</td>
<td>${unit.rentalValue ? this.formatCurrency(unit.rentalValue) : '--'}</td>
<td>${unit.netRentalValue ? this.formatCurrency(unit.netRentalValue) : '--'}</td>
<td>${unit.tax ? this.formatCurrency(unit.tax) : '--'}</td>
<td>--</td>
<td>--</td>
<td>--</td>
<td>--</td>
<td>--</td>
<td>--</td>
<td>--</td>
<td>--</td>
<td>--</td>
<td>--</td>
<td>--</td>
<td>--</td>
<td>--</td>
<td>--</td>
<td>--</td>
<td>--</td>
<td>--</td>
`;
tbody.appendChild(tr);
});
// Ø¥Ø¶Ø§ÙØ© ØµÙˆØ± Ø§Ù„Ø¹Ù‚Ø§Ø± ÙÙŠ Ø®Ø§Ù†Ø© Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª
if (property.images && property.images.length > 0) {
const imagesRow = document.createElement('tr');
imagesRow.innerHTML = `
<td colspan="35">
<div class="form-images-container">
<div class="form-images-title">
<i class="fas fa-images"></i> ØµÙˆØ± Ø§Ù„Ø¹Ù‚Ø§Ø±
</div>
<div class="form-images-grid" id="form2-images">
<!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„ØµÙˆØ± -->
</div>
</div>
</td>
`;
tbody.appendChild(imagesRow);
const imagesContainer = document.getElementById('form2-images');
property.images.forEach(img => {
const imgContainer = document.createElement('div');
imgContainer.className = 'form-image-item';
imgContainer.innerHTML = `<img src="${img}" alt="ØµÙˆØ±Ø© Ø§Ù„Ø¹Ù‚Ø§Ø±">`;
imagesContainer.appendChild(imgContainer);
});
}
} else {
const tr = document.createElement('tr');
tr.innerHTML = `
<td colspan="35" style="text-align: center; padding: 20px; color: var(--gray);">
<i class="fas fa-inbox"></i>
<h3>Ù„Ø§ ØªÙˆØ¬Ø¯ ÙˆØ­Ø¯Ø§Øª Ù…Ø³Ø¬Ù„Ø© Ù„Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù‚Ø§Ø±</h3>
</td>
`;
tbody.appendChild(tr);
}
},
// Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø±Ø§Øª
searchOfficialForms: function() {
const propertyNumber = document.getElementById('search-property-number').value.trim();
const street = document.getElementById('search-street').value.trim();
const district = document.getElementById('search-district').value.trim();
const formType = document.querySelector('.form-type-btn.active').dataset.formType;
const resultsContainer = document.getElementById('search-results-body');
resultsContainer.innerHTML = '';
// Ø¥Ø¸Ù‡Ø§Ø± Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„
const searchBtn = document.getElementById('search-forms');
const originalHtml = searchBtn.innerHTML;
searchBtn.innerHTML = '<span class="search-loader"></span> Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø«...';
searchBtn.disabled = true;
// Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª
const filteredProperties = this.properties.filter(property => {
// Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ù…Ø¹Ø§ÙŠÙŠØ± Ø¨Ø­Ø« Ù…Ø­Ø¯Ø¯Ø©
if (propertyNumber && property.propertyNumber && !property.propertyNumber.includes(propertyNumber)) {
return false;
}
if (street && property.street && !property.street.includes(street)) {
return false;
}
if (district && property.district && !property.district.includes(district)) {
return false;
}
return true;
});
setTimeout(() => {
// ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø¯ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
document.getElementById('results-count').textContent = `${filteredProperties.length} Ù†ØªØ§Ø¦Ø¬`;
if (filteredProperties.length === 0) {
resultsContainer.innerHTML = `
<div class="no-results">
<i class="fas fa-inbox"></i>
<h3>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬</h3>
<p>Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ø³ØªÙ…Ø§Ø±Ø§Øª ØªØ·Ø§Ø¨Ù‚ Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø¨Ø­Ø«</p>
</div>
`;
} else {
// Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ÙÙŠ Ø¨Ø·Ø§Ù‚Ø§Øª
filteredProperties.forEach(property => {
const propertyCard = document.createElement('div');
propertyCard.className = 'property-card';
propertyCard.innerHTML = `
<h3>
<span class="property-id">${property.propertyNumber}</span>
${property.street ? property.street + 'ØŒ ' : ''}
${property.district || ''}
</h3>
<div class="property-info">
<div class="info-item">
<span class="info-label">Ø§Ù„Ù…Ø§Ù„Ùƒ:</span>
<span>${property.owner || '--'}</span>
</div>
<div class="info-item">
<span class="info-label">Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©:</span>
<span>${property.governorate || '--'}</span>
</div>
<div class="info-item">
<span class="info-label">Ø§Ù„Ù…Ø³Ø§Ø­Ø©:</span>
<span>${property.area || '--'} Ù…Â²</span>
</div>
<div class="info-item">
<span class="info-label">Ø¹Ø¯Ø¯ Ø§Ù„ÙˆØ­Ø¯Ø§Øª:</span>
<span>${property.units ? property.units.length : 0}</span>
</div>
</div>
<div class="btn-group" style="margin-top:15px;">
<button class="btn btn-sm view-form" data-property-id="${property.id}" data-form-type="form1">
<i class="fas fa-eye"></i> Ø§Ø³ØªÙ…Ø§Ø±Ø© Ø§Ù„Ø­ØµØ±
</button>
<button class="btn btn-sm view-form" data-property-id="${property.id}" data-form-type="form2">
<i class="fas fa-eye"></i> Ø§Ø³ØªÙ…Ø§Ø±Ø© 32
</button>
</div>
`;
resultsContainer.appendChild(propertyCard);
});
// Ø¥Ø¶Ø§ÙØ© Ø£Ø­Ø¯Ø§Ø« Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø±Ø§Øª
document.querySelectorAll('.view-form').forEach(button => {
button.addEventListener('click', (e) => {
const propertyId = e.target.closest('.view-form').dataset.propertyId;
const formType = e.target.closest('.view-form').dataset.formType;
// Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø¹Ù‚Ø§Ø±
const property = this.properties.find(p => p.id == propertyId);
if (!property) return;
// Ø¹Ø±Ø¶ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø±Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
if (formType === 'form1') {
// Ø¥Ø¸Ù‡Ø§Ø± ØªØ¨ÙˆÙŠØ¨ Ø§Ø³ØªÙ…Ø§Ø±Ø© Ø§Ù„Ø­ØµØ±
document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
document.querySelector('.tab[data-target="form1"]').classList.add('active');
document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
document.getElementById('form1').classList.add('active');
// ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø±Ø©
this.fillOfficialForm1(property);
} else {
// Ø¥Ø¸Ù‡Ø§Ø± ØªØ¨ÙˆÙŠØ¨ Ø§Ø³ØªÙ…Ø§Ø±Ø© 32
document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
document.querySelector('.tab[data-target="form2"]').classList.add('active');
document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
document.getElementById('form2').classList.add('active');
// ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø±Ø©
this.fillOfficialForm2(property);
}
this.showNotification(`ØªÙ… ØªØ­Ù…ÙŠÙ„ ${formType === 'form1' ? 'Ø§Ø³ØªÙ…Ø§Ø±Ø© Ø§Ù„Ø­ØµØ±' : 'Ø§Ø³ØªÙ…Ø§Ø±Ø© 32'} Ù„Ù„Ø¹Ù‚Ø§Ø± ${property.propertyNumber}`);
});
});
}
// Ø¥Ø¹Ø§Ø¯Ø© Ø²Ø± Ø§Ù„Ø¨Ø­Ø« Ø¥Ù„Ù‰ Ø­Ø§Ù„ØªÙ‡ Ø§Ù„Ø£ØµÙ„ÙŠØ©
searchBtn.innerHTML = originalHtml;
searchBtn.disabled = false;
// Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø©
document.getElementById('forms-search-dropdown').classList.remove('active');
}, 1000);
},
// Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù‚Ø§Ø±
searchProperty: function() {
const propertyNumber = document.getElementById('property-search-number').value.trim();
const street = document.getElementById('property-search-street').value.trim();
const district = document.getElementById('property-search-district').value.trim();
// Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª
const foundProperties = this.properties.filter(property => {
const matchesNumber = propertyNumber ? (property.propertyNumber || '').toLowerCase().includes(propertyNumber.toLowerCase()) : true;
const matchesStreet = street ? (property.street || '').toLowerCase().includes(street.toLowerCase()) : true;
const matchesDistrict = district ? (property.district || '').toLowerCase().includes(district.toLowerCase()) : true;
return matchesNumber && matchesStreet && matchesDistrict;
});
if (foundProperties.length > 0) {
this.showNotification(`ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ${foundProperties.length} Ø¹Ù‚Ø§Ø±Ù‹Ø§`);
} else {
this.showNotification('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¹Ù‚Ø§Ø± ÙŠØ·Ø§Ø¨Ù‚ Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø¨Ø­Ø«', 'error');
}
// Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø©
document.getElementById('property-search-dropdown').classList.remove('active');
},
// Ù…Ø³Ø­ Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø±Ø§Øª
resetSearch: function() {
document.getElementById('search-property-number').value = '';
document.getElementById('search-street').value = '';
document.getElementById('search-district').value = '';
const resultsContainer = document.getElementById('search-results-body');
resultsContainer.innerHTML = `
<div class="no-results">
<i class="fas fa-search"></i>
<h3>Ù„Ù… ÙŠØªÙ… Ø¥Ø¬Ø±Ø§Ø¡ Ø¨Ø­Ø« Ø¨Ø¹Ø¯</h3>
<p>Ø§Ø³ØªØ®Ø¯Ù… Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ø¨Ø­Ø« Ù„Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø±Ø§Øª Ø§Ù„Ø±Ø³Ù…ÙŠØ©</p>
</div>
`;
document.getElementById('results-count').textContent = '0 Ù†ØªØ§Ø¦Ø¬';
},
// Ù…Ø³Ø­ Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù‚Ø§Ø±
resetPropertySearch: function() {
document.getElementById('property-search-number').value = '';
document.getElementById('property-search-street').value = '';
document.getElementById('property-search-district').value = '';
},
// ØªÙ‡ÙŠØ¦Ø© Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø¨Ø­Ø«
initSearchEvents: function() {
// Ø£Ø­Ø¯Ø§Ø« Ø£Ø²Ø±Ø§Ø± ØªØµÙÙŠØ© Ù†ÙˆØ¹ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø±Ø©
document.querySelectorAll('.form-type-btn').forEach(button => {
button.addEventListener('click', function() {
document.querySelectorAll('.form-type-btn').forEach(btn => btn.classList.remove('active'));
this.classList.add('active');
});
});
// Ø§Ù„Ø¨Ø­Ø« Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Enter
document.querySelectorAll('.search-dropdown input').forEach(input => {
input.addEventListener('keypress', function(e) {
if (e.key === 'Enter') {
if (e.target.closest('#forms-search-dropdown')) {
RealEstateApp.searchOfficialForms();
} else {
RealEstateApp.searchProperty();
}
}
});
});
},
// Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ø³Ù… Ù…Ø§Ø¯Ø© Ø§Ù„Ø¨Ù†Ø§Ø¡
getBuildingMaterialName: function(value) {
const materials = {
'brick': 'Ø·ÙˆØ¨ Ø£Ø­Ù…Ø±',
'sand_brick': 'Ø·ÙˆØ¨ Ø±Ù…Ù„ÙŠ',
'concrete': 'Ø®Ø±Ø³Ø§Ù†Ø© Ù…Ø³Ù„Ø­Ø©',
'stone': 'Ø­Ø¬Ø±',
'mud_brick': 'Ø·ÙˆØ¨ Ù„Ø¨Ù†',
'other': 'Ø£Ø®Ø±Ù‰'
};
return materials[value] || value;
},
// Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ø³Ù… Ù†ÙˆØ¹ Ø§Ù„Ø§Ø³ØªØºÙ„Ø§Ù„
getUseTypeName: function(value) {
const types = {
'residential': 'Ø³ÙƒÙ†ÙŠ',
'commercial': 'ØªØ¬Ø§Ø±ÙŠ',
'administrative': 'Ø¥Ø¯Ø§Ø±ÙŠ',
'space': 'ÙØ¶Ø§Ø¡',
'utilized_space': 'ÙØ¶Ø§Ø¡ Ù…Ø³ØªØºÙ„'
};
return types[value] || value;
},
// Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ø³Ù… Ù†ÙˆØ¹ Ø§Ù„ÙˆØ­Ø¯Ø©
getUnitTypeName: function(value) {
const types = {
'apartment': 'Ø´Ù‚Ø©',
'duplex': 'Ø¯ÙˆØ¨Ù„ÙƒØ³',
'villa': 'ÙÙŠÙ„Ø§',
'shop': 'Ù…Ø­Ù„',
'warehouse': 'Ù…Ø®Ø²Ù†',
'workshop': 'ÙˆØ±Ø´Ø©',
'clinic': 'Ø¹ÙŠØ§Ø¯Ø©',
'office': 'Ù…ÙƒØªØ¨',
'space': 'ÙØ¶Ø§Ø¡',
'utilized_space': 'ÙØ¶Ø§Ø¡ Ù…Ø³ØªØºÙ„'
};
return types[value] || value;
},
// ======== ÙˆØ¸Ø§Ø¦Ù Ù‚Ø±Ø§Ø± Ø§Ù„Ø¥Ø¶Ø§ÙØ© ========
// ØªØ¹Ø¨Ø¦Ø© Ø¬Ø¯ÙˆÙ„ Ù‚Ø±Ø§Ø± Ø§Ù„Ø¥Ø¶Ø§ÙØ©
fillAdditionTable: function() {
    const tbody = document.getElementById('addition-table-body');
    tbody.innerHTML = '';
    let totalRental = 0;
    let totalTax = 0;
    let totalExempt = 0;
    let totalPayable = 0;
    // Ø§Ù„ØªÙƒØ±Ø§Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© ÙÙ‚Ø· (ØºÙŠØ± Ø§Ù„Ù…Ø³ØªÙˆØ±Ø¯Ø©)
    this.properties.forEach(property => {
        if (property._imported || property.imported || property.source === 'import') return;
// Ù„Ø§ Ù†Ø³ØªØ«Ù†ÙŠ Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø³ØªÙˆØ±Ø¯Ø© Ù‡Ù†Ø§ Ù„Ø£Ù†Ù†Ø§ Ù†Ø±ÙŠØ¯ Ø¹Ø±Ø¶Ù‡Ø§ ÙÙŠ Ø§Ù„Ù†Ø§ÙØ°Ø©
if (property.units && property.units.length > 0) {
property.units.forEach((unit, index) => {
const rentalValue = unit.rentalValue || 0;
const tax = unit.tax || 0;
// Ø­Ø³Ø§Ø¨ Ù…Ø¹ÙÙŠ Ù‚117 ÙˆØ§Ù„Ù…Ù‚ØªØ¶Ù‰ Ø¥Ø¶Ø§ÙØªÙ‡
let exemptValue = 0;
let payableValue = tax;
// Ø®ØµÙ… 120 Ø¬Ù†ÙŠÙ‡Ø§Ù‹ ÙÙ‚Ø· Ù„Ù„ÙˆØ­Ø¯Ø§Øª ØºÙŠØ± Ø§Ù„Ø³ÙƒÙ†ÙŠØ©
if (unit.useType !== 'residential') {
exemptValue = 120;
payableValue = Math.max(tax - exemptValue, 0);
}
totalRental += rentalValue;
totalTax += tax;
totalExempt += exemptValue;
totalPayable += payableValue;
const tr = document.createElement('tr');
tr.innerHTML = `
<td>${property.propertyNumber}</td>
<td>${property.street || '--'}</td>
<td>${property.district || '--'}</td>
<td>${property.city || '--'}</td>
<td>${property.owner || '--'}</td>
<td>${unit.number || index + 1}</td> <!-- Ø±Ù‚Ù… Ø§Ù„ÙˆØ­Ø¯Ø© -->
<td>${unit.floor || '--'}</td>
<td>${unit.activity || '--'}</td>
<td>${this.formatCurrency(rentalValue)}</td>
<td>${this.formatCurrency(tax)}</td>
<!-- Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù…ÙˆØ¯ÙŠÙ† Ø§Ù„Ø¬Ø¯ÙŠØ¯ÙŠÙ† Ù‡Ù†Ø§ -->
<td>${this.formatCurrency(exemptValue)}</td>
<td>${this.formatCurrency(payableValue)}</td>
`;
tbody.appendChild(tr);
});
}
});
// ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ
document.getElementById('total-rental').textContent = this.formatCurrency(totalRental);
document.getElementById('total-tax').textContent = this.formatCurrency(totalTax);
document.getElementById('total-exempt').textContent = this.formatCurrency(totalExempt);
document.getElementById('total-payable').textContent = this.formatCurrency(totalPayable);
// Ø¥Ø°Ø§ Ù„Ù… ØªÙƒÙ† Ù‡Ù†Ø§Ùƒ Ø¨ÙŠØ§Ù†Ø§Øª
if (tbody.children.length === 0) {
tbody.innerHTML = `
<tr>
<td colspan="12" style="text-align: center; padding: 30px; color: var(--gray);">
<i class="fas fa-inbox"></i>
<h3>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù‚Ø§Ø±Ø§Øª Ù…Ø³Ø¬Ù„Ø©</h3>
<p>Ù‚Ù… Ø¨Ø¥Ø¶Ø§ÙØ© Ø¹Ù‚Ø§Ø±Ø§Øª Ø£ÙˆÙ„Ø§Ù‹ Ù„Ø¹Ø±Ø¶Ù‡Ø§ ÙÙŠ Ù‚Ø±Ø§Ø± Ø§Ù„Ø¥Ø¶Ø§ÙØ©</p>
</td>
</tr>
`;
}
},
// Ø·Ø¨Ø§Ø¹Ø© Ù‚Ø±Ø§Ø± Ø§Ù„Ø¥Ø¶Ø§ÙØ©
printDecision: function() {
window.print();
},
// ======== ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø®Ø±ÙŠØ·Ø© ========
// ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø®Ø±ÙŠØ·Ø©
updateMap: function() {
const mapContainer = document.getElementById('map');
mapContainer.innerHTML = '';
if (this.properties.length === 0) {
mapContainer.innerHTML = `
<div class="empty-data" style="height: 500px; display: flex; flex-direction: column; justify-content: center;">
<i class="fas fa-map-marked-alt"></i>
<h3>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù‚Ø§Ø±Ø§Øª Ù…Ø³Ø¬Ù„Ø©</h3>
<p>Ù‚Ù… Ø¨Ø¥Ø¶Ø§ÙØ© Ø¹Ù‚Ø§Ø±Ø§Øª Ù„Ø¹Ø±Ø¶Ù‡Ø§ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø©</p>
</div>
`;
return;
}
// Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø®Ø±ÙŠØ·Ø©
mapContainer.innerHTML = '<div id="map-canvas" style="height: 100%;"></div>';
this.map = L.map('map-canvas').setView([30.0444, 31.2357], 8);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
}).addTo(this.map);
// Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù„Ø§Ù…Ø§Øª
    this.properties.forEach(property => {
      // Ù„Ø§ Ù†Ø³ØªØ«Ù†ÙŠ Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø³ØªÙˆØ±Ø¯Ø© Ù‡Ù†Ø§ Ù„Ø£Ù†Ù†Ø§ Ù†Ø±ÙŠØ¯ Ø¹Ø±Ø¶Ù‡Ø§ ÙÙŠ Ø§Ù„Ù†Ø§ÙØ°Ø©
if (property.coordinates) {
const [lat, lng] = property.coordinates.split(',').map(coord => parseFloat(coord.trim()));
if (!isNaN(lat) && !isNaN(lng)) {
// ØªØ­Ø¯ÙŠØ¯ Ù„ÙˆÙ† Ø§Ù„Ø¹Ù„Ø§Ù…Ø© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ ÙˆØ¬ÙˆØ¯ Ø§Ù„ØµÙˆØ±
const iconColor = property.images && property.images.length > 0 ? 'green' : 'blue';
const marker = L.marker([lat, lng], {
icon: L.divIcon({
className: 'custom-icon',
html: `<div style="background-color: ${iconColor}; width: 12px; height: 12px; border-radius: 50%; border: 2px solid white;"></div>`,
iconSize: [20, 20]
})
}).addTo(this.map);
// Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø¨ÙˆØ¨ Ø£Ø¨
let popupContent = `
<div class="map-popup-content">
<h3>Ø¹Ù‚Ø§Ø± ${property.propertyNumber}</h3>
<p><strong>Ø§Ù„Ù…ÙˆÙ‚Ø¹:</strong> ${property.governorate} - ${property.city} - ${property.district}</p>
<p><strong>Ø§Ù„Ø´Ø§Ø±Ø¹:</strong> ${property.street} (Ø¹Ø±Ø¶: ${property.streetWidth || '--'} Ù…ØªØ±)</p>
<p><strong>Ø§Ù„Ù…Ø§Ù„Ùƒ:</strong> ${property.owner}</p>
<p><strong>Ø³Ù†Ø© Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡:</strong> ${property.constructionYear || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</p>
<p><strong>Ø¹Ø¯Ø¯ Ø§Ù„ÙˆØ­Ø¯Ø§Øª:</strong> ${property.units?.length || 0}</p>
<hr style="margin: 10px 0; border-top: 1px solid #eee;">
<h4>Ø§Ù„ÙˆØ­Ø¯Ø§Øª:</h4>
`;
if (property.units && property.units.length > 0) {
property.units.forEach((unit, index) => {
popupContent += `
<div class="unit-item">
<p><strong>Ø§Ù„ÙˆØ­Ø¯Ø© ${index + 1}:</strong> ${this.getUnitTypeName(unit.unitType)} - Ø§Ù„Ø¯ÙˆØ± ${unit.floor}</p>
<p><strong>Ø§Ù„Ù…Ø³Ø§Ø­Ø©:</strong> ${unit.area} Ù…Â² - <strong>Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø³ÙˆÙ‚ÙŠØ©:</strong> ${unit.marketValue ? this.formatCurrency(unit.marketValue) : '--'}</p>
<p><strong>Ø§Ù„Ù†Ø´Ø§Ø·:</strong> ${unit.activity || '--'}</p>
</div>
`;
});
} else {
popupContent += '<p>Ù„Ø§ ØªÙˆØ¬Ø¯ ÙˆØ­Ø¯Ø§Øª Ù…Ø³Ø¬Ù„Ø©</p>';
}
popupContent += `</div>`;
marker.bindPopup(popupContent);
}
}
});
},
// Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø¹Ø¨Ø± GPS
getGPSLocation: function() {
const loader = document.getElementById('gps-loader');
const icon = document.getElementById('get-gps').querySelector('i');
const statusEl = document.getElementById('gps-status');
// Ø¥Ø¸Ù‡Ø§Ø± Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„ ÙˆØ¥Ø®ÙØ§Ø¡ Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø©
loader.style.display = 'inline-block';
icon.style.display = 'none';
statusEl.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆÙ‚Ø¹...';
statusEl.className = 'gps-status';
if (navigator.geolocation) {
navigator.geolocation.getCurrentPosition(
(position) => {
const lat = position.coords.latitude;
const lng = position.coords.longitude;
document.getElementById('coordinates').value = `${lat}, ${lng}`;
// Ø¥Ø®ÙØ§Ø¡ Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„ ÙˆØ¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø©
loader.style.display = 'none';
icon.style.display = 'inline-block';
statusEl.textContent = 'ØªÙ… Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø¨Ù†Ø¬Ø§Ø­!';
statusEl.className = 'gps-status success';
this.showNotification('ØªÙ… Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø¨Ù†Ø¬Ø§Ø­');
},
(error) => {
// Ø¥Ø®ÙØ§Ø¡ Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„ ÙˆØ¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø©
loader.style.display = 'none';
icon.style.display = 'inline-block';
let errorMessage = 'ÙØ´Ù„ ÙÙŠ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆÙ‚Ø¹: ';
switch(error.code) {
case error.PERMISSION_DENIED:
errorMessage = 'ØªÙ… Ø±ÙØ¶ Ø§Ù„Ø¥Ø°Ù†. ÙŠØ±Ø¬Ù‰ ØªÙ…ÙƒÙŠÙ† Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙÙŠ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªØµÙØ­.';
break;
case error.POSITION_UNAVAILABLE:
errorMessage = 'Ø§Ù„Ù…ÙˆÙ‚Ø¹ ØºÙŠØ± Ù…ØªØ§Ø­ Ø­Ø§Ù„ÙŠÙ‹Ø§.';
break;
case error.TIMEOUT:
errorMessage = 'Ø§Ù†ØªÙ‡Øª Ù…Ù‡Ù„Ø© Ø·Ù„Ø¨ Ø§Ù„Ù…ÙˆÙ‚Ø¹.';
break;
default:
errorMessage = 'Ø®Ø·Ø£ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ Ø£Ø«Ù†Ø§Ø¡ Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆÙ‚Ø¹.';
}
statusEl.textContent = errorMessage;
statusEl.className = 'gps-status error';
this.showNotification(errorMessage, 'error');
},
{
timeout: 10000,
maximumAge: 0,
enableHighAccuracy: true
}
);
} else {
// Ø¥Ø®ÙØ§Ø¡ Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„ ÙˆØ¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø©
loader.style.display = 'none';
icon.style.display = 'inline-block';
statusEl.textContent = 'Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… Ø®Ø¯Ù…Ø© Ø§Ù„Ù…ÙˆÙ‚Ø¹.';
statusEl.className = 'gps-status error';
this.showNotification('Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… Ø®Ø¯Ù…Ø© Ø§Ù„Ù…ÙˆÙ‚Ø¹', 'error');
}
},
// ======== ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ØªØµØ¯ÙŠØ± ÙˆØ§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯ ========
// ØªØµØ¯ÙŠØ± Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© ÙƒØ§Ù…Ù„Ø©
exportBackupAll: function() {
if (this.properties.length === 0) {
this.showNotification('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ØªØµØ¯ÙŠØ±!', 'error');
return;
}
// Ø¥Ø¸Ù‡Ø§Ø± Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„
document.getElementById('loading-overlay').style.display = 'flex';
// ØªØ£Ø®ÙŠØ± Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ØªØµØ¯ÙŠØ± Ù„Ø¶Ù…Ø§Ù† Ø¹Ø±Ø¶ Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„
setTimeout(() => {
try {
const workbook = XLSX.utils.book_new();
// Ø¥Ø¹Ø¯Ø§Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª Ù„Ù„ØªØµØ¯ÙŠØ±
const propertiesData = this.properties.map(property => ({
'Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¹Ù‚Ø§Ø±ÙŠ': property.propertyNumber,
// Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„: ØªØ¶Ù…ÙŠÙ† Ø±Ù‚Ù… Ø§Ù„Ø¹Ù‚Ø§Ø± Ø§Ù„Ø³Ø§Ø¨Ù‚
'Ø±Ù‚Ù… Ø§Ù„Ø¹Ù‚Ø§Ø± Ø§Ù„Ø³Ø§Ø¨Ù‚': property.previousPropertyNumber || '',
'Ø§Ù„Ø´Ø§Ø±Ø¹': property.street,
'Ø¹Ø±Ø¶ Ø§Ù„Ø´Ø§Ø±Ø¹': property.streetWidth,
'Ø§Ù„Ø­Ù‰ / Ø§Ù„Ù‚Ø±ÙŠØ©': property.district,
'Ø§Ù„Ù…Ø±ÙƒØ² / Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©': property.city,
'Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©': property.governorate,
'Ø³Ù†Ø© Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡': property.constructionYear,
'Ù…Ø§Ø¯Ø© Ø§Ù„Ø¨Ù†Ø§Ø¡': this.getBuildingMaterialName(property.buildingMaterial),
'Ø§Ø³Ù… Ø§Ù„Ù…ÙƒÙ„Ù': property.responsibleName,
'Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ù„Ùƒ': property.owner,
// Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„: ØªØ¶Ù…ÙŠÙ† Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ Ù„Ù„Ù…Ø§Ù„Ùƒ
'Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ Ù„Ù„Ù…Ø§Ù„Ùƒ': property.ownerNationalId || '',
'Ø§Ù„Ù…Ø³Ø§Ø­Ø© (Ù…Â²)': property.area,
'Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¯ÙˆØ§Ø±': property.floors,
'Ø¹Ø¯Ø¯ Ø§Ù„ÙˆØ­Ø¯Ø§Øª': property.unitsCount,
'Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù‚Ø§Ø±': property.propertyType,
'Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª': property.coordinates,
'Ø§Ù„ÙˆØµÙ Ø§Ù„ØªÙØµÙŠÙ„ÙŠ Ù„Ù„Ø¹Ù‚Ø§Ø±': property.detailedDescription,
'Ø¹Ø¯Ø¯ Ø§Ù„ØµÙˆØ±': property.images ? property.images.length : 0
}));
// Ø¥Ø¶Ø§ÙØ© ÙˆØ±Ù‚Ø© Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª
const propertiesWs = XLSX.utils.json_to_sheet(propertiesData);
XLSX.utils.book_append_sheet(workbook, propertiesWs, 'Ø§Ù„Ø®ØµØ§Ø¦Øµ');
// Ø¥Ø¹Ø¯Ø§Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙˆØ­Ø¯Ø§Øª Ù„Ù„ØªØµØ¯ÙŠØ±
const unitsData = [];
    this.properties.forEach(property => {
      // Ù„Ø§ Ù†Ø³ØªØ«Ù†ÙŠ Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø³ØªÙˆØ±Ø¯Ø© Ù‡Ù†Ø§ Ù„Ø£Ù†Ù†Ø§ Ù†Ø±ÙŠØ¯ Ø¹Ø±Ø¶Ù‡Ø§ ÙÙŠ Ø§Ù„Ù†Ø§ÙØ°Ø©
property.units.forEach(unit => {
unitsData.push({
'Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¹Ù‚Ø§Ø±ÙŠ': property.propertyNumber,
'Ø§Ù„Ø´Ø§Ø±Ø¹': property.street,
      'Ø§Ù„Ø­Ù‰ / Ø§Ù„Ù‚Ø±ÙŠØ©': property.district,
      'Ø§Ù„Ø¯ÙˆØ±': unit.floor,
'Ø±Ù‚Ù… Ø§Ù„ÙˆØ­Ø¯Ø©': unit.number || '', // Ø±Ù‚Ù… Ø§Ù„ÙˆØ­Ø¯Ø©
'Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ù„Ùƒ': unit.owner,
// Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„: ØªØ¶Ù…ÙŠÙ† Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ Ù„Ù„Ù…Ø§Ù„Ùƒ Ù„Ù„ÙˆØ­Ø¯Ø©
'Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ Ù„Ù„Ù…Ø§Ù„Ùƒ': unit.ownerNationalId || '',
'Ø§Ù„Ù…Ø³Ø§Ø­Ø© (Ù…Â²)': unit.area,
'Ù†ÙˆØ¹ Ø§Ù„ÙˆØ­Ø¯Ø©': this.getUnitTypeName(unit.unitType),
'Ù†ÙˆØ¹ Ø§Ù„Ø§Ø³ØªØºÙ„Ø§Ù„': this.getUseTypeName(unit.useType),
'Ø§Ù„Ù†Ø´Ø§Ø·': unit.activity || '',
'Ø­Ø§Ù„Ø© Ø§Ù„ÙˆØ­Ø¯Ø©': unit.status === 'complete' ? 'ØªØ§Ù…Ø©' : unit.status === 'incomplete' ? 'ØºÙŠØ± ØªØ§Ù…Ø©' : 'Ù…Ø´ØºÙˆÙ„Ø©',
'Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø³ÙˆÙ‚ÙŠØ©': unit.marketValue || 0,
'Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¥ÙŠØ¬Ø§Ø±ÙŠØ©': unit.rentalValue || 0,
'ØµØ§ÙÙŠ Ø§Ù„Ø¥ÙŠØ¬Ø§Ø±': unit.netRentalValue || 0,
'Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©': unit.tax || 0
});
});
});
// Ø¥Ø¶Ø§ÙØ© ÙˆØ±Ù‚Ø© Ø§Ù„ÙˆØ­Ø¯Ø§Øª
const unitsWs = XLSX.utils.json_to_sheet(unitsData);
XLSX.utils.book_append_sheet(workbook, unitsWs, 'Ø§Ù„ÙˆØ­Ø¯Ø§Øª');
// Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ù
XLSX.writeFile(workbook, this.ensureFileExtension("backup_real_estate_data", "xlsx"));
this.showNotification('ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­!');
} catch (error) {
console.error('Error exporting backup:', error);
this.showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØµØ¯ÙŠØ±', 'error');
} finally {
// Ø¥Ø®ÙØ§Ø¡ Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„
document.getElementById('loading-overlay').style.display = 'none';
}
}, 500);
},
// ØªØµØ¯ÙŠØ± Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù‚Ø§Ø± Ø¥Ù„Ù‰ Excel
exportPropertyExcel: function() {
if (!this.currentProperty) {
this.showNotification('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¹Ù‚Ø§Ø± Ù…Ø­Ø¯Ø¯ Ù„Ù„ØªØµØ¯ÙŠØ±', 'error');
return;
}
const propertyData = [{
'Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¹Ù‚Ø§Ø±ÙŠ': this.currentProperty.propertyNumber,
// Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„: ØªØ¶Ù…ÙŠÙ† Ø±Ù‚Ù… Ø§Ù„Ø¹Ù‚Ø§Ø± Ø§Ù„Ø³Ø§Ø¨Ù‚
'Ø±Ù‚Ù… Ø§Ù„Ø¹Ù‚Ø§Ø± Ø§Ù„Ø³Ø§Ø¨Ù‚': this.currentProperty.previousPropertyNumber || '',
'Ø§Ù„Ø´Ø§Ø±Ø¹': this.currentProperty.street,
'Ø¹Ø±Ø¶ Ø§Ù„Ø´Ø§Ø±Ø¹': this.currentProperty.streetWidth,
'Ø§Ù„Ø­Ù‰ / Ø§Ù„Ù‚Ø±ÙŠØ©': this.currentProperty.district,
'Ø§Ù„Ù…Ø±ÙƒØ² / Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©': this.currentProperty.city,
'Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©': this.currentProperty.governorate,
'Ø³Ù†Ø© Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡': this.currentProperty.constructionYear,
'Ù…Ø§Ø¯Ø© Ø§Ù„Ø¨Ù†Ø§Ø¡': this.getBuildingMaterialName(this.currentProperty.buildingMaterial),
'Ø§Ø³Ù… Ø§Ù„Ù…ÙƒÙ„Ù': this.currentProperty.responsibleName,
'Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ù„Ùƒ': this.currentProperty.owner,
// Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„: ØªØ¶Ù…ÙŠÙ† Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ Ù„Ù„Ù…Ø§Ù„Ùƒ
'Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ Ù„Ù„Ù…Ø§Ù„Ùƒ': this.currentProperty.ownerNationalId || '',
'Ø§Ù„Ù…Ø³Ø§Ø­Ø© (Ù…Â²)': this.currentProperty.area,
'Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¯ÙˆØ§Ø±': this.currentProperty.floors,
'Ø¹Ø¯Ø¯ Ø§Ù„ÙˆØ­Ø¯Ø§Øª': this.currentProperty.unitsCount,
'Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù‚Ø§Ø±': this.currentProperty.propertyType,
'Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª': this.currentProperty.coordinates,
'Ø§Ù„ÙˆØµÙ Ø§Ù„ØªÙØµÙŠÙ„ÙŠ Ù„Ù„Ø¹Ù‚Ø§Ø±': this.currentProperty.detailedDescription
}];
const ws = XLSX.utils.json_to_sheet(propertyData);
const wb = XLSX.utils.book_new();
XLSX.utils.book_append_sheet(wb, ws, 'Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù‚Ø§Ø±');
XLSX.writeFile(wb, this.ensureFileExtension('Ø¨ÙŠØ§Ù†Ø§Øª_Ø§Ù„Ø¹Ù‚Ø§Ø±', 'xlsx'));
},
// ØªØµØ¯ÙŠØ± Ø§Ù„ÙˆØ­Ø¯Ø§Øª Ø¥Ù„Ù‰ Excel
exportUnitsExcel: function() {
if (this.units.length === 0) {
this.showNotification('Ù„Ø§ ØªÙˆØ¬Ø¯ ÙˆØ­Ø¯Ø§Øª Ù„ØªØµØ¯ÙŠØ±Ù‡Ø§', 'error');
return;
}
const data = this.units.map(unit => ({
'Ø§Ù„Ø´Ø§Ø±Ø¹': property.street,
      'Ø§Ù„Ø­Ù‰ / Ø§Ù„Ù‚Ø±ÙŠØ©': property.district,
      'Ø§Ù„Ø¯ÙˆØ±': unit.floor,
'Ø±Ù‚Ù… Ø§Ù„ÙˆØ­Ø¯Ø©': unit.number || '', // Ø±Ù‚Ù… Ø§Ù„ÙˆØ­Ø¯Ø©
'Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ù„Ùƒ': unit.owner,
// Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„: ØªØ¶Ù…ÙŠÙ† Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ Ù„Ù„Ù…Ø§Ù„Ùƒ Ù„Ù„ÙˆØ­Ø¯Ø©
'Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ Ù„Ù„Ù…Ø§Ù„Ùƒ': unit.ownerNationalId || '',
'Ø§Ù„Ù…Ø³Ø§Ø­Ø© (Ù…Â²)': unit.area,
'Ù†ÙˆØ¹ Ø§Ù„ÙˆØ­Ø¯Ø©': this.getUnitTypeName(unit.unitType),
'Ù†ÙˆØ¹ Ø§Ù„Ø§Ø³ØªØºÙ„Ø§Ù„': this.getUseTypeName(unit.useType),
'Ø§Ù„Ù†Ø´Ø§Ø·': unit.activity || '',
'Ø­Ø§Ù„Ø© Ø§Ù„ÙˆØ­Ø¯Ø©': unit.status === 'complete' ? 'ØªØ§Ù…Ø©' : unit.status === 'incomplete' ? 'ØºÙŠØ± ØªØ§Ù…Ø©' : 'Ù…Ø´ØºÙˆÙ„Ø©',
'Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø³ÙˆÙ‚ÙŠØ©': unit.marketValue || 0,
'Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¥ÙŠØ¬Ø§Ø±ÙŠØ©': unit.rentalValue || 0,
'ØµØ§ÙÙŠ Ø§Ù„Ø¥ÙŠØ¬Ø§Ø±': unit.netRentalValue || 0,
'Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©': unit.tax || 0
}));
const ws = XLSX.utils.json_to_sheet(data);
const wb = XLSX.utils.book_new();
XLSX.utils.book_append_sheet(wb, ws, 'ÙˆØ­Ø¯Ø§Øª Ø§Ù„Ø¹Ù‚Ø§Ø±');
XLSX.writeFile(wb, this.ensureFileExtension('ÙˆØ­Ø¯Ø§Øª_Ø§Ù„Ø¹Ù‚Ø§Ø±', 'xlsx'));
},
// ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø¥Ù„Ù‰ Excel
exportValuationExcel: function() {
if (this.units.length === 0) {
this.showNotification('Ù„Ø§ ØªÙˆØ¬Ø¯ ÙˆØ­Ø¯Ø§Øª Ù„ØªØµØ¯ÙŠØ± ØªÙ‚ÙŠÙŠÙ…Ù‡Ø§', 'error');
return;
}
// Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
const totalMarketValue = this.units.reduce((sum, unit) => sum + (unit.marketValue || 0), 0);
const totalRentalValue = this.units.reduce((sum, unit) => sum + (unit.rentalValue || 0), 0);
const totalTax = this.units.reduce((sum, unit) => sum + (unit.tax || 0), 0);
const totalArea = this.units.reduce((sum, unit) => sum + (parseFloat(unit.area) || 0), 0);
const avgPricePerMeter = totalArea > 0 ? totalMarketValue / totalArea : 0;
const valuationData = [{
'Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø³ÙˆÙ‚ÙŠØ©': this.formatCurrency(totalMarketValue),
'Ù…ØªÙˆØ³Ø· Ø³Ø¹Ø± Ø§Ù„Ù…ØªØ±': this.formatCurrency(avgPricePerMeter),
'Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¥ÙŠØ¬Ø§Ø±ÙŠØ©': this.formatCurrency(totalRentalValue),
'ØµØ§ÙÙŠ Ø§Ù„Ø¥ÙŠØ¬Ø§Ø±': this.units.reduce((sum, unit) => sum + (unit.netRentalValue || 0), 0),
'Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ø¹Ù‚Ø§Ø±ÙŠØ©': this.formatCurrency(totalTax),
'Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªØ´Ø§Ø¨Ù‡': this.similarityLevel
}];
// Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙˆØ­Ø¯Ø§Øª Ø§Ù„Ù…Ø´Ø§Ø¨Ù‡Ø©
const similarUnitsData = this.similarUnits.map(unit => ({
'Ø§Ù„Ù…ØµØ¯Ø±': unit.source,
'Ø§Ù„Ø´Ø§Ø±Ø¹': unit.street,
'Ø§Ù„Ù…Ù†Ø·Ù‚Ø©': unit.district,
'Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©': unit.city,
'Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©': unit.governorate,
'Ù†ÙˆØ¹ Ø§Ù„ÙˆØ­Ø¯Ø©': unit.unitType,
'Ø§Ù„Ù…Ù…Ø³Ø§Ø­Ø©': unit.area,
'Ø³Ø¹Ø± Ø§Ù„Ù…ØªØ±': unit.pricePerMeter,
'Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ': unit.price,
'Ø³Ù†Ø© Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡': unit.constructionYear,
'Ø§Ù„ÙˆØµÙ Ø§Ù„ØªÙØµÙŠÙ„ÙŠ Ù„Ù„Ø¹Ù‚Ø§Ø±': unit.description
}));
const wb = XLSX.utils.book_new();
// ÙˆØ±Ù‚Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙ‚ÙŠÙŠÙ…
const valuationWs = XLSX.utils.json_to_sheet(valuationData);
XLSX.utils.book_append_sheet(wb, valuationWs, 'Ø§Ù„ØªÙ‚ÙŠÙŠÙ…');
// ÙˆØ±Ù‚Ø© Ø§Ù„ÙˆØ­Ø¯Ø§Øª Ø§Ù„Ù…Ø´Ø§Ø¨Ù‡Ø©
const similarWs = XLSX.utils.json_to_sheet(similarUnitsData);
XLSX.utils.book_append_sheet(wb, similarWs, 'ÙˆØ­Ø¯Ø§Øª Ù…Ø´Ø§Ø¨Ù‡Ø©');
XLSX.writeFile(wb, this.ensureFileExtension('ØªÙ‚Ø±ÙŠØ±_Ø§Ù„ØªÙ‚ÙŠÙŠÙ…', 'xlsx'));
},
// ØªØµØ¯ÙŠØ± Ù‚Ø±Ø§Ø± Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ Excel
exportAdditionExcel: function() {
const table = document.querySelector("#addition-section .addition-table table");
if (!table) {
this.showNotification('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'error');
return;
}
const workbook = XLSX.utils.table_to_book(table, { sheet: "Ù‚Ø±Ø§Ø± Ø§Ù„Ø¥Ø¶Ø§ÙØ©" });
XLSX.writeFile(workbook, this.ensureFileExtension("Ù‚Ø±Ø§Ø±_Ø§Ù„Ø¥Ø¶Ø§ÙØ©", "xlsx"));
},
// ØªØµØ¯ÙŠØ± Ø§Ù„Ø®Ø±ÙŠØ·Ø© ÙƒØµÙˆØ±Ø©
exportMapImage: function() {
const mapCanvas = document.getElementById('map');
html2canvas(mapCanvas).then(canvas => {
const link = document.createElement('a');
link.download = this.ensureFileExtension('Ø§Ù„Ø®Ø±ÙŠØ·Ø©_Ø§Ù„Ø¹Ù‚Ø§Ø±ÙŠØ©', 'png');
link.href = canvas.toDataURL('image/png');
link.click();
});
},
// Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³ÙˆÙ‚
importMarketData: function() {
const input = document.createElement('input');
input.type = 'file';
input.accept = '.xlsx, .xls';
input.onchange = e => {
const file = e.target.files[0];
if (!file) return;
const reader = new FileReader();
reader.onload = function(e) {
try {
const data = new Uint8Array(e.target.result);
const workbook = XLSX.read(data, {type: 'array'});
// Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„ÙˆØ±Ù‚Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰
const firstSheetName = workbook.SheetNames[0];
const worksheet = workbook.Sheets[firstSheetName];
// ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰ JSON
const jsonData = XLSX.utils.sheet_to_json(worksheet);
// Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªÙˆØ±Ø¯Ø©
const processedData = jsonData.map(item => ({
id: item.id || Math.random().toString(36).substr(2, 9),
governorate: item.Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø© || item.governorate || "--",
city: item.Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© || item.city || "--",
district: item.Ø§Ù„Ù…Ù†Ø·Ù‚Ø© || item.district || "--",
street: item.Ø§Ù„Ø´Ø§Ø±Ø¹ || item.street || "--",
constructionYear: item.Ø³Ù†Ø©_Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡ || item.year || 2000,
area: item.Ø§Ù„Ù…Ø³Ø§Ø­Ø© || item.area || 0,
unitType: item.Ù†ÙˆØ¹_Ø§Ù„ÙˆØ­Ø¯Ø© || item.type || "Ø´Ù‚Ø©",
price: item.Ø§Ù„Ø³Ø¹Ø± || item.price || 0,
pricePerMeter: item.Ø³Ø¹Ø±_Ø§Ù„Ù…ØªØ± || item.pricePerMeter || 0,
description: item.Ø§Ù„ÙˆØµÙ || item.description || "",
similarity: item.Ø§Ù„ØªØ´Ø§Ø¨Ù‡ || "governorate",
source: "Ù…Ù„Ù Ù…Ø³ØªÙˆØ±Ø¯"
}));
// ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³ÙˆÙ‚
this.marketData = {
lastUpdated: new Date().toISOString(),
properties: processedData,
source: file.name
};
localStorage.setItem('realEstateMarketData', JSON.stringify(this.marketData));
// ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
const updateDate = new Date(this.marketData.lastUpdated).toLocaleDateString('ar-EG');
document.getElementById('market-update-date').textContent = updateDate;
document.getElementById('market-data-source').textContent = this.marketData.source;
document.getElementById('market-ads-count').textContent = this.marketData.properties.length;
// Ø¹Ø±Ø¶ Ù…Ø¹Ø§ÙŠÙ†Ø© Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªÙˆØ±Ø¯Ø©
const preview = document.getElementById('market-data-preview');
preview.innerHTML = `
<div class="market-preview">
<h4>Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªÙˆØ±Ø¯Ø© (5 ÙˆØ­Ø¯Ø§Øª)</h4>
<table>
<thead>
<tr>
<th>Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©</th>
<th>Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</th>
<th>Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</th>
<th>Ø§Ù„Ø´Ø§Ø±Ø¹</th>
<th>Ø§Ù„Ù…Ø³Ø§Ø­Ø©</th>
<th>Ø§Ù„Ø³Ø¹Ø±</th>
</tr>
</thead>
<tbody>
${this.marketData.properties.slice(0, 5).map(item => `
<tr>
<td>${item.governorate}</td>
<td>${item.city}</td>
<td>${item.district}</td>
<td>${item.street}</td>
<td>${item.area} Ù…Â²</td>
<td>${this.formatCurrency(item.price)}</td>
</tr>
`).join('')}
</tbody>
</table>
</div>
`;
this.showNotification('ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³ÙˆÙ‚ Ø¨Ù†Ø¬Ø§Ø­ Ù…Ù† Ø§Ù„Ù…Ù„Ù!');
} catch (error) {
console.error('Error processing Excel file:', error);
this.showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ù…Ø¹Ø§Ù„Ø¬Ø© Ù…Ù„Ù Excel', 'error');
}
}.bind(this);
reader.readAsArrayBuffer(file);
};
input.click();
},
// Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª
importProperties: function(mode = 'merge') {
const input = document.createElement('input');
input.type = 'file';
input.accept = '.xlsx, .xls';
input.onchange = e => {
  const file = e.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = function(e) {
    try {
      const data = new Uint8Array(e.target.result);
      const workbook = XLSX.read(data, { type: 'array' });

      // try to detect sheets: properties sheet and units sheet
      const sheetNames = workbook.SheetNames || [];
      const propSheetName = sheetNames.find(n => /Ø§Ù„Ø®ØµØ§Ø¦Øµ|Ø¨ÙŠØ§Ù†Ø§Øª|properties|properties/i.test(n)) || sheetNames[0];
      const unitsSheetName = sheetNames.find(n => /ÙˆØ­Ø¯Ø§Øª|units/i.test(n)) || null;

      // read properties sheet (expect headers in first row)
      const propsSheet = workbook.Sheets[propSheetName];
      const propsJson = XLSX.utils.sheet_to_json(propsSheet);

      // normalize and prepare importedProperties
      this.importedProperties = (propsJson || []).map((item, idx) => ({
        id: item['id'] || item.id || Date.now() + idx,
        propertyNumber: item['Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¹Ù‚Ø§Ø±ÙŠ'] || item.propertyNumber || item['Ø±Ù‚Ù… Ø§Ù„Ø¹Ù‚Ø§Ø±'] || '',
        previousPropertyNumber: item['Ø±Ù‚Ù… Ø§Ù„Ø¹Ù‚Ø§Ø± Ø§Ù„Ø³Ø§Ø¨Ù‚'] || item.previousPropertyNumber || '',
        street: item['Ø§Ù„Ø´Ø§Ø±Ø¹'] || item.street || '',
        streetWidth: item['Ø¹Ø±Ø¶ Ø§Ù„Ø´Ø§Ø±Ø¹'] || item.streetWidth || '',
        district: item['Ø§Ù„Ø­Ù‰ / Ø§Ù„Ù‚Ø±ÙŠØ©'] || item['Ø§Ù„Ø­Ù‰/Ø§Ù„Ù‚Ø±ÙŠØ©'] || item['Ø§Ù„Ù…Ù†Ø·Ù‚Ø©'] || item.district || '',
        city: item['Ø§Ù„Ù…Ø±ÙƒØ² / Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©'] || item.city || '',
        governorate: item['Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©'] || item.governorate || '',
        constructionYear: item['Ø³Ù†Ø© Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡'] || item.constructionYear || '',
        buildingMaterial: item['Ù…Ø§Ø¯Ø© Ø§Ù„Ø¨Ù†Ø§Ø¡'] || item.buildingMaterial || 'concrete',
        responsibleName: item['Ø§Ø³Ù… Ø§Ù„Ù…ÙƒÙ„Ù'] || item.responsibleName || '',
        owner: item['Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ù„Ùƒ'] || item.owner || '',
        ownerNationalId: item['Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ Ù„Ù„Ù…Ø§Ù„Ùƒ'] || item.ownerNationalId || '',
        area: parseFloat(item['Ø§Ù„Ù…Ø³Ø§Ø­Ø© (Ù…Â²)'] || item['Ø§Ù„Ù…Ø³Ø§Ø­Ø©'] || item.area || 0) || 0,
        floors: parseInt(item['Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¯ÙˆØ§Ø±'] || item.floors || 0) || 0,
        unitsCount: parseInt(item['Ø¹Ø¯Ø¯ Ø§Ù„ÙˆØ­Ø¯Ø§Øª'] || item.unitsCount || 0) || 0,
        propertyType: item['Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù‚Ø§Ø±'] || item.propertyType || 'residential',
        coordinates: item['Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª'] || item.coordinates || '',
        detailedDescription: item['Ø§Ù„ÙˆØµÙ Ø§Ù„ØªÙØµÙŠÙ„ÙŠ Ù„Ù„Ø¹Ù‚Ø§Ø±'] || item['Ø§Ù„ÙˆØµÙ'] || item.detailedDescription || '',
        images: [],
        units: []
      }));
      this.importedProperties.forEach(p => p._imported = true);

      // if a units sheet exists, parse it and attach units to their parent properties
      if (unitsSheetName) {
        const unitsSheet = workbook.Sheets[unitsSheetName];
        const unitsJson = XLSX.utils.sheet_to_json(unitsSheet) || [];
        unitsJson.forEach(u => {
          const unitObj = {
            floor: (u['Ø§Ù„Ø¯ÙˆØ±'] || u.floor || '0').toString(),
            number: u['Ø±Ù‚Ù… Ø§Ù„ÙˆØ­Ø¯Ø©'] || u.number || u['Ø±Ù‚Ù…'] || '',
            owner: u['Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ù„Ùƒ'] || u.owner || '',
            ownerNationalId: u['Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ Ù„Ù„Ù…Ø§Ù„Ùƒ'] || u.ownerNationalId || '',
            area: parseFloat(u['Ø§Ù„Ù…Ø³Ø§Ø­Ø© (Ù…Â²)'] || u['Ø§Ù„Ù…Ø³Ø§Ø­Ø©'] || u.area || 0) || 0,
            unitType: u['Ù†ÙˆØ¹ Ø§Ù„ÙˆØ­Ø¯Ø©'] || u.unitType || '',
            useType: u['Ù†ÙˆØ¹ Ø§Ù„Ø§Ø³ØªØºÙ„Ø§Ù„'] || u.useType || '',
            activity: u['Ø§Ù„Ù†Ø´Ø§Ø·'] || u.activity || '',
            status: u['Ø­Ø§Ù„Ø© Ø§Ù„ÙˆØ­Ø¯Ø©'] || u.status || '',
            marketValue: parseFloat(u['Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø³ÙˆÙ‚ÙŠØ©'] || u.marketValue || 0) || 0,
            rentalValue: parseFloat(u['Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¥ÙŠØ¬Ø§Ø±ÙŠØ©'] || u.rentalValue || 0) || 0,
            netRentalValue: parseFloat(u['ØµØ§ÙÙŠ Ø§Ù„Ø¥ÙŠØ¬Ø§Ø±'] || u.netRentalValue || 0) || 0,
            tax: parseFloat(u['Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©'] || u.tax || 0) || 0,
            // sometimes units include reference to parent property
            propertyNumber: u['Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¹Ù‚Ø§Ø±ÙŠ'] || u.propertyNumber || ''
          };
          // try to find parent property by propertyNumber first
          let parent = this.importedProperties.find(p => p.propertyNumber && p.propertyNumber.toString() === (unitObj.propertyNumber || '').toString());
          if (!parent) {
            // fallback: match by street + district if possible
            parent = this.importedProperties.find(p => (p.street && p.street === (u['Ø§Ù„Ø´Ø§Ø±Ø¹'] || u.street || '')) && (p.district && p.district === (u['Ø§Ù„Ø­Ù‰ / Ø§Ù„Ù‚Ø±ÙŠØ©'] || u['Ø§Ù„Ù…Ù†Ø·Ù‚Ø©'] || u.district || '')));
          }
          if (parent) {
            parent.units = parent.units || [];
            parent.units.push(unitObj);
          } else {
            // if no parent match, attach to the first imported property as fallback (if any)
            if (this.importedProperties.length > 0) {
              this.importedProperties[0].units = this.importedProperties[0].units || [];
              this.importedProperties[0].units.push(unitObj);
            }
          }
        });
      }

      // merge/replace/add behavior
      let addedCount = 0, updatedCount = 0, duplicateCount = 0;
      if (mode === 'replace') {
        this.properties = JSON.parse(JSON.stringify(this.importedProperties));
      } else if (mode === 'add') {
        this.importedProperties.forEach(importedProp => {
          const exists = this.properties.find(p => p.propertyNumber === importedProp.propertyNumber && p.street === importedProp.street && p.district === importedProp.district);
          if (!exists) {
            this.properties.push(JSON.parse(JSON.stringify(importedProp)));
            addedCount++;
          } else {
            duplicateCount++;
          }
        });
      } else { // merge
        this.importedProperties.forEach(importedProp => {
          const existingIndex = this.properties.findIndex(p => p.propertyNumber === importedProp.propertyNumber && p.street === importedProp.street && p.district === importedProp.district);
          if (existingIndex !== -1) {
            // keep existing units (do not overwrite unless explicit)
            const existingUnits = this.properties[existingIndex].units || [];
            this.properties[existingIndex] = Object.assign({}, JSON.parse(JSON.stringify(importedProp)), { id: this.properties[existingIndex].id, units: existingUnits });
            updatedCount++;
          } else {
            this.properties.push(JSON.parse(JSON.stringify(importedProp)));
            addedCount++;
          }
        });
      }

      // persist and update UI
      localStorage.setItem('realEstateProperties', JSON.stringify(this.properties));
      try {
        document.getElementById('imported-count').textContent = this.importedProperties.length;
        if (document.getElementById('added-count')) document.getElementById('added-count').textContent = addedCount;
        if (document.getElementById('updated-count')) document.getElementById('updated-count').textContent = updatedCount;
        if (document.getElementById('duplicate-count')) document.getElementById('duplicate-count').textContent = duplicateCount;
        if (document.getElementById('merge-status')) document.getElementById('merge-status').classList.add('visible');
      } catch (e) {}
      this.updateMap();
      this.fillAdditionTable();
      this.showNotification('ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª Ø¨Ù†Ø¬Ø§Ø­');
    } catch (error) {
      console.error('Error importing properties:', error);
      this.showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ù…Ù„Ù', 'error');
    }
  }.bind(this);
  reader.readAsArrayBuffer(file);
};
input.click();
},confirmMerge: function() {
// Ø­ÙØ¸ ÙÙŠ localStorage
localStorage.setItem('realEstateProperties', JSON.stringify(this.properties));
// ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
this.updateMap();
this.fillAdditionTable(); // ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙˆÙ„ Ù‚Ø±Ø§Ø± Ø§Ù„Ø¥Ø¶Ø§ÙØ©
// Ø¥Ø®ÙØ§Ø¡ Ù‚Ø³Ù… Ø§Ù„Ù†ØªØ§Ø¦Ø¬
document.getElementById('merge-status').classList.remove('visible');
this.showNotification('ØªÙ… Ø¯Ù…Ø¬ Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø³ØªÙˆØ±Ø¯Ø© Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­');
},
// Ø¥Ù„ØºØ§Ø¡ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø¯Ù…Ø¬
cancelMerge: function() {
// Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ØµÙ„ÙŠØ©
this.loadData();
// Ø¥Ø®ÙØ§Ø¡ Ù‚Ø³Ù… Ø§Ù„Ù†ØªØ§Ø¦Ø¬
document.getElementById('merge-status').classList.remove('visible');
this.showNotification('ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø¯Ù…Ø¬');
},
// ======== ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© ÙˆØ§Ù„ØªØµØ¯ÙŠØ± Ù„Ù„Ø§Ø³ØªÙ…Ø§Ø±Ø§Øª Ø§Ù„Ø±Ø³Ù…ÙŠØ© ========
// Ø·Ø¨Ø§Ø¹Ø© Ø§Ø³ØªÙ…Ø§Ø±Ø© Ø§Ù„Ø­ØµØ±
printForm1: function() {
// Ø­ÙØ¸ Ø­Ø§Ù„Ø© Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©
const activeTab = document.querySelector('.tab.active');
const activeContent = document.querySelector('.tab-content.active');
// ØªÙØ¹ÙŠÙ„ Ø§Ø³ØªÙ…Ø§Ø±Ø© Ø§Ù„Ø­ØµØ±
document.querySelector('.tab[data-target="form1"]').classList.add('active');
document.getElementById('form1').classList.add('active');
// Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©
window.print();
// Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© Ù„Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
if (activeTab) activeTab.classList.add('active');
if (activeContent) activeContent.classList.add('active');
},
// Ø·Ø¨Ø§Ø¹Ø© Ø§Ø³ØªÙ…Ø§Ø±Ø© 32
printForm2: function() {
// Ø­ÙØ¸ Ø­Ø§Ù„Ø© Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©
const activeTab = document.querySelector('.tab.active');
const activeContent = document.querySelector('.tab-content.active');
// ØªÙØ¹ÙŠÙ„ Ø§Ø³ØªÙ…Ø§Ø±Ø© 32
document.querySelector('.tab[data-target="form2"]').classList.add('active');
document.getElementById('form2').classList.add('active');
// Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©
window.print();
// Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© Ù„Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
if (activeTab) activeTab.classList.add('active');
if (activeContent) activeContent.classList.add('active');
},
// ======== ÙˆØ¸Ø§Ø¦Ù Ù…Ø³Ø§Ø¹Ø¯Ø© ========
// Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
showNotification: function(message, type = 'success') {
const notification = document.createElement('div');
notification.className = `notification ${type}`;
notification.innerHTML = `
<i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-triangle'}"></i>
${message}
`;
document.body.appendChild(notification);
setTimeout(() => {
notification.remove();
}, 3000);
},
// Ø¶Ù…Ø§Ù† Ø¥Ø¶Ø§ÙØ© Ø§Ù…ØªØ¯Ø§Ø¯ Ø§Ù„Ù…Ù„Ù
ensureFileExtension: function(filename, ext) {
if (!filename.toLowerCase().endsWith(`.${ext.toLowerCase()}`)) {
return `${filename}.${ext}`;
}
return filename;
},
// ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø¹Ù…Ù„Ø©
formatCurrency: function(amount) {
return amount.toLocaleString('ar-EG', {
style: 'currency',
currency: 'EGP',
minimumFractionDigits: 0,
maximumFractionDigits: 0
});
},
// ØªØ¹ÙŠÙŠÙ† ØªÙ‚ÙŠÙŠÙ… Ù„Ù„ÙˆØ­Ø¯Ø©
setUnitRating: function(rating) {
document.querySelectorAll('.unit-rating .star').forEach((star, index) => {
if (index < rating) {
star.classList.add('active');
} else {
star.classList.remove('active');
}
});
},
// ØªØµÙÙŠØ© Ø§Ù„ÙˆØ­Ø¯Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹
filterUnits: function(filter) {
const rows = document.querySelectorAll('#units-table-body tr');
rows.forEach(row => {
if (row.classList.contains('empty-data-row')) return;
const typeCell = row.cells[6]; // Ø§Ù„Ù†ÙˆØ¹ ÙÙŠ Ø§Ù„Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø³Ø§Ø¨Ø¹
const typeText = typeCell.textContent.toLowerCase();
if (filter === 'all' ||
(filter === 'residential' && typeText.includes('Ø³ÙƒÙ†ÙŠ')) ||
(filter === 'commercial' && typeText.includes('ØªØ¬Ø§Ø±ÙŠ')) ||
(filter === 'space' && typeText.includes('ÙØ¶Ø§Ø¡'))) {
row.style.display = '';
} else {
row.style.display = 'none';
}
});
}
};
// ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
document.addEventListener('DOMContentLoaded', function() {
  // ØªØ¹ÙŠÙŠÙ† Ù‚ÙŠÙ…Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ù„Ø·Ø¨ÙŠØ¹Ø© Ø§Ù„Ù…ÙƒØ§Ù†
  document.getElementById('location-type').value = 'village';
  RealEstateApp.init();
});
// === Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© ===
document.getElementById('show-saved-properties').addEventListener('click', function() {
    const modal = document.getElementById('saved-properties-modal');
    const tableBody = document.getElementById('saved-properties-table');
    
    // Ù…Ø³Ø­ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø­Ø§Ù„ÙŠ
    tableBody.innerHTML = '';
    
    // Ù…Ù„Ø¡ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø¨Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© ÙˆØ§Ù„Ù…Ø³ØªÙˆØ±Ø¯Ø©
    if (RealEstateApp.properties.length === 0) {
        tableBody.innerHTML = `
        <tr>
            <td colspan="8" style="text-align:center; padding:20px;">
                <i class="fas fa-inbox"></i> Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù‚Ø§Ø±Ø§Øª Ù…Ø­ÙÙˆØ¸Ø©
            </td>
        </tr>
        `;
    } else {
        RealEstateApp.properties.forEach(property => {
            const tr = document.createElement('tr');
            tr.dataset.propertyId = property.id;
            tr.style.cursor = 'pointer';
            
            const date = new Date(property.id);
            const formattedDate = date.toLocaleDateString('ar-EG');
            const isImported = !!(property._imported || property.imported || property.source === 'import');
            
            tr.innerHTML = `
                <td>${property.propertyNumber || '--'}</td>
                <td>${property.street || '--'}</td>
                <td>${property.district || '--'}</td>
                <td>${property.city || '--'}</td>
                <td>${property.governorate || '--'}</td>
                <td>${formattedDate}</td>
                <td>
                    ${isImported ? '<span class="property-badge badge-imported">Ù…Ø³ØªÙˆØ±Ø¯</span>' : '<span class="property-badge badge-saved">Ù…Ø­ÙÙˆØ¸</span>'}
                </td>
                <td>
                    ${isImported ? 
                      `<button class="btn btn-sm" style="background-color: #27ae60; color: white;" data-property-id="${property.id}">
                          <i class="fas fa-save"></i> Ø­ÙØ¸
                       </button>` : ''}
                    <button class="btn btn-sm delete-property-row" data-property-id="${property.id}">
                        <i class="fas fa-trash"></i> Ø­Ø°Ù
                    </button>
                </td>
`;
            
            tableBody.appendChild(tr);
            
            // Ø­Ø¯Ø« Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø§Ù„ØµÙ Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ù‚Ø§Ø±
            tr.addEventListener('click', function(e) {
                if (!e.target.closest('.delete-property-row')) {
                    RealEstateApp.loadPropertyData(property.id);
                    modal.style.display = 'none';
                }
            });
            // Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø£Ø²Ø±Ø§Ø±
            if (isImported) {
                tr.querySelector('button:not(.delete-property-row)').addEventListener('click', function(e) {
                    e.stopPropagation();
                    const propertyId = this.dataset.propertyId;
                    const property = RealEstateApp.properties.find(p => p.id == propertyId);
                    if (property) {
                        // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¹Ù‚Ø§Ø± Ø§Ù„Ù…Ø³ØªÙˆØ±Ø¯ Ø§Ù„Ø­Ø§Ù„ÙŠ ÙÙ‚Ø· Ø¥Ù„Ù‰ Ù…Ø­ÙÙˆØ¸
                        property._imported = false;
                        property.imported = false;
                        localStorage.setItem('realEstateProperties', JSON.stringify(RealEstateApp.properties));
                        RealEstateApp.showNotification('ØªÙ… ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¹Ù‚Ø§Ø± Ø§Ù„Ù…Ø³ØªÙˆØ±Ø¯ Ø¥Ù„Ù‰ Ù…Ø­ÙÙˆØ¸ Ø¨Ù†Ø¬Ø§Ø­');
                        // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙ ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„
                        const badge = tr.querySelector('.property-badge');
                        if (badge) {
                            badge.className = 'property-badge badge-saved';
                            badge.textContent = 'Ù…Ø­ÙÙˆØ¸';
                        }
                        // Ø¥Ø²Ø§Ù„Ø© Ø²Ø± Ø§Ù„Ø­ÙØ¸
                        this.remove();
                    }
                });
            }

            // Ø­Ø¯Ø« Ø­Ø°Ù Ø§Ù„Ø¹Ù‚Ø§Ø±
            tr.querySelector('.delete-property-row').addEventListener('click', function(e) {
                e.stopPropagation();
                const propertyId = this.dataset.propertyId;
                
                if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù‚Ø§Ø± Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ')) {
                    const index = RealEstateApp.properties.findIndex(p => p.id == propertyId);
                    if (index !== -1) {
                        RealEstateApp.properties.splice(index, 1);
                        localStorage.setItem('realEstateProperties', JSON.stringify(RealEstateApp.properties));
                        tr.remove();
                        RealEstateApp.showNotification('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¹Ù‚Ø§Ø± Ø¨Ù†Ø¬Ø§Ø­');
                        
                        // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø¹Ù‚Ø§Ø± Ø§Ù„Ù…Ø­Ø°ÙˆÙ Ù‡Ùˆ Ø§Ù„Ø­Ø§Ù„ÙŠØŒ ÙŠØªÙ… Ù…Ø³Ø­ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
                        if (RealEstateApp.currentProperty && RealEstateApp.currentProperty.id == propertyId) {
                            RealEstateApp.resetForm();
                        }
                    }
                }
            });
});
    }
    
    modal.style.display = 'block';
});

document.getElementById('close-saved-properties').addEventListener('click', function() {
    document.getElementById('saved-properties-modal').style.display = 'none';
});

// Ø¯Ø§Ù„Ø© Ù„ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù‚Ø§Ø±
RealEstateApp.loadPropertyData = function(propertyId) {
    const property = this.properties.find(p => p.id == propertyId);
    if (!property) return;
    
    // ØªØ¹Ø¨Ø¦Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù‚Ø§Ø± ÙÙŠ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
    document.getElementById('property-number').value = property.propertyNumber || '';
    document.getElementById('previous-property-number').value = property.previousPropertyNumber || '';
    document.getElementById('street').value = property.street || '';
    document.getElementById('street-width').value = property.streetWidth || '';
    document.getElementById('district').value = property.district || '';
    document.getElementById('city').value = property.city || '';
    document.getElementById('governorate').value = property.governorate || '';
    document.getElementById('building-material').value = property.buildingMaterial || 'concrete';
    document.getElementById('construction-year').value = property.constructionYear || '';
    document.getElementById('responsible-name').value = property.responsibleName || '';
    document.getElementById('owner').value = property.owner || '';
    document.getElementById('owner-national-id').value = property.ownerNationalId || '';
    document.getElementById('area').value = property.area || '';
    document.getElementById('floors').value = property.floors || '';
    document.getElementById('units-count').value = property.unitsCount || '';
    document.getElementById('property-type').value = property.propertyType || 'residential';
    document.getElementById('detailed-description').value = property.detailedDescription || '';
    document.getElementById('coordinates').value = property.coordinates || '';
    
    // ØªØ¹Ø¨Ø¦Ø© Ø§Ù„ÙˆØ­Ø¯Ø§Øª Ø¥Ø°Ø§ ÙˆØ¬Ø¯Øª
    if (property.units && property.units.length > 0) {
        this.units = [...property.units];
        this.updateUnitsTable();
    } else {
        this.units = [];
        this.updateUnitsTable();
    }
    
    // ØªØ¹Ø¨Ø¦Ø© Ø§Ù„ØµÙˆØ± Ø¥Ø°Ø§ ÙˆØ¬Ø¯Øª
    const imagePreview = document.getElementById('image-preview');
    imagePreview.innerHTML = '';
    if (property.images && property.images.length > 0) {
        property.images.forEach(img => {
            const image = document.createElement('img');
            image.src = img;
            imagePreview.appendChild(image);
        });
    }
    
    this.currentProperty = property;
    this.showNotification(`ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ù‚Ø§Ø± ${property.propertyNumber} Ø¨Ù†Ø¬Ø§Ø­`);
};

// ==== Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„ÙŠØ¯ÙˆÙŠ ====
document.getElementById("valuation-method").addEventListener("change", function() {
const manualInput = document.getElementById("manual-valuation-input");
if (this.value === "manual") {
manualInput.style.display = "block";
} else {
manualInput.style.display = "none";
}
});
document.getElementById("manual-market-value").addEventListener("input", function() {
let marketValue = parseFloat(this.value) || 0;
if (marketValue > 0) {
// Ù†ÙØ³ Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø§Øª Ø§Ù„Ø£ØµÙ„ÙŠØ©
let rentalValue = marketValue * 0.03; // Ù…Ø«Ø§Ù„: 3%
let netRentalValue = rentalValue * 0.9; // Ø®ØµÙ… 10%
let taxValue = netRentalValue * 0.1; // Ø¶Ø±ÙŠØ¨Ø© 10%
document.getElementById("market-value").innerText = marketValue.toLocaleString() + " Ø¬.Ù…";
document.getElementById("rental-value").innerText = rentalValue.toLocaleString() + " Ø¬.Ù…";
document.getElementById("tax-value").innerText = taxValue.toLocaleString() + " Ø¬.Ù…";
} else {
document.getElementById("market-value").innerText = "--";
document.getElementById("rental-value").innerText = "--";
document.getElementById("tax-value").innerText = "--";
}
});
// === Ù…Ù†Ø·Ù‚ Ø§Ù„Ø­Ø§Ø³Ø¨Ø© ===
let calcDisplay = document.getElementById("calc-display");
let calcValue = "";
document.getElementById("open-calculator").addEventListener("click", function() {
document.getElementById("calculator-modal").style.display = "block";
});
document.getElementById("calc-buttons").addEventListener("click", function(e) {
if (e.target.tagName === "BUTTON" && e.target.innerText !== "Ù…Ø³Ø­" && e.target.innerText !== "Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù†ØªÙŠØ¬Ø©" && e.target.innerText !== "Ø¥ØºÙ„Ø§Ù‚") {
if (e.target.innerText === "=") {
try {
calcValue = safeEvalExpression(calcValue);
} catch {
calcValue = "Ø®Ø·Ø£";
}
} else {
calcValue += e.target.innerText;
}
calcDisplay.value = calcValue;
}
});
document.getElementById("calc-clear").addEventListener("click", function() {
calcValue = "";
calcDisplay.value = "";
});
document.getElementById("calc-use").addEventListener("click", function() {
if (!isNaN(parseFloat(calcValue))) {
document.getElementById("manual-market-value").value = parseFloat(calcValue);
document.getElementById("manual-market-value").dispatchEvent(new Event('input'));
}
document.getElementById("calculator-modal").style.display = "none";
});
document.getElementById("calc-close").addEventListener("click", function() {
document.getElementById("calculator-modal").style.display = "none";
});
</script>
<script>
// ØªØ³Ø¬ÙŠÙ„ Service Worker
if ('serviceWorker' in navigator) {
window.addEventListener('load', function() {
navigator.serviceWorker.register('/service-worker.js')
.then(registration => {
console.log('ServiceWorker Ù…Ø³Ø¬Ù„ Ø¨Ù†Ø¬Ø§Ø­: ', registration.scope);
})
.catch(error => {
console.log('ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ ServiceWorker: ', error);
});
});
}
</script>
<script>
function calculateStatistics() {
    // Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª Ù…Ù† Ø§Ù„Ù…ÙØªØ§Ø­ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
    const properties = JSON.parse(localStorage.getItem('realEstateProperties') || '[]')
        .filter(p => !(p._imported || p.imported || p.source === 'import')); // ÙÙ‚Ø· Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©
// Ø¨Ù†Ø§Ø¡ Ù…ØµÙÙˆÙØ© Ø§Ù„ÙˆØ­Ø¯Ø§Øª Ù…Ù† Ø¯Ø§Ø®Ù„ ÙƒÙ„ Ø¹Ù‚Ø§Ø± (Ø§Ù„ÙˆØ­Ø¯Ø§Øª Ù…Ø®Ø²Ù†Ø© Ø¯Ø§Ø®Ù„ property.units)
    let units = [];
    properties.forEach(p => {
        const pUnits = Array.isArray(p.units) ? p.units : [];
        pUnits.forEach(u => {
            // Ø¶Ø¹ Ù…Ø±Ø¬Ø¹Ù‹Ø§ Ù„Ø±Ù‚Ù… Ø§Ù„Ø¹Ù‚Ø§Ø± Ø¯Ø§Ø®Ù„ Ø§Ù„ÙˆØ­Ø¯Ø© Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ù‹Ø§
            if (!u.propertyNumber) u.propertyNumber = p.propertyNumber || p.id || null;
            // Ø§Ø­ØªÙØ¸ Ø¨Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø´Ø§Ø±Ø¹ ÙÙŠ Ø§Ù„ÙˆØ­Ø¯Ø© Ø¥Ù† Ù„Ù… ØªÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ø©
            if (!u.street) u.street = p.street || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
            units.push(u);
        });
    });

    const totalProperties = properties.length;
    const totalUnits = units.length;

    let totalRental = 0;
    let totalTax = 0;

    let streetStats = {};

    units.forEach(unit => {
        const street = unit.street || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
        if (!streetStats[street]) {
            streetStats[street] = {
                properties: new Set(),
                residential: 0,
                commercial: 0,
                space: 0,
                rental: 0,
                tax: 0
            };
        }
        let s = streetStats[street];
        if (unit.propertyNumber) s.properties.add(unit.propertyNumber);

        // Ø§Ø³ØªØ®Ø¯Ø§Ù… useType ÙƒÙ…Ø§ ÙŠÙØ¹Ø±Ù‘Ù ÙÙŠ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ (residential, commercial, space, utilized_space ...)
        switch ((unit.useType || '').toString()) {
            case "residential": s.residential++; break;
            case "commercial": s.commercial++; break;
            case "space":
            case "utilized_space": s.space++; break;
            default: break;
        }

        // Ù†Ù‚Ø±Ø£ Ù‚ÙŠÙ… Ø§Ù„Ø¥ÙŠØ¬Ø§Ø± ÙˆØ§Ù„Ø¶Ø±ÙŠØ¨Ø© Ù…Ù† Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø­ØªÙ…Ù„Ø© Ø¨Ø·Ø±ÙŠÙ‚Ø© Ù…Ø±Ù†Ø©
        const rentalNum = parseFloat(unit.rentalValue || unit.netRentalValue || unit.rental || 0) || 0;
        const taxNum = parseFloat(unit.tax || unit.taxValue || 0) || 0;

        s.rental += rentalNum;
        s.tax += taxNum;
        totalRental += rentalNum;
        totalTax += taxNum;
    });

    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ù…Ù„Ø®ØµØ© Ø¥Ù† ÙˆÙØ¬Ø¯Øª Ø§Ù„Ø¹Ù†Ø§ØµØ±
    const elTotalProperties = document.getElementById("total-properties");
    const elTotalUnits = document.getElementById("total-units");
    const elTotalRental = document.getElementById("total-rental");
    const elTotalTax = document.getElementById("total-tax");
    if (elTotalProperties) elTotalProperties.textContent = totalProperties;
    if (elTotalUnits) elTotalUnits.textContent = totalUnits;
    if (elTotalRental) elTotalRental.textContent = totalRental.toFixed ? totalRental.toFixed(2) : totalRental;
    if (elTotalTax) elTotalTax.textContent = totalTax.toFixed ? totalTax.toFixed(2) : totalTax;

    // ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙˆÙ„ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø´ÙˆØ§Ø±Ø¹
    const tbody = document.getElementById("street-stats-body");
    if (!tbody) return;
    tbody.innerHTML = "";
const filteredProps = this.properties; // Ù†Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª Ø¨Ù…Ø§ ÙÙŠÙ‡Ø§ Ø§Ù„Ù…Ø³ØªÙˆØ±Ø¯Ø©
if (Object.keys(streetStats).length === 0) {
        tbody.innerHTML = '<tr class="empty-data-row"><td colspan="7"><div class="empty-message"><p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø¥Ø¸Ù‡Ø§Ø±Ù‡Ø§ â€” ÙŠØªÙ… Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø¨Ø¹Ø¯ Ø¥Ø¶Ø§ÙØ© Ø¹Ù‚Ø§Ø±Ø§Øª ÙˆÙˆØ­Ø¯Ø§Øª</p></div></td></tr>';
    } else {
        for (let street in streetStats) {
            let s = streetStats[street];
            let tr = document.createElement("tr");
            tr.innerHTML = `
                <td>${street}</td>
                <td>${s.properties.size}</td>
                <td>${s.residential}</td>
                <td>${s.commercial}</td>
                <td>${s.space}</td>
                <td>${(s.rental).toFixed ? s.rental.toFixed(2) : s.rental}</td>
                <td>${(s.tax).toFixed ? s.tax.toFixed(2) : s.tax}</td>
            `;
            tbody.appendChild(tr);
        }
    }
}


// Run stats calculation when statistics section is opened
document.addEventListener("DOMContentLoaded", () => {
    document.querySelector("[data-target='stats-section']").addEventListener("click", calculateStatistics);
});
</script>
<script>
document.addEventListener("DOMContentLoaded", () => {
    const searchInput = document.getElementById("saved-properties-search-input");
    if (searchInput) {
        searchInput.addEventListener("keyup", function() {
            let filter = this.value.toLowerCase();
            let rows = document.querySelectorAll("#saved-properties-table tr");
            rows.forEach(row => {
                let text = row.textContent.toLowerCase();
                if (text.includes(filter)) {
                    row.style.display = "";
                } else {
                    row.style.display = "none";
                }
            });
        });
    }
});
</script>
<script>
  
function updatePropertiesCount() {
  const saved = JSON.parse(localStorage.getItem('realEstateProperties') || '[]'); // Ù†Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª Ø¨Ù…Ø§ ÙÙŠÙ‡Ø§ Ø§Ù„Ù…Ø³ØªÙˆØ±Ø¯Ø©
const el = document.getElementById("properties-count");
    if (el) el.textContent = saved.length;
}


  document.getElementById("save-property").addEventListener("click", function () {
    setTimeout(updatePropertiesCount, 300);
  });

  document.getElementById("import-properties").addEventListener("click", function () {
    setTimeout(updatePropertiesCount, 500);
  });

  window.addEventListener("load", updatePropertiesCount);
</script>
<script>
function updateStats() {
    const properties = JSON.parse(localStorage.getItem('realEstateProperties') || '[]')
        .filter(p => !(p._imported || p.imported || p.source === 'import')); // ÙÙ‚Ø· Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©
// Ø§Ø¬Ù…Ø¹ Ø§Ù„ÙˆØ­Ø¯Ø§Øª Ù…Ù† Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª
    let units = [];
    properties.forEach(p => {
        const pUnits = Array.isArray(p.units) ? p.units : [];
        pUnits.forEach(u => {
            if (!u.propertyNumber) u.propertyNumber = p.propertyNumber || p.id || null;
            units.push(u);
        });
    });

    const elTotalProperties = document.getElementById("total-properties");
    const elTotalUnits = document.getElementById("total-units");
    const elTotalArea = document.getElementById("total-area");

    if (elTotalProperties) elTotalProperties.textContent = properties.length;
    if (elTotalUnits) elTotalUnits.textContent = units.length;

    let totalArea = 0;
    properties.forEach(p => { totalArea += Number(p.area || 0); });
    if (elTotalArea) elTotalArea.textContent = totalArea;
}


  // ØªØ­Ø¯ÙŠØ« Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
  window.addEventListener("load", updateStats);

  // ØªØ­Ø¯ÙŠØ« Ø¨Ø¹Ø¯ Ø­ÙØ¸ Ø£Ùˆ Ø§Ø³ØªÙŠØ±Ø§Ø¯
  document.getElementById("save-property").addEventListener("click", () => setTimeout(updateStats, 300));
  document.getElementById("import-properties").addEventListener("click", () => setTimeout(updateStats, 500));
</script>
<script>
// --- Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø®Ø§Øµ Ø¨Ø§Ø­ØªØ³Ø§Ø¨ Ø§Ù„Ù‚ÙŠÙ… ---
// ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø®Ù„Ù„ Ø¨Ø­ÙŠØ« ÙŠØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚ÙŠÙ… Ù„Ù„ÙˆØ­Ø¯Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© ÙÙ‚Ø· ÙˆÙ„ÙŠØ³ ÙƒÙ„ Ø§Ù„ÙˆØ­Ø¯Ø§Øª

function calculateUnitValues(units, coefficients, buildingMaterial, similarityLevel) {
    const lastUnit = units[units.length - 1];
    if (!lastUnit) return;

    const baseValue = coefficients.area * lastUnit.area;
    const useFactor = coefficients.useType[lastUnit.useType] || 1.0;
    const typeFactor = coefficients.unitType[lastUnit.unitType] || 1.0;
    const finishingFactor = coefficients.finishing[lastUnit.finishing] || 1.0;
    const materialFactor = coefficients.buildingMaterial[buildingMaterial] || 1.0;

    let similarityFactor = 1.0;
    if (similarityLevel === 'Ù†ÙØ³ Ø§Ù„Ø´Ø§Ø±Ø¹') similarityFactor = 1.10;
    else if (similarityLevel === 'Ù†ÙØ³ Ø§Ù„Ù…Ù†Ø·Ù‚Ø©/Ø§Ù„Ù‚Ø±ÙŠØ©') similarityFactor = 1.05;
    else if (similarityLevel === 'Ù†ÙØ³ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©') similarityFactor = 1.02;

    const floorNumber = parseInt(lastUnit.floor) || 0;
    let floorFactor;
    if (typeof getFloorFactor === 'function') {
        // use the explicit mapping function
        floorFactor = getFloorFactor(floorNumber || 1);
    } else {
        // fallback to old multiplicative logic
        floorFactor = (coefficients.floor || 1.0) * (floorNumber > 0 ? floorNumber : 1);
    }


    let computedMarketValue = baseValue * useFactor * typeFactor * finishingFactor * similarityFactor * materialFactor * floorFactor;
    let marketValue = computedMarketValue;

    try {
        const methodNow = document.getElementById('valuation-method').value;
        if (methodNow === 'manual') {
            const manualInput = document.getElementById('manual-market-value');
            if (manualInput) {
                const manualVal = parseFloat(manualInput.value);
                if (!isNaN(manualVal) && manualVal > 0) {
                    marketValue = manualVal;
                }
            }
        }
    } catch (e) {
        marketValue = computedMarketValue;
    }

    const rentalValue = marketValue * 0.018;
    let netRentalValue = (lastUnit.useType === 'residential')
        ? rentalValue * 0.7
        : rentalValue * 0.68;

    let tax = (lastUnit.useType === 'residential')
        ? marketValue * 0.00126
        : marketValue * 0.001224;

    lastUnit.marketValue = marketValue;
    lastUnit.rentalValue = rentalValue;
    lastUnit.netRentalValue = netRentalValue;
    lastUnit.tax = tax;
}

const calcBtn = document.getElementById('calculate-values-btn');
if (calcBtn) {
    calcBtn.addEventListener('click', () => {
        const floor = document.getElementById('unit-floor') ? document.getElementById('unit-floor').value.trim() : '';
        const number = document.getElementById('unit-number') ? document.getElementById('unit-number').value.trim() : '';
        if (window.RealEstateApp && typeof RealEstateApp.calculateUnitValues === 'function') {
            RealEstateApp.calculateUnitValues({ floor, number });
        } else {
            if (typeof calculateUnitValues === 'function') calculateUnitValues();
        }
    });
}
  });
}

// ======== ØªØµØ¯ÙŠØ± Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø´ÙˆØ§Ø±Ø¹ ========
function exportStreetStatsExcel() {
  // Ø¬Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø¬Ø¯ÙˆÙ„
  const data = [];
  const headers = ['Ø§Ù„Ø´Ø§Ø±Ø¹', 'Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª', 'Ø¹Ø¯Ø¯ Ø§Ù„ÙˆØ­Ø¯Ø§Øª', 'Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¥ÙŠØ¬Ø§Ø±ÙŠØ©', 'Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ø³Ù†ÙˆÙŠØ©'];
  
  data.push(headers);
  
  document.querySelectorAll('#street-stats-body tr').forEach(row => {
    const cells = row.querySelectorAll('td');
    if (cells.length >= 5) {
      const rowData = [
        cells[0].textContent,
        cells[1].textContent,
        cells[2].textContent,
        cells[3].textContent.replace(' Ø¬.Ù…', ''),
        cells[4].textContent.replace(' Ø¬.Ù…', '')
      ];
      data.push(rowData);
    }
  });
  
  // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù Excel
  const ws = XLSX.utils.aoa_to_sheet(data);
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, 'Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø´ÙˆØ§Ø±Ø¹');
  
  // Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ù
  XLSX.writeFile(wb, 'Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª_Ø§Ù„Ø´ÙˆØ§Ø±Ø¹.xlsx');
}

function exportStreetStatsCSV() {
  // Ø¬Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø¬Ø¯ÙˆÙ„
  let csvContent = 'Ø§Ù„Ø´Ø§Ø±Ø¹,Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª,Ø¹Ø¯Ø¯ Ø§Ù„ÙˆØ­Ø¯Ø§Øª,Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¥ÙŠØ¬Ø§Ø±ÙŠØ©,Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ø³Ù†ÙˆÙŠØ©\n';
  
  document.querySelectorAll('#street-stats-body tr').forEach(row => {
    const cells = row.querySelectorAll('td');
    if (cells.length >= 5) {
      const rowData = [
        `"${cells[0].textContent}"`,
        cells[1].textContent,
        cells[2].textContent,
        cells[3].textContent.replace(' Ø¬.Ù…', ''),
        cells[4].textContent.replace(' Ø¬.Ù…', '')
      ];
      csvContent += rowData.join(',') + '\n';
    }
  });
  
  // Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø§Ø¨Ø· ØªØ­Ù…ÙŠÙ„
  const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
  const url = URL.createObjectURL(blob);
  const link = document.createElement('a');
  link.setAttribute('href', url);
  link.setAttribute('download', 'Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª_Ø§Ù„Ø´ÙˆØ§Ø±Ø¹.csv');
  link.style.visibility = 'hidden';
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
}

function exportStreetStatsPDF() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  
  // Ø¥Ø¶Ø§ÙØ© Ø¹Ù†ÙˆØ§Ù†
  doc.setFontSize(18);
  doc.text('Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø´ÙˆØ§Ø±Ø¹', 105, 15, { align: 'center' });
  doc.setFontSize(12);
  doc.text(new Date().toLocaleDateString('ar-EG'), 105, 22, { align: 'center' });
  
  // Ø¬Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø¬Ø¯ÙˆÙ„
  const data = [];
  const headers = ['Ø§Ù„Ø´Ø§Ø±Ø¹', 'Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª', 'Ø¹Ø¯Ø¯ Ø§Ù„ÙˆØ­Ø¯Ø§Øª', 'Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¥ÙŠØ¬Ø§Ø±ÙŠØ©', 'Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ø³Ù†ÙˆÙŠØ©'];
  
  data.push(headers);
  
  document.querySelectorAll('#street-stats-body tr').forEach(row => {
    const cells = row.querySelectorAll('td');
    if (cells.length >= 5) {
      const rowData = [
        cells[0].textContent,
        cells[1].textContent,
        cells[2].textContent,
        cells[3].textContent.replace(' Ø¬.Ù…', ''),
        cells[4].textContent.replace(' Ø¬.Ù…', '')
      ];
      data.push(rowData);
    }
  });
  
  // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¬Ø¯ÙˆÙ„ ÙÙŠ PDF
  doc.autoTable({
    head: [data[0]],
    body: data.slice(1),
    startY: 30,
    theme: 'grid',
    styles: { font: 'Cairo', fontSize: 10, halign: 'center' },
    headStyles: { fillColor: [52, 152, 219] },
    margin: { right: 10, left: 10 }
  });
  
  // Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ù
  doc.save('Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª_Ø§Ù„Ø´ÙˆØ§Ø±Ø¹.pdf');
}

// ======== ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø£Ø­Ø¯Ø§Ø« ========
document.addEventListener('DOMContentLoaded', function() {
  // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø¹Ù†Ø¯ ÙØªØ­ Ù‚Ø³Ù… Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
  document.querySelector('[data-target="stats-section"]').addEventListener('click', function() {
    calculateStreetStatistics();
  });
  
  // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„ØªØ­Ø¯ÙŠØ«
  document.getElementById('refresh-stats').addEventListener('click', function() {
    calculateStreetStatistics();
  });
  
  // ØªØµÙÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ÙƒØªØ§Ø¨Ø©
  document.getElementById('street-filter').addEventListener('input', function() {
    calculateStreetStatistics();
  });
  
  // Ø£Ø­Ø¯Ø§Ø« Ø§Ù„ØªØµØ¯ÙŠØ±
  document.getElementById('export-street-stats-excel').addEventListener('click', exportStreetStatsExcel);
  document.getElementById('export-street-stats-csv').addEventListener('click', exportStreetStatsCSV);
  document.getElementById('export-street-stats-pdf').addEventListener('click', exportStreetStatsPDF);
  
  // Ø§Ù„ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø£ÙˆÙ„ÙŠØ©
  calculateStreetStatistics();
});
</script><script>
const coefficients = {
      // âœ¨ Ù…Ø¹Ø§Ù…Ù„ Ø§Ù„Ø¯ÙˆØ±
      floor: 0.98,
                    area: 3000,
                    locationType: {
                      'compound': 0.5,
                      'village': 1.0,
                      'city': 1.5,
                      'major_city': 2.0
                    },
buildingMaterial: {
                        'brick': 1.0,
                        'sand_brick': 0.95,
                        'concrete': 1.1,
                        'stone': 1.05,
                        'mud_brick': 0.9,
                        'other': 1.0
                    },
                    useType: {
                        'residential': 1.0,
                        'commercial': 1.2,
                        'administrative': 1.1,
                        'space': 0.5,
                        'utilized_space': 1.15 // Ù…Ø¹Ø§Ù…Ù„ Ø®Ø§Øµ Ù„Ù„ÙØ¶Ø§Ø¡ Ù…Ø³ØªØºÙ„
                    },
                    unitType: {
                        'apartment': 1.0,
                        'duplex': 1.3,
                        'villa': 1.8,
                        'shop': 1.4,
                        'warehouse': 1.1,
                        'workshop': 1.2,
                        'clinic': 1.5,
                        'office': 1.3,
                        'space': 0.4,
                        'utilized_space': 1.2 // Ù…Ø¹Ø§Ù…Ù„ Ø®Ø§Øµ Ù„Ù„ÙØ¶Ø§Ø¡ Ù…Ø³ØªØºÙ„
                    },
                    finishing: {
                        'none': 0.7,
                        'basic': 0.9,
                        'medium': 1.0,
                        'high': 1.2,
                        'luxury': 1.5
                    }
                };
</script>

<script>
if (typeof getFloorFactor === 'function') {
  console.log('Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„Ø¯ÙˆØ± (floor -> factor):');
  for (let f=1; f<=10; f++) console.log(f + ' -> ' + getFloorFactor(f));
}
</script>

<script>
function printForm1() {
  const formContent = document.getElementById('form1').innerHTML;
  const w = window.open('', '', 'height=800,width=1200');
  w.document.write('<html><head><title>Ø·Ø¨Ø§Ø¹Ø© Ø§Ø³ØªÙ…Ø§Ø±Ø© Ø§Ù„Ø­ØµØ±</title></head><body>');
  w.document.write(formContent);
  w.document.write('</body></html>');
  w.document.close();
  w.print();
}

function printForm2() {
  const formContent = document.getElementById('form2').innerHTML;
  const w = window.open('', '', 'height=800,width=1200');
  w.document.write('<html><head><title>Ø·Ø¨Ø§Ø¹Ø© Ø§Ø³ØªÙ…Ø§Ø±Ø© 32 Ø¶ Ø¹</title></head><body>');
  w.document.write(formContent);
  w.document.write('</body></html>');
  w.document.close();
  w.print();
}
</script>
<script>
document.addEventListener('DOMContentLoaded', function(){
  const btn = document.getElementById('export-map-package');
  if(btn){
    btn.addEventListener('click', async function(){
      try {
        // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© ØªØ­Ù…ÙŠÙ„
        const loadingOverlay = document.getElementById('loading-overlay');
        loadingOverlay.style.display = 'flex';
        
        const mapEl = document.getElementById('map-canvas') || document.getElementById('map');
        if(!mapEl) {
          throw new Error("âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¹Ù†ØµØ± Ø§Ù„Ø®Ø±ÙŠØ·Ø©");
        }

        // 1. Ø§Ù„ØªÙ‚Ø§Ø· ØµÙˆØ±Ø© Ø§Ù„Ø®Ø±ÙŠØ·Ø©
        const canvas = await html2canvas(mapEl, {
          useCORS: true,
          allowTaint: true,
          scale: 2, // Ø²ÙŠØ§Ø¯Ø© Ø¯Ù‚Ø© Ø§Ù„ØµÙˆØ±Ø©
          logging: false
        });
        
        // 2. Ø¥Ù†Ø´Ø§Ø¡ Ø¨ÙŠØ§Ù†Ø§Øª GeoJSON ÙˆGPX
        const app = window.RealEstateApp || {};
        const features = [];
        (app.properties||[]).forEach(p => {
          if (!p.coordinates) return;
          const parts = p.coordinates.split(',').map(s => parseFloat(s.trim()));
          if (parts.length < 2) return;
          const lat = parts[0], lng = parts[1];
          if (!isFinite(lat) || !isFinite(lng)) return;
          
          features.push({
            type: 'Feature',
            geometry: { type: 'Point', coordinates: [lng, lat] },
            properties: {
              id: p.id || p.propertyNumber || '',
              street: p.street || '',
              district: p.district || '',
              city: p.city || '',
              governorate: p.governorate || '',
              owner: p.owner || '',
              unitsCount: (p.units||[]).length
            }
          });
        });

        const geojson = { type: 'FeatureCollection', features };
        
        // 3. Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù GPX
        let gpx = `<?xml version="1.0" encoding="UTF-8"?>
<gpx version="1.1" creator="RealEstateApp" xmlns="http://www.topografix.com/GPX/1/1">`;
        
        features.forEach(f => {
          const [lng, lat] = f.geometry.coordinates;
          gpx += `
  <wpt lat="${lat}" lon="${lng}">
    <name>${f.properties.id}</name>
    <desc>${[f.properties.street, f.properties.district, f.properties.city].filter(Boolean).join(' - ')}</desc>
  </wpt>`;
        });
        
        gpx += '\n</gpx>';

        // 4. Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù ZIP
        const zip = new JSZip();
        
        // Ø£Ø¶Ù ØµÙˆØ±Ø© Ø§Ù„Ø®Ø±ÙŠØ·Ø©
        canvas.toBlob(async (blob) => {
          zip.file("map.png", blob);
          
          // Ø£Ø¶Ù Ù…Ù„Ù GeoJSON
          zip.file("properties.geojson", JSON.stringify(geojson, null, 2));
          
          // Ø£Ø¶Ù Ù…Ù„Ù GPX
          zip.file("properties.gpx", gpx);
          
          // Ø£Ø¶Ù Ù…Ù„Ù README
          const readme = `Ø­Ø²Ù…Ø© ØªØµØ¯ÙŠØ± Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ø¹Ù‚Ø§Ø±ÙŠØ©\n\nØªØªØ¶Ù…Ù†:\n- map.png: ØµÙˆØ±Ø© Ø§Ù„Ø®Ø±ÙŠØ·Ø©\n- properties.geojson: Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹ Ø¨ØµÙŠØºØ© GeoJSON\n- properties.gpx: Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹ Ø¨ØµÙŠØºØ© GPX Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡Ø§ ÙÙŠ Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ù…Ù„Ø§Ø­Ø©\n\nØªÙ… Ø§Ù„ØªØµØ¯ÙŠØ± Ù…Ù† ØªØ·Ø¨ÙŠÙ‚ Ø­ØµØ± ÙˆØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª ÙÙŠ ${new Date().toLocaleString('ar-EG')}`;
          zip.file("README.txt", readme);
          
          // Ø¥Ù†Ø´Ø§Ø¡ ÙˆØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù
          const content = await zip.generateAsync({type: "blob"});
          const url = URL.createObjectURL(content);
          const a = document.createElement("a");
          a.href = url;
          a.download = `Ø§Ù„Ø®Ø±ÙŠØ·Ø©_Ø§Ù„Ø¹Ù‚Ø§Ø±ÙŠØ©_${new Date().toISOString().slice(0,10)}.zip`;
          document.body.appendChild(a);
          a.click();
          
          // Ø§Ù„ØªÙ†Ø¸ÙŠÙ
          setTimeout(() => {
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            loadingOverlay.style.display = 'none';
            RealEstateApp.showNotification('ØªÙ… ØªØµØ¯ÙŠØ± Ø­Ø²Ù…Ø© Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ø¨Ù†Ø¬Ø§Ø­');
          }, 100);
          
        }, 'image/png', 0.9); // Ø¬ÙˆØ¯Ø© Ø§Ù„ØµÙˆØ±Ø© 90%

      } catch(err) {
        console.error(err);
        document.getElementById('loading-overlay').style.display = 'none';
        RealEstateApp.showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØµØ¯ÙŠØ± Ø§Ù„Ø®Ø±ÙŠØ·Ø©', 'error');
      }
    });
  }
});
</script>
<!-- BEGIN: Map GPS Export Patch -->
<script>
/*
Patch: Map GPS export/import + navigation
How to use:
1. Paste this script *after* the existing RealEstateApp object in property_app_with_gps_export_v16.html (i.e. after the big RealEstateApp = { ... } block) OR include it in a separate <script> tag after the main script.
2. Ensure JSZip and html2canvas are already included (they are in the original file). This patch uses existing functions: showNotification(), ensureFileExtension(), formatCurrency(), and the map element with id 'map-canvas'.
3. The patch adds these public methods to RealEstateApp:
   - generateGeoJSON(includeImported = false)
   - generateGPX(includeImported = false)
   - exportMapPackage()  // creates a ZIP with map image, properties.geojson, properties.gpx and README
   - importMapFile(file) // accepts .zip, .geojson, .gpx and visualizes points on the map (does not auto-merge into saved properties)

Notes:
- Export includes only properties that have valid coordinates ("lat, lng") and by default excludes imported properties (keeps app behavior that imported items are draft).
- Import shows imported points on the map with a distinct icon (orange) and a popup with a "Ø§Ù†ØªÙ‚Ù„" link that opens Google Maps directions.
- Navigation: popups (both saved properties and imported ones) include a direct Google Maps directions link. On mobile this will open the Maps app if available.

Limitations:
- The app does not attempt to compute turn-by-turn navigation inside the app (requires routing API). It opens external Google Maps directions instead.
- If you want auto-merge of imported properties into the main dataset, modify merge logic where appropriate (we intentionally keep imported map data separate to respect your earlier requirement to review/confirm before saving).
*/

(function(){
  // helper: convert dataURL to Blob
  function dataURLToBlob(dataurl) {
    const arr = dataurl.split(','); 
    const mimeMatch = arr[0].match(/:(.*?);/);
    const mime = mimeMatch ? mimeMatch[1] : 'image/png';
    const bstr = atob(arr[1]);
    let n = bstr.length;
    const u8arr = new Uint8Array(n);
    while(n--) {
      u8arr[n] = bstr.charCodeAt(n);
    }
    return new Blob([u8arr], {type: mime});
  }

  function escapeXml(unsafe) {
    if (!unsafe) return '';
    return unsafe.replace(/[<>&\"']/g, function (c) {
      switch (c) {
        case '<': return '&lt;';
        case '>': return '&gt;';
        case '&': return '&amp;';
        case '\"': return '&quot;';
        case "'": return '&apos;';
      }
    });
  }

  // Add methods to RealEstateApp (the main app object exists in the original file)
  if (!window.RealEstateApp) {
    console.warn('RealEstateApp not found - please ensure this patch is loaded after the main file.');
    return;
  }

  // Generate GeoJSON from saved properties
  RealEstateApp.generateGeoJSON = function(includeImported = false) {
    const features = this.properties
      .filter(p => {
        if (!p || !p.coordinates) return false;
        if (!includeImported && (p._imported || p.imported || p.source === 'import')) return false;
        return true;
      })
      .map(p => {
        const parts = (p.coordinates || '') .split(',').map(s => parseFloat(s.trim()));
        if (parts.length < 2) return null;
        const lat = parseFloat(parts[0]);
        const lng = parseFloat(parts[1]);
        if (isNaN(lat) || isNaN(lng)) return null;
        return {
          type: 'Feature',
          geometry: { type: 'Point', coordinates: [lng, lat] },
          properties: {
            id: p.id || '',
            propertyNumber: p.propertyNumber || '',
            street: p.street || '',
            district: p.district || '',
            city: p.city || '',
            governorate: p.governorate || '',
            owner: p.owner || '',
            unitsCount: (p.units||[]).length || 0
          }
        };
      })
      .filter(Boolean);

    return { type: 'FeatureCollection', features };
  };

  // Generate simple GPX from properties
  RealEstateApp.generateGPX = function(includeImported = false) {
    const geo = this.generateGeoJSON(includeImported);
    let gpx = '<?xml version="1.0" encoding="UTF-8"?>\n';
    gpx += '<gpx version="1.1" creator="RealEstateApp" xmlns="http://www.topografix.com/GPX/1/1">\n';
    geo.features.forEach(f => {
      const lng = f.geometry.coordinates[0];
      const lat = f.geometry.coordinates[1];
      const name = escapeXml(f.properties.propertyNumber || f.properties.id || 'Ø¹Ù‚Ø§Ø±');
      const desc = escapeXml([f.properties.street, f.properties.district, f.properties.city, f.properties.governorate].filter(Boolean).join(' - '));
      gpx += `<wpt lat="${lat}" lon="${lng}"><name>${name}</name><desc>${desc}</desc></wpt>\n`;
    });
    gpx += '</gpx>';
    return gpx;
  };

  // Add a distinguishable icon factory for imported map points
  RealEstateApp._createPointIcon = function(color = 'blue') {
    return L.divIcon({
      className: 'custom-icon',
      html: `<div style="background-color: ${color}; width: 12px; height: 12px; border-radius: 50%; border: 2px solid white;"></div>`,
      iconSize: [20, 20]
    });
  };

  // Add function to export package (image + geojson + gpx)
  RealEstateApp.exportMapPackage = async function(options = {}) {
    options = Object.assign({ includeImported: false, filenamePrefix: 'map_package' }, options);
    try {
      this.showNotification('Ø¬Ø§Ø±ÙŠ Ø¥Ø¹Ø¯Ø§Ø¯ Ø­Ø²Ù…Ø© Ø§Ù„Ø®Ø±ÙŠØ·Ø©...');
      // 1) snapshot of the map (map-canvas)
      const canvasEl = document.getElementById('map-canvas') || document.getElementById('map');
      if (!canvasEl) {
        this.showNotification('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¹Ù†ØµØ± Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ù„Ù„ØªØµØ¯ÙŠØ±', 'error');
        return;
      }
      const canvas = await html2canvas(canvasEl, {useCORS: true, allowTaint: true});
      const dataUrl = canvas.toDataURL('image/png');
      const pngBlob = dataURLToBlob(dataUrl);

      // 2) geojson & gpx
      const geojson = JSON.stringify(this.generateGeoJSON(options.includeImported), null, 2);
      const gpx = this.generateGPX(options.includeImported);

      // 3) create ZIP
      const zip = new JSZip();
      zip.file(this.ensureFileExtension(options.filenamePrefix, 'png'), pngBlob, {binary: true});
      zip.file('properties.geojson', geojson);
      zip.file('properties.gpx', gpx);
      const readme = `ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø²Ù…Ø© Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ø¨ÙˆØ§Ø³Ø·Ø© ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø­ØµØ± ÙˆØ§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø¹Ù‚Ø§Ø±ÙŠ\n\nÙ…Ø­ØªÙˆÙŠØ§Øª Ø§Ù„Ø­Ø²Ù…Ø©:\n- ${this.ensureFileExtension(options.filenamePrefix, 'png')}: ØµÙˆØ±Ø© Ù„Ù„Ø®Ø±ÙŠØ·Ø©\n- properties.geojson: Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹ Ø¨Ù†Ø³Ù‚ GeoJSON\n- properties.gpx: Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹ Ø¨Ù†Ø³Ù‚ GPX (ÙŠÙ…ÙƒÙ† Ø§Ø³ØªÙŠØ±Ø§Ø¯Ù‡Ø§ ÙÙŠ Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ù…Ù„Ø§Ø­Ø© ÙˆØªØ·Ø¨ÙŠÙ‚Ø§Øª Ø§Ù„Ù‡Ø§ØªÙ)\n\nÙ…Ù„Ø§Ø­Ø¸Ø©: Ù„Ø§ ÙŠØªÙ… Ø¯Ù…Ø¬ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ù…Ø³ØªÙˆØ±Ø¯Ø© Ø¢Ù„ÙŠÙ‹Ø§ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŒ ÙˆÙŠØªÙˆØ¬Ø¨ Ù…Ø±Ø§Ø¬Ø¹ØªÙ‡Ø§ ÙˆØ§Ø¹ØªÙ…Ø§Ø¯Ù‡Ø§ ÙŠØ¯ÙˆÙŠÙ‹Ø§.`;
      zip.file('README.txt', readme);

      const blob = await zip.generateAsync({ type: 'blob' });
      const link = document.createElement('a');
      const now = new Date().toISOString().slice(0,19).replace(/[:T]/g,'-');
      const fname = this.ensureFileExtension(`${options.filenamePrefix}_${now}`, 'zip');
      link.href = URL.createObjectURL(blob);
      link.download = fname;
      document.body.appendChild(link);
      link.click();
      link.remove();
      URL.revokeObjectURL(link.href);
      this.showNotification('ØªÙ… ØªØµØ¯ÙŠØ± Ø­Ø²Ù…Ø© Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ø¨Ù†Ø¬Ø§Ø­');
    } catch (err) {
      console.error(err);
      this.showNotification('ÙØ´Ù„ ÙÙŠ ØªØµØ¯ÙŠØ± Ø­Ø²Ù…Ø© Ø§Ù„Ø®Ø±ÙŠØ·Ø©', 'error');
    }
  };

  // Add markers from a GeoJSON object (visual-only, does not add to saved properties)
  RealEstateApp.addGeoJSONToMap = function(geojson, options = {}) {
    if (!this.map) {
      this.showNotification('Ø§Ù„Ø®Ø±ÙŠØ·Ø© ØºÙŠØ± Ø¬Ø§Ù‡Ø²Ø© - Ù‚Ù… Ø¨ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ø£ÙˆÙ„Ø§Ù‹', 'error');
      return;
    }
    options = Object.assign({ iconColor: 'orange', clearPrevious: false }, options);
    if (options.clearPrevious && this._importedLayer) {
      try { this.map.removeLayer(this._importedLayer); } catch(e){}
      this._importedLayer = null;
    }

    const layerGroup = L.layerGroup();
    if (geojson && geojson.features && geojson.features.length) {
      geojson.features.forEach(f => {
        const coords = f.geometry && f.geometry.coordinates;
        if (!coords || coords.length < 2) return;
        const lng = coords[0];
        const lat = coords[1];
        const icon = this._createPointIcon(options.iconColor);
        const marker = L.marker([lat, lng], { icon }).addTo(layerGroup);
        const props = f.properties || {};
        const popup = `
          <div class="map-popup-content">
            <h3>Ø¹Ù‚Ø§Ø± ${props.propertyNumber || props.id || ''}</h3>
            <p><strong>Ø§Ù„Ù…ÙˆÙ‚Ø¹:</strong> ${props.governorate||''} - ${props.city||''} - ${props.district||''}</p>
            <p><strong>Ø§Ù„Ø´Ø§Ø±Ø¹:</strong> ${props.street||''}</p>
            <p><strong>Ø§Ù„Ù…Ø§Ù„Ùƒ:</strong> ${props.owner||'--'}</p>
            <hr/>
            <a target="_blank" href="https://www.google.com/maps/dir/?api=1&destination=${lat},${lng}" class="btn">Ø§Ù†ØªÙ‚Ù„</a>
          </div>`;
        marker.bindPopup(popup);
      });
    }
    layerGroup.addTo(this.map);
    this._importedLayer = layerGroup; // keep reference to clear later
    // zoom to layer bounds if present
    try {
      const bounds = layerGroup.getBounds();
      if (bounds.isValid && bounds.isValid()) this.map.fitBounds(bounds.pad(0.5));
    } catch (e) {}
  };

  // Import handler for files (.zip, .geojson, .gpx)
  RealEstateApp.importMapFile = async function(file) {
    const name = (file && file.name) ? file.name.toLowerCase() : '';
    try {
      if (name.endsWith('.zip')) {
        const zip = await JSZip.loadAsync(file);
        // try to find geojson first
        const geoName = Object.keys(zip.files).find(n => n.toLowerCase().endsWith('.geojson'));
        const gpxName = Object.keys(zip.files).find(n => n.toLowerCase().endsWith('.gpx'));
        if (geoName) {
          const text = await zip.file(geoName).async('string');
          const geo = JSON.parse(text);
          this.addGeoJSONToMap(geo, { iconColor: 'orange', clearPrevious: true });
          this.showNotification('ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª GeoJSON Ù…Ù† Ø§Ù„Ø­Ø²Ù…Ø©');
          return;
        } else if (gpxName) {
          const text = await zip.file(gpxName).async('string');
          const geo = this._gpxToGeoJSON(text);
          this.addGeoJSONToMap(geo, { iconColor: 'orange', clearPrevious: true });
          this.showNotification('ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª GPX Ù…Ù† Ø§Ù„Ø­Ø²Ù…Ø©');
          return;
        } else {
          this.showNotification('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ù„Ù GeoJSON/GPX ÙÙŠ Ø§Ù„Ø­Ø²Ù…Ø©', 'error');
          return;
        }
      } else if (name.endsWith('.geojson') || name.endsWith('.json')) {
        const text = await file.text();
        const geo = JSON.parse(text);
        this.addGeoJSONToMap(geo, { iconColor: 'orange', clearPrevious: true });
        this.showNotification('ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ GeoJSON Ø¨Ù†Ø¬Ø§Ø­');
        return;
      } else if (name.endsWith('.gpx')) {
        const text = await file.text();
        const geo = this._gpxToGeoJSON(text);
        this.addGeoJSONToMap(geo, { iconColor: 'orange', clearPrevious: true });
        this.showNotification('ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ GPX Ø¨Ù†Ø¬Ø§Ø­');
        return;
      } else {
        this.showNotification('Ù†ÙˆØ¹ Ø§Ù„Ù…Ù„Ù ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ… (ZIP / GEOJSON / GPX)', 'error');
      }
    } catch (err) {
      console.error(err);
      this.showNotification('ÙØ´Ù„ ÙÙŠ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù…Ù„Ù Ø§Ù„Ø®Ø±ÙŠØ·Ø©', 'error');
    }
  };

  // Convert simple GPX waypoints to GeoJSON
  RealEstateApp._gpxToGeoJSON = function(gpxText) {
    try {
      const parser = new DOMParser();
      const xml = parser.parseFromString(gpxText, 'application/xml');
      const wpts = Array.from(xml.querySelectorAll('wpt')) || [];
      const features = wpts.map(w => {
        const lat = parseFloat(w.getAttribute('lat'));
        const lon = parseFloat(w.getAttribute('lon'));
        const name = w.querySelector('name') ? w.querySelector('name').textContent : '';
        const desc = w.querySelector('desc') ? w.querySelector('desc').textContent : '';
        return {
          type: 'Feature',
          geometry: { type: 'Point', coordinates: [lon, lat] },
          properties: { id: name, propertyNumber: name, street: desc }
        };
      });
      return { type: 'FeatureCollection', features };
    } catch (e) {
      console.error(e);
      return { type: 'FeatureCollection', features: [] };
    }
  };

  // Create UI: add import button next to export-map-package if not present
  (function setupMapImportButton(){
    try {
      const exportBtn = document.getElementById('export-map-package');
      if (!exportBtn) return;
      // create import button
      if (!document.getElementById('import-map-package')) {
        const importBtn = document.createElement('button');
        importBtn.className = 'export-btn image';
        importBtn.id = 'import-map-package';
        importBtn.style.backgroundColor = '#f39c12';
        importBtn.style.marginRight = '10px';
        importBtn.innerHTML = '<i class="fas fa-file-import"></i> Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø­Ø²Ù…Ø© Ø®Ø±ÙŠØ·Ø©';
        exportBtn.parentNode.insertBefore(importBtn, exportBtn.nextSibling);

        // hidden file input
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = '.zip,.geojson,.gpx,.json';
        input.style.display = 'none';
        input.id = 'import-map-file-input';
        document.body.appendChild(input);

        importBtn.addEventListener('click', () => input.click());
        input.addEventListener('change', (e) => {
          const file = e.target.files[0];
          if (!file) return;
          this.importMapFile(file);
          input.value = null; // reset
        });
      }
    } catch (e) { console.warn(e); }
  }).call(RealEstateApp);

  // attach export button handler
  const existingExportBtn = document.getElementById('export-map-package');
  if (existingExportBtn) {
    existingExportBtn.addEventListener('click', function(){
      RealEstateApp.exportMapPackage({ includeImported: false, filenamePrefix: 'Ø§Ù„Ø®Ø±ÙŠØ·Ø©_Ø§Ù„Ø¹Ù‚Ø§Ø±ÙŠØ©' });
    });
  }

  // Augment updateMap popups (navigation link) only if popups don't already include directions
  // We'll monkey-patch the existing method: when RealEstateApp.updateMap runs it creates markers and popups.
  // To ensure navigation links are present, add a small helper that re-binds popups to include a Google Maps directions link.
  RealEstateApp._ensureNavigationInMap = function() {
    if (!this.map) return;
    // find all markers created by the map (we created them with class 'custom-icon' HTML inside) - we will iterate layers
    this.map.eachLayer(layer => {
      try {
        if (layer && layer.getLatLng && layer.getPopup) {
          const latlng = layer.getLatLng();
          const popup = layer.getPopup && layer.getPopup();
          if (!latlng || !popup) return;
          const content = popup.getContent ? popup.getContent() : '';
          if (content && typeof content === 'string' && !content.includes('google.com/maps/dir')) {
            // append a small navigation button
            const newContent = content.replace('</div>', `<p style="text-align:center; margin-top:8px;"><a class="btn" target="_blank" href="https://www.google.com/maps/dir/?api=1&destination=${latlng.lat},${latlng.lng}">Ø§Ù†ØªÙ‚Ù„</a></p></div>`);
            layer.setPopupContent(newContent);
          }
        }
      } catch(e){}
    });
  };

  // After map is updated, try to ensure navigation links exist
  // If RealEstateApp.updateMap exists, wrap it
  if (RealEstateApp.updateMap && typeof RealEstateApp.updateMap === 'function') {
    const originalUpdateMap = RealEstateApp.updateMap.bind(RealEstateApp);
    RealEstateApp.updateMap = function() {
      originalUpdateMap();
      // small timeout to wait for markers/popups creation
      setTimeout(() => { try { this._ensureNavigationInMap(); } catch(e){} }, 300);

      // add locate-me control once
      if (!this._locateControlAdded && this.map) {
        const LocateControl = L.Control.extend({
          options: { position: 'topright' },
          onAdd: function(map){
            const container = L.DomUtil.create('div', 'map-controls');
            container.innerHTML = '<button id="locate-me" class="btn" title="Ø¹Ø±Ø¶ Ù…ÙˆÙ‚Ø¹ÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠ">ğŸ“ Ù…ÙˆÙ‚Ø¹ÙŠ</button>';
            container.style.padding = '6px';
            L.DomEvent.disableClickPropagation(container);
            return container;
          }
        });
        this._locateCtrl = new LocateControl();
        this._locateCtrl.addTo(this.map);
        // attach click listener
        document.addEventListener('click', (e) => {
          if (e.target && e.target.id === 'locate-me') {
            if (!this.map) return;
            this.showNotification('Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹Ùƒ...');
            this.map.locate({ setView: true, maxZoom: 16 });
          }
        });
        this.map.on('locationfound', (e) => {
          if (this._yourLocationMarker) { try { this.map.removeLayer(this._yourLocationMarker); } catch(e){} }
          this._yourLocationMarker = L.marker(e.latlng, {icon: this._createPointIcon('red')}).addTo(this.map).bindPopup('<strong>Ù…ÙˆÙ‚Ø¹Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ</strong>').openPopup();
        });
        this.map.on('locationerror', (err) => { this.showNotification('ØªØ¹Ø°Ø± Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆÙ‚Ø¹: ' + (err.message || ''), 'error'); });
        this._locateControlAdded = true;
      }
    };
  }

})();
  // ======== ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø¯Ø¹Ù… Ø§Ù„ØªÙ‚Ø³ÙŠÙ… Ø¥Ù„Ù‰ ØµÙØ­Ø§Øª ÙÙŠ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø±Ø§Øª Ø§Ù„Ø±Ø³Ù…ÙŠØ© ========

// Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„ØªÙ‚Ø³ÙŠÙ… Ø§Ù„ÙˆØ­Ø¯Ø§Øª Ø¥Ù„Ù‰ ØµÙØ­Ø§Øª
RealEstateApp.splitIntoPages = function(items, itemsPerPage) {
    const pages = [];
    for (let i = 0; i < items.length; i += itemsPerPage) {
        pages.push(items.slice(i, i + itemsPerPage));
    }
    return pages;
};

// Ø¯Ø§Ù„Ø© Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù†Ø§ØµØ± Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„ØµÙØ­Ø§Øª
RealEstateApp.createPaginationControls = function(currentPage, totalPages, formType) {
    const controls = document.createElement('div');
    controls.className = 'pagination-controls';
    controls.style.cssText = 'text-align: center; margin: 20px 0; display: flex; justify-content: center; align-items: center; gap: 10px;';

    if (totalPages <= 1) return controls;

    const prevButton = document.createElement('button');
    prevButton.className = 'btn';
    prevButton.innerHTML = '<i class="fas fa-chevron-right"></i> Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©';
    prevButton.disabled = currentPage === 1;
    prevButton.addEventListener('click', () => {
        RealEstateApp.showFormPage(formType, currentPage - 1);
    });

    const nextButton = document.createElement('button');
    nextButton.className = 'btn';
    nextButton.innerHTML = 'Ø§Ù„ØµÙØ­Ø© Ø§Ù„ØªØ§Ù„ÙŠØ© <i class="fas fa-chevron-left"></i>';
    nextButton.disabled = currentPage === totalPages;
    nextButton.addEventListener('click', () => {
        RealEstateApp.showFormPage(formType, currentPage + 1);
    });

    const pageInfo = document.createElement('span');
    pageInfo.style.cssText = 'padding: 8px 15px; background: #f8f9fa; border-radius: 5px; font-weight: bold;';
    pageInfo.textContent = `Ø§Ù„ØµÙØ­Ø© ${currentPage} Ù…Ù† ${totalPages}`;

    controls.appendChild(prevButton);
    controls.appendChild(pageInfo);
    controls.appendChild(nextButton);

    return controls;
};

// Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ ØµÙØ­Ø© Ù…Ø­Ø¯Ø¯Ø© Ù…Ù† Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø±Ø©
RealEstateApp.showFormPage = function(formType, pageNumber) {
    if (formType === 'form1') {
        RealEstateApp.fillOfficialForm1(RealEstateApp.currentProperty, pageNumber);
    } else if (formType === 'form2') {
        RealEstateApp.fillOfficialForm2(RealEstateApp.currentProperty, pageNumber);
    }
};

// ØªØ¹Ø¯ÙŠÙ„ Ø¯Ø§Ù„Ø© ØªØ¹Ø¨Ø¦Ø© Ø§Ø³ØªÙ…Ø§Ø±Ø© Ø§Ù„Ø­ØµØ± Ù„Ø¯Ø¹Ù… Ø§Ù„ØªÙ‚Ø³ÙŠÙ… Ø¥Ù„Ù‰ ØµÙØ­Ø§Øª
RealEstateApp.fillOfficialForm1 = function(property, page = 1) {
    if (!property) return;

    const itemsPerPage = 10; // ÙƒÙ„ ØµÙØ­Ø© ØªØ³Ø¹ 10 ÙˆØ­Ø¯Ø§Øª
    const allUnits = property.units || [];
    const totalPages = Math.ceil(allUnits.length / itemsPerPage);
    const currentPage = Math.max(1, Math.min(page, totalPages));
    const startIndex = (currentPage - 1) * itemsPerPage;
    const endIndex = startIndex + itemsPerPage;
    const units = allUnits.slice(startIndex, endIndex);

    // ØªØ­Ø¯ÙŠØ« Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø±Ø©
    document.getElementById('form1-header').innerHTML = `
        <td colspan="18" class="merged-cell">
        Ù…Ø­Ø§ÙØ¸Ø©: ${property.governorate || '--'}
        Ù…Ø£Ù…ÙˆØ±ÙŠØ©: ${property.city || '--'}
        Ù‚Ø±ÙŠØ©: ${property.district || '--'}
        ${totalPages > 1 ? ` - Ø§Ù„ØµÙØ­Ø© ${currentPage} Ù…Ù† ${totalPages}` : ''}
        </td>
    `;

    // ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    const tbody = document.getElementById('form1-data');
    tbody.innerHTML = '';

    if (units.length > 0) {
        units.forEach((unit, index) => {
            const globalIndex = startIndex + index;
            const tr = document.createElement('tr');
            
            // ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´ØªØ±ÙƒØ© Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø· Ù„Ù„ÙˆØ­Ø¯Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ ÙÙŠ Ø§Ù„ØµÙØ­Ø©
            const commonData = index === 0 ? `
                <td rowspan="${units.length}">${property.propertyNumber || '--'}</td>
                <td rowspan="${units.length}">${property.street || '--'}</td>
                <td rowspan="${units.length}">${property.streetWidth || '--'}</td>
                <td rowspan="${units.length}">${property.owner || '--'}</td>
                <td rowspan="${units.length}">${this.getBuildingMaterialName(property.buildingMaterial)}</td>
                <td rowspan="${units.length}">${property.detailedDescription || '--'}</td>
                <td rowspan="${units.length}">${property.constructionYear || '--'}</td>
            ` : '';
            
            tr.innerHTML = commonData + `
                <td>${this.getUseTypeName(unit.useType)}</td>
                <td>${unit.floor || '--'}</td>
                <td>${unit.number || globalIndex + 1}</td>
                <td>${this.getUnitTypeName(unit.unitType)}</td>
                <td>${unit.area || '--'} Ù…Â²</td>
                <td>${unit.occupant || '--'}</td>
                <td>${unit.rentalValue ? this.formatCurrency(unit.rentalValue) : '--'}</td>
                <td>${unit.tax ? this.formatCurrency(unit.tax) : '--'}</td>
                <td>${property.district || '--'}</td>
            `;
            tbody.appendChild(tr);
        });
    } else {
        const tr = document.createElement('tr');
        tr.innerHTML = `
            <td colspan="18" style="text-align: center; padding: 20px; color: var(--gray);">
            <i class="fas fa-inbox"></i>
            <h3>Ù„Ø§ ØªÙˆØ¬Ø¯ ÙˆØ­Ø¯Ø§Øª Ù…Ø³Ø¬Ù„Ø© Ù„Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù‚Ø§Ø±</h3>
            </td>
        `;
        tbody.appendChild(tr);
    }

    // Ø¥Ø¶Ø§ÙØ© Ø¹Ù†Ø§ØµØ± Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„ØµÙØ­Ø§Øª
    const existingPagination = document.getElementById('form1-pagination');
    if (existingPagination) {
        existingPagination.remove();
    }

    if (totalPages > 1) {
        const paginationControls = this.createPaginationControls(currentPage, totalPages, 'form1');
        paginationControls.id = 'form1-pagination';
        const form1Element = document.getElementById('form1');
        form1Element.appendChild(paginationControls);
    }
};

// ØªØ¹Ø¯ÙŠÙ„ Ø¯Ø§Ù„Ø© ØªØ¹Ø¨Ø¦Ø© Ø§Ø³ØªÙ…Ø§Ø±Ø© 32 Ù„Ø¯Ø¹Ù… Ø§Ù„ØªÙ‚Ø³ÙŠÙ… Ø¥Ù„Ù‰ ØµÙØ­Ø§Øª
RealEstateApp.fillOfficialForm2 = function(property, page = 1) {
    if (!property) return;

    const itemsPerPage = 20; // ÙƒÙ„ ØµÙØ­Ø© ØªØ³Ø¹ 20 ÙˆØ­Ø¯Ø©
    const allUnits = property.units || [];
    const totalPages = Math.ceil(allUnits.length / itemsPerPage);
    const currentPage = Math.max(1, Math.min(page, totalPages));
    const startIndex = (currentPage - 1) * itemsPerPage;
    const endIndex = startIndex + itemsPerPage;
    const units = allUnits.slice(startIndex, endIndex);

    // ØªØ­Ø¯ÙŠØ« Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø±Ø©
    document.getElementById('form2-header').innerHTML = `
        <td colspan="35" class="merged-cell">
        Ù…Ø­Ø§ÙØ¸Ø©: ${property.governorate || '--'}
        Ù…Ø£Ù…ÙˆØ±ÙŠØ©: ${property.city || '--'}
        Ø§Ù„Ù†Ø§Ø­ÙŠØ©: ${property.district || '--'}
        ${totalPages > 1 ? ` - Ø§Ù„ØµÙØ­Ø© ${currentPage} Ù…Ù† ${totalPages}` : ''}
        </td>
    `;

    // ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    const tbody = document.getElementById('form2-data');
    tbody.innerHTML = '';

    if (units.length > 0) {
        units.forEach((unit, index) => {
            const globalIndex = startIndex + index;
            const tr = document.createElement('tr');
            
            // ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´ØªØ±ÙƒØ© Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø· Ù„Ù„ÙˆØ­Ø¯Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ ÙÙŠ Ø§Ù„ØµÙØ­Ø©
            const commonData = index === 0 ? `
                <td rowspan="${units.length}">${new Date().toLocaleDateString('ar-EG')}</td>
                <td rowspan="${units.length}">${property.owner || '--'}</td>
                <td rowspan="${units.length}">${property.propertyNumber || '--'}</td>
                <td rowspan="${units.length}">${property.previousPropertyNumber || '--'}</td>
                <td rowspan="${units.length}">--</td>
                <td rowspan="${units.length}">${property.street || '--'}</td>
                <td rowspan="${units.length}">${property.detailedDescription || '--'}</td>
                <td rowspan="${units.length}">${property.constructionYear || '--'}</td>
            ` : '';
            
            tr.innerHTML = commonData + `
                <td>${this.getUseTypeName(unit.useType)}</td>
                <td>--</td>
                <td>${unit.floor || '--'}</td>
                <td>${unit.number || globalIndex + 1}</td>
                <td>${this.getUnitTypeName(unit.unitType)}</td>
                <td>${unit.area || '--'} Ù…Â²</td>
                <td>${unit.occupant || '--'}</td>
                <td>${unit.rentalValue ? this.formatCurrency(unit.rentalValue) : '--'}</td>
                <td>${unit.netRentalValue ? this.formatCurrency(unit.netRentalValue) : '--'}</td>
                <td>${unit.tax ? this.formatCurrency(unit.tax) : '--'}</td>
                <td>--</td>
                <td>--</td>
                <td>--</td>
                <td>--</td>
                <td>--</td>
                <td>--</td>
                <td>--</td>
                <td>--</td>
                <td>--</td>
                <td>--</td>
                <td>--</td>
                <td>--</td>
                <td>--</td>
                <td>--</td>
                <td>--</td>
                <td>--</td>
                <td>--</td>
            `;
            tbody.appendChild(tr);
        });

        // Ø¥Ø¶Ø§ÙØ© ØµÙˆØ± Ø§Ù„Ø¹Ù‚Ø§Ø± ÙÙŠ Ø®Ø§Ù†Ø© Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª (ÙÙ‚Ø· ÙÙŠ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰)
        if (currentPage === 1 && property.images && property.images.length > 0) {
            const imagesRow = document.createElement('tr');
            imagesRow.innerHTML = `
                <td colspan="35">
                <div class="form-images-container">
                    <div class="form-images-title">
                        <i class="fas fa-images"></i> ØµÙˆØ± Ø§Ù„Ø¹Ù‚Ø§Ø±
                    </div>
                    <div class="form-images-grid" id="form2-images">
                        <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„ØµÙˆØ± -->
                    </div>
                </div>
                </td>
            `;
            tbody.appendChild(imagesRow);
            const imagesContainer = document.getElementById('form2-images');
            imagesContainer.innerHTML = '';
            property.images.forEach(img => {
                const imgContainer = document.createElement('div');
                imgContainer.className = 'form-image-item';
                imgContainer.innerHTML = `<img src="${img}" alt="ØµÙˆØ±Ø© Ø§Ù„Ø¹Ù‚Ø§Ø±">`;
                imagesContainer.appendChild(imgContainer);
            });
        }
    } else {
        const tr = document.createElement('tr');
        tr.innerHTML = `
            <td colspan="35" style="text-align: center; padding: 20px; color: var(--gray);">
            <i class="fas fa-inbox"></i>
            <h3>Ù„Ø§ ØªÙˆØ¬Ø¯ ÙˆØ­Ø¯Ø§Øª Ù…Ø³Ø¬Ù„Ø© Ù„Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù‚Ø§Ø±</h3>
            </td>
        `;
        tbody.appendChild(tr);
    }

    // Ø¥Ø¶Ø§ÙØ© Ø¹Ù†Ø§ØµØ± Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„ØµÙØ­Ø§Øª
    const existingPagination = document.getElementById('form2-pagination');
    if (existingPagination) {
        existingPagination.remove();
    }

    if (totalPages > 1) {
        const paginationControls = this.createPaginationControls(currentPage, totalPages, 'form2');
        paginationControls.id = 'form2-pagination';
        const form2Element = document.getElementById('form2');
        form2Element.appendChild(paginationControls);
    }
};

// ØªØ¹Ø¯ÙŠÙ„ Ø¯ÙˆØ§Ù„ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© Ù„Ø¯Ø¹Ù… Ø§Ù„ØµÙØ­Ø§Øª Ø§Ù„Ù…ØªØ¹Ø¯Ø¯Ø©
RealEstateApp.printForm1 = function() {
    const originalFillForm1 = RealEstateApp.fillOfficialForm1;
    
    // Ø·Ø¨Ø§Ø¹Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙØ­Ø§Øª
    const property = RealEstateApp.currentProperty;
    if (!property || !property.units || property.units.length === 0) {
        RealEstateApp.showNotification('Ù„Ø§ ØªÙˆØ¬Ø¯ ÙˆØ­Ø¯Ø§Øª Ù„Ø·Ø¨Ø§Ø¹ØªÙ‡Ø§', 'error');
        return;
    }

    const totalPages = Math.ceil(property.units.length / 10);
    
    // Ø­ÙØ¸ Ø­Ø§Ù„Ø© Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©
    const activeTab = document.querySelector('.tab.active');
    const activeContent = document.querySelector('.tab-content.active');
    
    // ØªÙØ¹ÙŠÙ„ Ø§Ø³ØªÙ…Ø§Ø±Ø© Ø§Ù„Ø­ØµØ±
    document.querySelector('.tab[data-target="form1"]').classList.add('active');
    document.getElementById('form1').classList.add('active');
    
    // Ø·Ø¨Ø§Ø¹Ø© ÙƒÙ„ ØµÙØ­Ø© Ø¹Ù„Ù‰ Ø­Ø¯Ø©
    for (let page = 1; page <= totalPages; page++) {
        RealEstateApp.fillOfficialForm1(property, page);
        
        // ØªØ£Ø®ÙŠØ± Ø¨Ø³ÙŠØ· Ø¨ÙŠÙ† Ø§Ù„ØµÙØ­Ø§Øª
        if (page < totalPages) {
            setTimeout(() => {
                window.print();
            }, page * 1000);
        } else {
            window.print();
        }
    }
    
    // Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© Ù„Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
    if (activeTab) activeTab.classList.add('active');
    if (activeContent) activeContent.classList.add('active');
};

RealEstateApp.printForm2 = function() {
    const property = RealEstateApp.currentProperty;
    if (!property || !property.units || property.units.length === 0) {
        RealEstateApp.showNotification('Ù„Ø§ ØªÙˆØ¬Ø¯ ÙˆØ­Ø¯Ø§Øª Ù„Ø·Ø¨Ø§Ø¹ØªÙ‡Ø§', 'error');
        return;
    }

    const totalPages = Math.ceil(property.units.length / 20);
    
    // Ø­ÙØ¸ Ø­Ø§Ù„Ø© Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©
    const activeTab = document.querySelector('.tab.active');
    const activeContent = document.querySelector('.tab-content.active');
    
    // ØªÙØ¹ÙŠÙ„ Ø§Ø³ØªÙ…Ø§Ø±Ø© 32
    document.querySelector('.tab[data-target="form2"]').classList.add('active');
    document.getElementById('form2').classList.add('active');
    
    // Ø·Ø¨Ø§Ø¹Ø© ÙƒÙ„ ØµÙØ­Ø© Ø¹Ù„Ù‰ Ø­Ø¯Ø©
    for (let page = 1; page <= totalPages; page++) {
        RealEstateApp.fillOfficialForm2(property, page);
        
        // ØªØ£Ø®ÙŠØ± Ø¨Ø³ÙŠØ· Ø¨ÙŠÙ† Ø§Ù„ØµÙØ­Ø§Øª
        if (page < totalPages) {
            setTimeout(() => {
                window.print();
            }, page * 1000);
        } else {
            window.print();
        }
    }
    
    // Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© Ù„Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
    if (activeTab) activeTab.classList.add('active');
    if (activeContent) activeContent.classList.add('active');
};

// Ø¥Ø¶Ø§ÙØ© Ø£Ù†Ù…Ø§Ø· CSS Ù„Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„ØµÙØ­Ø§Øª
const paginationStyles = `
.pagination-controls {
    display: flex;
    justify-content: center;
    align-items: center;
    margin: 20px 0;
    gap: 10px;
    padding: 15px;
    background: #f8f9fa;
    border-radius: 10px;
    border: 1px solid #e9ecef;
}

.pagination-controls .btn {
    padding: 8px 16px;
    font-size: 14px;
}

.pagination-controls .btn:disabled {
    background-color: #6c757d;
    cursor: not-allowed;
}

.pagination-info {
    padding: 8px 15px;
    background: white;
    border-radius: 5px;
    font-weight: bold;
    color: #2c3e50;
}

@media print {
    .pagination-controls {
        display: none !important;
    }
    
    .official-form {
        page-break-after: always;
    }
    
    .official-form:last-child {
        page-break-after: auto;
    }
}
`;

// Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø£Ù†Ù…Ø§Ø· Ø¥Ù„Ù‰ Ø§Ù„ØµÙØ­Ø©
const styleSheet = document.createElement('style');
styleSheet.textContent = paginationStyles;
document.head.appendChild(styleSheet);
</script>
<!-- END: Map GPS Export Patch -->
</body>